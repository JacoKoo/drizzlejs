{"version":3,"file":"drizzle.js","sources":["../src/template/template.ts","../src/template/node.ts","../src/template/anchor-node.ts","../src/template/if-block.ts","../src/template/helper.ts","../src/template/each-block.ts","../src/loader.ts","../src/lifecycle.ts","../src/renderable.ts","../src/model.ts","../src/store.ts","../src/view.ts","../src/route.ts","../src/module.ts","../src/application.ts","../src/template/attributes.ts","../src/template/static-node.ts","../src/template/binding.ts","../src/template/dynamic-node.ts","../src/template/text-node.ts","../src/template/reference-node.ts","../src/template/region-node.ts","../src/drizzle.ts"],"sourcesContent":["import { Disposable } from '../drizzle'\nimport { Node as MNode } from './node'\nimport { Renderable } from '../renderable'\nimport { Lifecycle } from '../lifecycle'\n\ntype StaticValue = string | number | boolean\ntype DynamicValue = string\n\nexport enum ValueType { STATIC, DYNAMIC }\nexport enum ChangeType { CHANGED, NOT_CHANGED }\n\nexport type AttributeValue = [ValueType.STATIC, StaticValue] | [ValueType.DYNAMIC, DynamicValue]\nexport type Attribute = [string, AttributeValue]\n\nexport type HelperResult = [ChangeType, any]\n\nexport interface Updatable extends Disposable {\n    update (context: object): void\n}\n\nexport interface ComponentHook extends Disposable {\n    update (...args: any[]): void\n}\n\nexport type Component = (node: Node, ...args: any[]) => ComponentHook\n\nexport interface Appendable {\n    append (el: Node)\n    remove (el: Node)\n    before (anchor: Node): Appendable\n}\n\nexport function createAppendable (target: Node): Appendable {\n    if (!target) return null\n    const remove = (el: Node) => target.removeChild(el)\n    const append = (el: Node) => target.appendChild(el)\n    const before = (anchor: Node) => {\n        return {remove, before, append: (el: Node) => target.insertBefore(el, anchor)}\n    }\n    return {append, remove, before}\n}\n\nexport class Delay {\n    static also (fn: (Delay) => void) {\n        const d = new Delay()\n        fn(d)\n        return d.execute()\n    }\n\n    busy = Promise.resolve()\n\n    add (p: Promise<any>) {\n        this.busy = this.busy.then(() => p)\n    }\n\n    execute () {\n        return this.busy\n    }\n}\n\nexport function getValue (key: string, context: any): any {\n    const ks = key.split('.')\n    const first = ks.shift()\n    let ctx\n    if (context._computed && first in context._computed) {\n        ctx = context._computed[first](context)\n    } else {\n        ctx = context[first]\n    }\n\n    if (ks.length) {\n        ctx = ks.reduce((acc, item) => {\n            if (acc == null) return null\n            return acc[item]\n        }, ctx)\n    }\n\n    return ctx\n}\n\nexport function getAttributeValue(attr: AttributeValue, context: object): any {\n    if (attr[0] === ValueType.STATIC) return attr[1]\n    return getValue(attr[1] as string, context)\n}\n\nexport function resolveEventArgument (me: any, context: object, args: Attribute[], event: any): any[] {\n    const values = args.map(([name, v]) => {\n        if (v[0] === ValueType.STATIC) return v[1]\n        const it = v[1] as string\n        if (it === 'event') return event\n        if (it === 'this') return me\n        if (it.slice(0, 6) === 'event.') return event[it.slice(6)]\n        if (it.slice(0, 5) === 'this.') return me[it.slice(5)]\n        return getValue(it, context)\n    })\n\n    const obj = {}\n    const result = [obj]\n    let keys = 0\n\n    args.forEach(([name, v], i) => {\n        if (name) {\n            keys ++\n            obj[name] = values[i]\n            return\n        }\n        result.push(values[i])\n    })\n\n    if (keys === 0) result.shift()\n    return result\n}\n\nexport const customEvents = {\n    enter (node: HTMLElement, cb: (any) => void): Disposable {\n        const ee = function (this: HTMLElement, e) {\n            if (e.keyCode !== 13) return\n            e.preventDefault()\n            cb.call(this, e)\n        }\n        node.addEventListener('keypress', ee, false)\n        return {\n            dispose () {\n                node.removeEventListener('keypress', ee, false)\n            }\n        }\n    },\n\n    escape (node: HTMLElement, cb: (any) => void): Disposable {\n        const ee = function (this: HTMLElement, e) {\n            if (e.keyCode !== 27) return\n            cb.call(this, e)\n        }\n        node.addEventListener('keyup', ee, false)\n        return {\n            dispose () {\n                node.removeEventListener('keyup', ee, false)\n            }\n        }\n    }\n}\n\nexport const components: {[name: string]: Component} = {\n}\n\nexport abstract class Template {\n    creator: () => MNode[]\n\n    createLife () {\n        const me = this\n        const o = {\n            stage: 'template',\n            nodes: [] as MNode[],\n            init (this: Renderable<any>) {\n                o.nodes = me.creator()\n                return Delay.also(d => o.nodes.forEach(it => it.init(this, d)))\n            },\n\n            beforeRender (this: Renderable<any>) {\n                return Delay.also(d => o.nodes.forEach(it => {\n                    it.parent = this._target\n                    it.render(this._context(), d)\n                }))\n            },\n\n            updated (this: Renderable<any>) {\n                return Delay.also(d => o.nodes.forEach(it => it.update(this._context(), d)))\n            },\n\n            destroyed () {\n                return Delay.also(d => o.nodes.forEach(it => it.destroy(d)))\n            }\n        }\n\n        return o\n    }\n}\n\nexport class ViewTemplate extends Template {\n}\n\nexport class ModuleTemplate extends Template {\n    exportedModels: string[] = []\n\n    constructor(exportedModels: string[]) {\n        super()\n        this.exportedModels = exportedModels\n    }\n}\n","import { Renderable, RenderOptions } from '../renderable'\nimport { Delay, Appendable, createAppendable } from './template'\n\nexport abstract class Node {\n    root: Renderable<RenderOptions>\n    id: string\n    element: HTMLElement\n    parent: Appendable\n    children: Node[] = []\n    rendered: boolean = false\n    inSvg: boolean = false\n\n    constructor(id?: string) {\n        this.id = id\n    }\n\n    init (root: Renderable<any>, delay: Delay) {\n        this.root = root\n        this.element = this.create()\n        const a = createAppendable(this.element)\n        this.children.forEach(it => {\n            it.parent = a\n            it.init(root, delay)\n        })\n    }\n\n    render (context: object, delay: Delay) {\n        if (this.id && this.element) this.root.ids[this.id] = this.element\n    }\n\n    update (context: object, delay: Delay) {\n    }\n\n    destroy (delay: Delay) {\n        this.children.forEach(it => it.destroy(delay))\n        if (this.id) delete this.root.ids[this.id]\n    }\n\n    setChildren (children: Node[]) {\n        this.children = children\n        if (this.inSvg) children.forEach(it => it.setToSvg())\n    }\n\n    setToSvg () {\n        this.inSvg = true\n        this.children.forEach(it => it.inSvg = true)\n    }\n\n    clearHelper () {\n        this.children.forEach(it => it.clearHelper())\n    }\n\n    create () {\n        return null\n    }\n}\n","import { Node as MNode } from './node'\nimport { Appendable, Delay } from './template'\n\nexport abstract class AnchorNode extends MNode {\n    newParent: Appendable\n    anchor: Node\n\n    constructor (id?: string) {\n        super(id)\n        this.anchor = document.createComment('')\n    }\n\n    render (context: object, delay: Delay) {\n        super.render(context, delay)\n        if (!this.newParent) {\n            this.parent.append(this.anchor)\n            this.newParent = this.parent.before(this.anchor)\n        }\n    }\n\n    destroy (delay: Delay) {\n        super.destroy(delay)\n\n        this.parent.remove(this.anchor)\n        this.newParent = null\n    }\n}\n","import { Node } from './node'\nimport { Renderable } from '../renderable'\nimport { Delay, AttributeValue, ValueType, getAttributeValue, Appendable } from './template'\nimport { AnchorNode } from './anchor-node'\n\nexport const Compare: {[key: string]: (v1: any, v2: any) => boolean} = {\n    eq: (v1, v2) => v1 === v2,\n    ne: (v1, v2) => v1 !== v2,\n    gt: (v1, v2) => v1 > v2,\n    lt: (v1, v2) => v1 < v2,\n    gte: (v1, v2) => v1 >= v2,\n    lte: (v1, v2) => v1 <= v2\n}\n\nexport class IfBlock extends AnchorNode {\n    args: AttributeValue[]\n    trueNode: Node\n    falseNode?: Node\n    current: Node\n\n    constructor (args: AttributeValue[], trueNode: Node, falseNode?: Node) {\n        super()\n        this.trueNode = trueNode\n        this.falseNode = falseNode\n        this.args = args\n    }\n\n    init (root: Renderable<any>, delay: Delay) {\n        this.root = root\n        this.trueNode.init(root, delay)\n        if (this.falseNode) {\n            this.falseNode.init(root, delay)\n        }\n    }\n\n    use (context: object): boolean {\n        if (this.args.length === 1) return this.useSingle(context)\n        if (this.args.length === 3) return this.useCompare(context)\n        throw new Error('if block should have 1 or 3 arguments')\n    }\n\n    useCompare (context: object): boolean {\n        const op = this.args[1][1] as string\n        if (!Compare[op]) {\n            throw Error(`${op} is not a valid compare operator, use: eq(===), ne(!==), gt(>), lt(<), gte(>=), lte(<=)`)\n        }\n        return Compare[op](getAttributeValue(this.args[0], context), getAttributeValue(this.args[2], context))\n    }\n\n    useSingle (context: object): boolean {\n        if (this.args[0][0] === ValueType.STATIC) {\n            // TODO throw\n            return false\n        }\n        return !!getAttributeValue(this.args[0], context)\n    }\n\n    render (context: object, delay: Delay) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context, delay)\n\n        this.trueNode.parent = this.newParent\n        if (this.falseNode) {\n            this.falseNode.parent = this.newParent\n        }\n\n        this.current = this.use(context) ? this.trueNode : this.falseNode\n\n        if (this.current) {\n            this.current.render(context, delay)\n        }\n    }\n\n    update (context: object, delay: Delay) {\n        if (!this.rendered) return\n\n        const use = this.use(context) ? this.trueNode : this.falseNode\n        if (use === this.current) {\n            if (use) use.update(context, delay)\n            return\n        }\n\n        if (this.current) this.current.destroy(delay)\n        this.current = use === this.trueNode ? this.trueNode : this.falseNode\n        if (this.current) this.current.render(context, delay)\n    }\n\n    destroy (delay: Delay) {\n        if (!this.rendered) return\n        if (this.current) this.current.destroy(delay)\n        super.destroy(delay)\n        this.rendered = false\n    }\n\n}\n\nexport class UnlessBlock extends IfBlock {\n    use (context: any): boolean {\n        return !getAttributeValue(this.args[0], context)\n    }\n}\n","import { HelperResult, ChangeType } from './template'\nimport { getValue, AttributeValue, ValueType } from './template'\nimport { View } from '../view'\nimport { Compare } from './if-block'\n\nexport abstract class Helper {\n    name: string = ''\n    args: AttributeValue[]\n    dynamicKeys: string[]\n    currentKeys: string[]\n    currentValues: string[]\n\n    current: any\n\n    constructor (...args: AttributeValue[]) {\n        this.args = args\n        this.dynamicKeys = args.filter(it => it[0] === ValueType.DYNAMIC).map(it => it[1] as string)\n        this.check()\n    }\n\n    clear () {\n        this.currentValues = null\n    }\n\n    render (context: object): HelperResult {\n        if (!this.currentValues) return [ChangeType.CHANGED, this.renderIt(context)]\n\n        const vs = this.currentKeys.map(it => getValue(it, context))  // TODO if changed, will it do get value twice?\n        if (vs.some((it, i) => it !== this.currentValues[i])) {\n            return [ChangeType.CHANGED, this.renderIt(context)]\n        }\n\n        return [ChangeType.NOT_CHANGED, this.current]\n    }\n\n    arg (idx: number, context: object): any {\n        const arg = this.args[idx]\n        if (!arg) return ''\n        if (arg[0] === ValueType.STATIC) return arg[1]\n        return this.key(arg[1] as string, context)\n    }\n\n    key (key: string, context: object): any {\n        this.currentKeys.push(key)\n        const v = getValue(key, context)\n        this.currentValues.push(v)\n        return v\n    }\n\n    check () {}\n\n    assertCount (...numbers: number[]) {\n        if (!numbers.some(it => it === this.args.length)) {\n            throw new Error(`${name} helper should have ${numbers.join(' or ')} arguments`)\n        }\n    }\n\n    assertDynamic (...numbers: number[]) {\n        numbers.forEach(it => {\n            if (this.args[it][0] !== ValueType.DYNAMIC) {\n                throw new Error(`the ${it}th argument of ${name} helper should be dynamic`)\n            }\n        })\n    }\n\n    abstract doRender (context: object): any\n\n    private renderIt (context: object): any {\n        this.currentKeys = []\n        this.currentValues = []\n        this.current = this.doRender(context)\n        return this.current\n    }\n}\n\nexport class Transfromer extends Helper {\n    fn: (...args: any[]) => any\n\n    constructor(fn: (...args: any[]) => any, ...args: AttributeValue[]) {\n        super(...args)\n        this.fn = fn\n    }\n\n    doRender (context: object): any {\n        return this.fn.apply(null, this.args.map((it, i) => this.arg(i, context)))\n    }\n}\n\nexport class DelayTransfomer extends Transfromer {\n    name: string\n\n    constructor(name: string, ...args: AttributeValue[]) {\n        super(null, ...args)\n        this.name = name\n    }\n\n    init (root: View) {\n        const {helpers} = root._options\n        if (helpers && helpers[this.name]) this.fn = helpers[this.name]\n        else throw new Error(`no helper found: ${name}`)\n    }\n}\n\nexport class EchoHelper extends Helper {\n    doRender (context) {\n        return this.arg(0, context)\n    }\n}\n\nexport class ConcatHelper extends Helper {\n    name = 'concat'\n\n    check () {\n        this.currentKeys = this.dynamicKeys\n    }\n\n    doRender (context: object): any {\n        return this.args.map((it, i) => this.arg(i, context)).join(' ')\n    }\n}\n\nexport class IfHelper extends Helper {\n    name = 'if'\n\n    check () {\n        this.assertCount(2, 3, 4, 5)\n        this.assertDynamic(0)\n    }\n\n    doRender (context: object): any {\n        return this.arg(this.use(context), context)\n    }\n\n    use (context: object): number {\n        if (this.args.length <= 3) return this.useSingle(context)\n        return this.useMultiple(context)\n    }\n\n    useSingle (context): number {\n        return this.key(this.dynamicKeys[0], context) ? 1 : 2\n    }\n\n    useMultiple (context): number {\n        const op = this.args[1][1] as string\n        if (!Compare[op]) {\n            throw Error(`${op} is not a valid compare operator, use: eq(===), ne(!==), gt(>), lt(<), gte(>=), lte(<=)`)\n        }\n\n        return Compare[op](this.arg(0, context), this.arg(2, context)) ? 3 : 4\n    }\n}\n\nexport class UnlessHelper extends IfHelper {\n    name = 'unless'\n\n    use (context: object): number {\n        return this.key(this.dynamicKeys[0], context) ? 2 : 1\n    }\n}\n","import { Node } from './node'\nimport { Renderable } from '../renderable'\nimport { getValue, Delay, Appendable } from './template'\nimport { AnchorNode } from './anchor-node'\n\nexport class EachBlock extends AnchorNode {\n    args: string[]\n    trueNode: () => Node\n    falseNode?: Node\n    currentSize = 0\n    nodes: Node[] = []\n\n    constructor (args: string[], trueNode: () => Node, falseNode?: Node) {\n        super()\n        this.args = args\n        this.trueNode = trueNode\n        this.falseNode = falseNode\n    }\n\n    init (root: Renderable<any>, delay: Delay) {\n        this.root = root\n    }\n\n    isEmpty (list: any): boolean {\n        return !list || (Array.isArray(list) && !list.length) || (typeof list === 'object' && !Object.keys(list))\n    }\n\n    sub (context: {[key: string]: any}, i: number | string) {\n        const o = Object.assign({}, context)\n        if (!o._each) o._each = []\n        else o._each = o._each.slice(0)\n\n        const v = getValue(this.args[0], context)\n        o._each.push({list: v, index: i, key: this.args[2], name: this.args[0]})\n\n        o[this.args[2]] = v[i]\n        if (this.args[3]) o[this.args[3]] = i\n        return o\n    }\n\n    render (context: object, delay: Delay) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context, delay)\n        if (this.falseNode) this.falseNode.parent = this.newParent\n\n        const list = getValue(this.args[0], context)\n        if (this.isEmpty(list)) {\n            this.renderElse(context, delay)\n            return\n        }\n\n        const kv = Array.isArray(list) ?\n            list.map((it, i) => [i, it]) as [any, any] :\n            Object.keys(list).map(it => [it, list[it]] as [any, any])\n\n        this.renderKeyValue(kv, context, delay)\n    }\n\n    createTrueNode (i: number, context: object, delay: Delay) {\n        const n = this.trueNode()\n        n.parent = this.newParent\n        this.nodes[i] = n\n        n.init(this.root, delay)\n        delay.execute().then(() => n.render(context, delay))\n    }\n\n    renderKeyValue (arr: [any, any][], context: object, delay: Delay) {\n        this.currentSize = arr.length\n        arr.forEach((it, i) => {\n            const sub = this.sub(context, i)\n            this.createTrueNode(i, sub, delay)\n        })\n    }\n\n    renderElse (context: object, delay: Delay) {\n        if (!this.falseNode) return\n        this.falseNode.init(this.root, delay)\n        this.falseNode.render(context, delay)\n    }\n\n    update (context: object, delay: Delay) {\n        if (!this.rendered) return\n\n        const list = getValue(this.args[0], context)\n        const empty = this.isEmpty(list)\n        if (empty && !this.currentSize) {\n            this.updateElse(context, delay)\n            return\n        }\n\n        if (empty) {\n            this.currentSize = 0\n            this.nodes.forEach(it => it.destroy(delay))\n            this.nodes = []\n\n            this.renderElse(context, delay)\n            return\n        }\n\n        const kv = Array.isArray(list) ?\n            list.map((it, i) => [i, it] as [any, any]) :\n            Object.keys(list).map(it => [it, list[it]] as [any, any])\n\n        this.updateKeyValue(kv, context, delay)\n    }\n\n    updateElse (context: object, delay: Delay) {\n        if (this.falseNode) this.falseNode.update(context, delay)\n    }\n\n    updateKeyValue (arr: [any, any][], context: object, delay: Delay) {\n        this.currentSize = arr.length\n        arr.forEach((it, i) => {\n            const sub = this.sub(context, i)\n\n            if (this.nodes[i]) {\n                this.nodes[i].clearHelper()\n                this.nodes[i].update(sub, delay)\n            } else {\n                this.createTrueNode(i, sub, delay)\n            }\n        })\n\n        while (this.nodes.length !== this.currentSize) {\n            const node = this.nodes.pop()\n            node.destroy(delay)\n        }\n    }\n\n    destroy (delay: Delay) {\n        if (!this.rendered) return\n        super.destroy(delay)\n\n        if (!this.currentSize) {\n            if (this.falseNode) this.falseNode.destroy(delay)\n            return\n        }\n\n        this.currentSize = 0\n        this.nodes.forEach(it => it.destroy(delay))\n        this.nodes = []\n        this.rendered = false\n    }\n}\n","import { Application } from './application'\nimport { Module } from './module'\n\nexport class Loader {\n    protected _app: Application\n    protected _path: string\n    protected _args: any\n\n    constructor(app: Application, path: string, args: any) {\n        this._app = app\n        this._path = path\n        this._args = args\n    }\n\n    load (file, mod: Module): Promise<object> {\n        return this._app.options.getResource(`${this._app.options.scriptRoot}/${this._path}/${file}`)\n    }\n}\n","import {Application} from './application'\n\nexport interface Lifecycle {\n    stage?: string\n    init? (): any\n\n    beforeRender? (): any\n    rendered? (): any\n\n    beforeUpdate? (): any\n    updated? (): any\n\n    beforeDestroy? (): any\n    destroyed? (): any\n}\n\nconst callIt = (ctx: LifecycleContainer, cycles: Lifecycle[], method: string, reverse = false): Promise<any> => {\n    return cycles.filter(it => it[method])[reverse ? 'reduceRight' : 'reduce']((acc, it) => {\n        return acc.then(() => it[method].apply(ctx))\n    }, Promise.resolve())\n}\n\nexport class LifecycleContainer {\n    app: Application\n    private _cycles: Lifecycle[] = []\n\n    constructor (app: Application, options: {cycles?: Lifecycle[]} & Lifecycle, ...args: Lifecycle[]) {\n        this.app = app\n\n        const cs = options.cycles || []\n        cs.push(options)\n        args.forEach(it => it && cs.push(it))\n        cs.forEach(it => !it.stage && (it.stage = 'default'))\n\n        app.options.stages.forEach(s => cs.forEach(c => {\n            if (c.stage === s) this._cycles.push(c)\n        }))\n    }\n\n    protected _doInit () {\n        return callIt(this, this._cycles, 'init')\n    }\n\n    protected _doBeforeRender () {\n        return callIt(this, this._cycles, 'beforeRender')\n    }\n\n    protected _doRendered () {\n        return callIt(this, this._cycles, 'rendered')\n    }\n\n    protected _doBeforeUpdate () {\n        return callIt(this, this._cycles, 'beforeUpdate')\n    }\n\n    protected _doUpdated () {\n        return callIt(this, this._cycles, 'updated')\n    }\n\n    protected _doBeforeDestroy () {\n        return callIt(this, this._cycles, 'beforeDestroy', true)\n    }\n\n    protected _doDestroyed () {\n        return callIt(this, this._cycles, 'destroyed', true)\n    }\n}\n","import { Lifecycle, LifecycleContainer } from './lifecycle'\nimport { Application } from './application'\nimport { Disposable } from './drizzle'\nimport { Node } from './template/node'\nimport { Appendable, ModuleTemplate } from './template/template'\n\nexport interface RenderOptions extends Lifecycle {\n    cycles?: Lifecycle[]\n    state?: object,\n    customEvents?: {[name: string]: (HTMLElement, callback: (any) => void) => Disposable}\n    events?: {[name: string]: (...args) => void}\n    template?: ModuleTemplate\n    computed?: {[name: string]: (any) => any}\n    actions?: {[name: string]: (cb: (data: any) => Promise<any>, data: object) => void}\n}\n\nexport enum ComponentState {\n    CREATED, INITED, RENDERED\n}\n\ninterface Region {\n    item: Renderable<any>\n    show (name: string, state: object): Promise<Renderable<any>>\n    _showNode (nodes: Node[], context: object): Promise<any>\n    _showChildren ()\n    close (): Promise<any>\n}\n\nexport abstract class Renderable<T extends RenderOptions> extends LifecycleContainer {\n    _target: Appendable\n    _options: T\n    ids: {[key: string]: HTMLElement | Renderable<T>} = {}\n    regions: {[key: string]: Region}\n\n    protected _busy: Promise<any> = Promise.resolve()\n    protected _status = ComponentState.CREATED\n\n    constructor(app: Application, options: T, ...args: Lifecycle[]) {\n        super(app, options, ...args)\n        this._options = options\n    }\n\n    _render (target: Appendable) {\n        if (this._status !== ComponentState.INITED) return Promise.resolve()\n\n        this._target = target\n        this._busy = this._busy\n            .then(() => this._doBeforeRender())\n            .then(() => this._doRendered())\n            .then(() => this._status = ComponentState.RENDERED)\n\n        return this._busy\n    }\n\n    destroy () {\n        if (this._status !== ComponentState.RENDERED) return Promise.resolve()\n\n        this._busy = this._busy\n            .then(() => this._doBeforeDestroy())\n            .then(() => this._doDestroyed())\n            .then(() => this._status = ComponentState.INITED)\n\n        return this._busy\n    }\n\n    _init () {\n        return this._busy = this._busy\n            .then(() => this._doInit())\n            .then(() => this._status = ComponentState.INITED)\n    }\n\n    _event (name, ...args: any[]) {\n        const {events} = this._options\n        if (events && events[name]) events[name].apply(this, args)\n    }\n\n    _context () {\n        const c = Object.assign({}, this.get() as {[name: string]: any})\n        if (this._options.computed) {\n            c._computed = this._options.computed\n        }\n        return c\n    }\n\n    _action (name: string, ...data: any[]) {\n        const {actions} = this._options\n        if (actions && actions[name]) {\n            actions[name].call(this, (d: any) => {\n                return this._dispatch(name, d)\n            }, ...data)\n            return\n        }\n\n        this._dispatch(name, data[0])\n    }\n\n    abstract get (name?: string): object\n    abstract _dispatch (name: string, data: any): Promise<any>\n}\n","export interface ModelOptions {\n    url?: string\n    root?: string\n    data: () => any\n    parser?: (data: any) => any\n}\n\nexport class Model {\n    private _options: ModelOptions\n    private _data: any\n\n    constructor(options: ModelOptions) {\n        const opt = typeof options === 'function' ? { data: options} : options\n        this._options = opt\n        this.set(opt.data())\n    }\n\n    set (data: any) {\n        let d = data\n        const {parser, root} = this._options\n        if (parser) d = parser(d)\n        if (root && d) d = d[root]\n\n        this._data = d\n    }\n\n    get () {\n        // clone it or make it readonly in dev mode\n        return this._data\n    }\n}\n","import { ModelOptions, Model } from './model'\nimport { Module } from './module'\n\nexport interface StoreOptions {\n    models?: {[key: string]: ModelOptions}\n    actions?: {[key: string]: (payload: any) => void}\n}\n\nexport class Store {\n    private _options: StoreOptions\n    private _models: {[key: string]: Model} = {}\n    private _names: string[] = []\n    private _module: Module\n\n    constructor(mod: Module, options: StoreOptions, updateKey: string) {\n        this._options = options\n        this._module = mod\n        const {models} = options\n        if (models) {\n            this._names = Object.keys(models)\n            this._names.forEach(k => this._models[k] = new Model(models[k]))\n        }\n\n        if (!options.actions) options.actions = {}\n        options.actions[updateKey] = data => {\n            this.set(data)\n        }\n    }\n\n    fire (name: string, data: any) {\n        this._module.fire(name, data)\n    }\n\n    get models () {\n        return this._models\n    }\n\n    get (name?: string) {\n        if (name) return this._models[name].get()\n\n        return this._names.reduce((acc: {[key: string]: any}, item) => {\n            acc[item] = this._models[item].get()\n            return acc\n        }, {})\n    }\n\n    set (data: object) {\n        this._names.forEach(k => (k in data) && this._models[k].set(data[k]))\n    }\n\n    dispatch (name: string, payload: any): Promise<void> {\n        const {actions} = this._options\n        if (!actions || !actions[name]) return Promise.reject()\n        return Promise.resolve(actions[name].call(this, payload))\n    }\n}\n","import { RenderOptions, Renderable, ComponentState } from './renderable'\nimport { Module } from './module'\nimport { DynamicNode } from './template/dynamic-node'\nimport { Component } from './template/template'\n\nexport interface ViewOptions extends RenderOptions {\n    helpers?: {[name: string]: (...any) => any},\n    components?: {[name: string]: Component}\n}\n\nexport interface BindingGroup {\n    type: 'checkbox' | 'radio'\n    busy: boolean\n    items: DynamicNode[]\n}\n\nexport class View extends Renderable<ViewOptions> {\n    _module: Module\n    _groups: {[name: string]: BindingGroup} = {}\n    _state: object = {}\n\n    constructor(mod: Module, options: ViewOptions) {\n        super(mod.app, options, options.template && options.template.createLife())\n        this._module = mod\n    }\n\n    get regions () {\n        return this._module.regions\n    }\n\n    _init () {\n        if (this._options.state) this.set(this._options.state, true)\n        return super._init()\n    }\n\n    get (key?: string) {\n        if (!key) return this._state\n\n        if (this._options.computed && this._options.computed[key]) {\n            return this._options.computed[key](this._state)\n        }\n\n        return this._state[key]\n    }\n\n    set (data: object, silent: boolean = false) {\n        if (silent || this._status !== ComponentState.RENDERED) {\n            Object.assign(this._state, data)\n            return Promise.resolve()\n        }\n\n        this._busy = this._busy\n            .then(() => this._doBeforeUpdate())\n            .then(() => Object.assign(this._state, data))\n            .then(() => this._doUpdated())\n\n        return this._busy\n    }\n\n    _dispatch (name: string, data: any) {\n        return this._module._dispatch(name, data)\n    }\n}\n","import { Module } from './module'\n\ninterface DefaultHandler {\n    enter (args: object): Promise<Router>\n    update? (args: object): Promise<any>\n    leave? (): Promise<any>\n}\n\ninterface ActionHandler {\n    action: string\n}\n\ninterface ModuleHandler {\n    ref: string\n    region?: string\n    model?: string\n}\n\ntype Handler = DefaultHandler | ActionHandler | ModuleHandler | string\n\nexport interface RouteOptions {\n    [route: string]: Handler\n}\n\ninterface MatchResult {\n    remain: string[]\n    args?: object\n}\n\n// /name\nclass Token {\n    protected key: string\n    protected next: Token\n    protected v = 9\n\n    constructor(key: string, next: Token) {\n        this.key = key\n        this.next = next\n    }\n\n    match (keys: string[]): MatchResult | false {\n        const c = keys[0]\n        if (!c) return false\n        return this.doMatch(c, keys.slice(1))\n    }\n\n    value (v: number = 0): number {\n        const vv = v + this.v\n        return this.next ? this.next.value(vv * 10) : vv\n    }\n\n    protected doMatch (key: string, keys: string[]) {\n        if (key !== this.key) return false\n        if (this.next) return this.next.match(keys)\n        return {remain: keys}\n    }\n}\n\n// /:name\nclass ArgToken extends Token {\n    v = 8\n    doMatch (key: string, keys: string[]) {\n        const oo = {[this.key]: key}\n        if (!this.next) return {remain: keys, args: oo}\n\n        const o = this.next.match(keys)\n        if (o === false) return false\n\n        o.args ? Object.assign(o.args, oo) : (o.args = oo)\n        return o\n    }\n}\n\n// /*name\nclass AllToken extends Token {\n    v = 7\n    match (keys: string[]) {\n        if (!keys.length) return false\n        return { args: {[this.key]: keys}, remain: []}\n    }\n}\n\nconst create = (path) => {\n    const ts = path.trim().split('/').filter(it => !!it)\n    return ts.reduceRight((acc, item) => {\n        if (item.charAt(0) === '*') return new AllToken(item.slice(1), acc)\n        if (item.charAt(0) === ':') return new ArgToken(item.slice(1), acc)\n        return new Token(item, acc)\n    }, null)\n}\n\nexport class Router {\n    private _module: Module\n    private _keys: Token[] = []\n    private _defs: DefaultHandler[] = []\n    private _currentKey: number = -1\n    private _next: Router\n\n    constructor (module: Module, routes: RouteOptions) {\n        this._module = module\n        this.initRoutes(routes)\n    }\n\n    route (keys: string[]) {\n        for (let i = 0; i < this._keys.length; i ++) {\n            const re = this._keys[i].match(keys)\n            if (re) return this.doRoute(i, re)\n        }\n        return Promise.resolve(false)\n    }\n\n    private leave (): Promise<any> {\n        return Promise.resolve().then(() => {\n            if (this._next) return this._next.leave()\n        }).then(() => {\n            const h = this._defs[this._currentKey]\n            if (h && h.leave) return h.leave()\n        })\n    }\n\n    private enter (idx: number, args: object, keys: string[]) {\n        this._currentKey = idx\n        return this._defs[idx].enter(args).then(it => {\n            this._next = it\n            if (it && keys.length) return it.route(keys)\n        })\n    }\n\n    private doRoute (idx: number, result: MatchResult): Promise<any> {\n        const h = this._defs[idx]\n        if (this._currentKey === -1) {\n            return this.enter(idx, result.args, result.remain)\n        }\n        if (idx === this._currentKey) {\n            return Promise.resolve().then(() => {\n                if (h.update) return h.update(result.args)\n            }).then(() => {\n                if (this._next) return this._next.route(result.remain)\n            })\n        }\n\n        return this.leave().then(() => {\n            return this.enter(idx, result.args, result.remain)\n        })\n    }\n\n    private initRoutes (routes: RouteOptions) {\n        Object.keys(routes).map(key => {\n            return { key, token: create(key) }\n        }).sort((a, b) => b.token.value() - a.token.value()).forEach(it => {\n            this._keys.push(it.token)\n            this._defs.push(this.createHandler(routes[it.key]))\n        })\n    }\n\n    private createHandler (h: Handler): DefaultHandler {\n        if (typeof h === 'string') return this.createModuleHandler({ref: h})\n        if ('enter' in h) return h as DefaultHandler\n        if ('action' in h) return this.createActionHandler(h as ActionHandler)\n        if ('ref' in h) return this.createModuleHandler(h as ModuleHandler)\n        throw new Error('unsupported router handler')\n    }\n\n    private createActionHandler (h: ActionHandler) {\n        return {\n            enter: (args: object) => {\n                return this._module._dispatch(h.action, args).then(() => null)\n            },\n            update: (args: object) => {\n                return this._module._dispatch(h.action, args)\n            }\n        }\n    }\n\n    private createModuleHandler (h: ModuleHandler) {\n        let item\n        return {\n            enter: (args: object) => {\n                const o = h.model ? {[h.model]: args} : args\n                return this._module.regions[h.region || 'default'].show(h.ref, o).then(it => {\n                    item = it\n                    if (it instanceof Module) return it._router\n                    return null\n                })\n            },\n\n            update: (args: object) => {\n                const o = h.model ? {[h.model]: args} : args\n                if (item && (item instanceof Module)) return item.set(o)\n                return Promise.resolve()\n            }\n        }\n    }\n\n}\n","import { RenderOptions, Renderable, ComponentState } from './renderable'\nimport { StoreOptions, Store } from './store'\nimport { Application } from './application'\nimport { Loader } from './loader'\nimport { View, ViewOptions } from './view'\nimport { Disposable} from './drizzle'\nimport { Router, RouteOptions } from './route'\nimport { Appendable } from './template/template'\n\nexport interface ItemOptions {\n    views?: string[]\n    refs?: string[]\n    modules?: {[name: string]: string}\n}\n\nexport interface ModuleOptions extends RenderOptions {\n    store?: StoreOptions\n    items?: ItemOptions\n    routes?: RouteOptions\n}\n\nconst UPDATE_ACTION = `update${+new Date()}`\n\nconst clone = (target: any) => {\n    if (Array.isArray(target)) {\n        return target.map(it => clone(it))\n    }\n    if (typeof target === 'object') {\n        return Object.keys(target).reduce((acc: any, it) => {\n            acc[it] = clone(target[it])\n            return acc\n        }, {})\n    }\n    return target\n}\n\ninterface ModuleRenference {\n    [name: string]: {\n        loader: string,\n        path: string\n        args?: any\n    }\n}\n\nexport const moduleReferences: ModuleRenference = {}\n\nexport class Module extends Renderable<ModuleOptions> {\n    _items: {[key: string]: {\n        type: 'view' | 'module'\n        options: ModuleOptions | ViewOptions\n        loader: Loader\n    }} = {}\n    _router: Router\n\n    private _store: Store\n    private _handlers: {[name: string]: ((data: any) => void)[]} = {}\n    private _loader: Loader\n    private _extraState: object\n\n    constructor(app: Application, loader: Loader, options: ModuleOptions, extraState: object = {}) {\n        super(app, options, options.template && options.template.createLife())\n        this._loader = loader\n        this._extraState = extraState\n        this.regions = {}\n        if (options.routes) this._router = new Router(this, options.routes)\n    }\n\n    set (data: object) {\n        if (!this._options.template) return\n\n        const {exportedModels} = this._options.template\n        if (!exportedModels || !exportedModels.length) return\n\n        const d = exportedModels.reduce((acc, item) => {\n            if (data[item]) acc[item] = data[item]\n            return acc\n        }, {})\n\n        return this._status === ComponentState.CREATED ?\n            this._store.dispatch(UPDATE_ACTION, d) : this._dispatch(UPDATE_ACTION, d)\n    }\n\n    get (name?: string) {\n        const obj = this._store.get(name)\n\n        // TODO only works in dev mode\n        return clone(obj)\n    }\n\n    on (name: string, handler: (data: any) => void): Disposable {\n        if (!this._handlers[name]) this._handlers[name] = []\n        const hs = this._handlers[name]\n\n        if (hs.indexOf(handler) !== -1) return {dispose: () => {}}\n        hs.push(handler)\n\n        return {\n            dispose: () => {\n                const idx = hs.indexOf(handler)\n                if (idx !== -1) hs.splice(idx, 1)\n            }\n        }\n    }\n\n    fire (name: string, data: any) {\n        if (!this._handlers[name]) return\n        const hs = this._handlers[name].slice()\n        hs.forEach(it => it.call(this, data))\n    }\n\n    _createItem (name: string, state?: object) {\n        const opt = this._items[name]\n        const item = opt.type === 'view' ?\n            new View(this, opt.options) :\n            new Module(this.app, opt.loader, opt.options, state)\n        return item._init().then(() => item)\n    }\n\n    _dispatch (name: string, payload?: any) {\n        this._busy = this._busy\n            .then(() => this._doBeforeUpdate())\n            .then(() => this._store.dispatch(name, payload))\n            .then(() => this._doUpdated())\n\n        return this._busy\n    }\n\n    _render (target: Appendable) {\n        const busy = super._render(target)\n\n        if (busy === this._busy) {\n            this._busy = this._busy.then(() => {\n                const {store} = this._options\n                if (store && store.actions && store.actions.init) {\n                    return this._dispatch('init')\n                }\n            })\n            return this._busy\n        }\n\n        return busy\n    }\n\n    _init () {\n        this._store = new Store(this, this._options.store || {}, UPDATE_ACTION)\n        this.set(Object.assign({}, this._options.state, this._extraState))\n        return this._loadItems().then(() => super._init())\n    }\n\n    private _loadItems (): Promise<any> {\n        const {items} = this._options\n        if (!items) return Promise.resolve()\n\n        let ps: {name: string, type: string, loader: Loader}[] = []\n\n        if (items.views) {\n            ps = ps.concat(items.views.map(it => {\n                return {name: it, type: 'view', loader: this._loader}\n            }))\n        }\n\n        if (items.refs) {\n            ps = ps.concat(items.refs.map(it => {\n                const obj = moduleReferences[it]\n                const loader = this.app.createLoader(obj.path, {name: obj.loader, args: obj.args})\n                return {name: it, type: 'module', loader}\n            }))\n        }\n\n        if (items.modules) {\n            ps = ps.concat(Object.keys(items.modules).map(it => {\n                const path = items.modules[it]\n                const loader = this.app.createLoader(path)\n                return {name: it, type: 'module', loader}\n            }))\n        }\n\n        return Promise.all(ps.map((k, i) => ps[i].loader.load(ps[i].type === 'view' ? ps[i].name : 'index', this)))\n            .then(data => {\n                ps.forEach((p, i) => {\n                    this._items[p.name] = {type: p.type as ('view' | 'module'), loader: p.loader, options: data[i]}\n                })\n            })\n    }\n}\n","import { Loader } from './loader'\nimport { Disposable } from './drizzle'\nimport { Module, ModuleOptions } from './module'\nimport { createAppendable } from './template/template'\n\ninterface ApplicationOptions {\n    stages?: string[],\n    scriptRoot?: string\n    container: HTMLElement,\n    entry: string | ModuleOptions\n    customEvents?: {[name: string]: (HTMLElement, callback: (any) => void) => Disposable},\n    getResource? (path): Promise<object>\n}\n\ninterface LoaderConstructor {\n    new (app: Application, path: string, args?: any): Loader\n}\n\nexport class Application {\n    options: ApplicationOptions\n    loaders: {[name: string]: LoaderConstructor} = {}\n\n    constructor(options: ApplicationOptions) {\n        this.options = Object.assign({\n            stages: ['init', 'template', 'default'],\n            scriptRoot: 'app',\n            entry: 'viewport'\n        }, options)\n\n        this.registerLoader(Loader)\n    }\n\n    registerLoader (loader: LoaderConstructor, name: string = 'default') {\n        this.loaders[name] = loader\n    }\n\n    createLoader (path: string, loader?: {name: string, args?: any}): Loader {\n        if (loader) {\n            return new this.loaders[loader.name](this, path, loader.args)\n        }\n        return new this.loaders.default(this, path)\n    }\n\n    start (): Promise<any> {\n        return this.startViewport().then(item => {\n            console.log(item)\n            this.startRouter(item)\n        })\n    }\n\n    private startViewport () {\n        let loader: Loader\n\n        const {entry, container} = this.options\n        const create = (lo, options) => {\n            const v = new Module(this, lo, options)\n            return v._init().then(() => v._render(createAppendable(container))).then(() => v)\n        }\n        if (typeof entry === 'string') {\n            loader = this.createLoader(entry)\n        } else {\n            return create(this.createLoader(null), entry)\n        }\n\n        return loader.load('index', null).then(opt => create(loader, opt))\n    }\n\n    private startRouter (item: Module) {\n        if (!item._router) return\n        const doIt = () => {\n            const hash = window.location.hash\n            if (hash.slice(0, 2) !== '#/') return\n            const hs = hash.slice(2).split('/').filter(it => !!it)\n            if (!hs.length) return\n            item._router.route(hs).then(it => {\n                console.log(it)\n            })\n        }\n\n        window.addEventListener('popstate', doIt)\n        doIt()\n    }\n}\n","const ps: [string, number | string, string[] | number][] = [\n    ['accept', 0, ['form', 'input']],\n    ['accept-charset', 'acceptCharset', ['form']],\n    ['accesskey', 'accessKey', 0],\n    ['action', 0, ['form']],\n    ['align', 0, [\n        'applet', 'caption', 'col', 'colgroup', 'hr', 'iframe',\n        'img', 'table', 'tbody', 'td', 'tfoot', 'th', 'thead', 'tr']\n    ],\n    ['allowfullscreen', 'allowFullscreen', ['iframe']],\n    ['alt', 0, ['applet', 'area', 'img', 'input']],\n    ['async', 0, ['script']],\n    ['autocomplete', 0, ['form', 'input']],\n    ['autofocus', 0, ['button', 'input', 'keygen', 'select', 'textarea']],\n    ['autoplay', 0, ['audio', 'video']],\n    ['autosave', 0, ['input']],\n    ['bgcolor', 'bgColor', ['body', 'col', 'colgroup', 'marquee', 'table', 'tbody', 'tfoot', 'td', 'th', 'tr']],\n    ['border', 0, ['img', 'object', 'table']],\n    ['buffered', 0, ['audio', 'video']],\n    ['challenge', 0, ['keygen']],\n    ['charset', 0, ['meta', 'script']],\n    ['checked', 0, ['command', 'input']],\n    ['cite', 0, ['blockquote', 'del', 'ins', 'q']],\n    ['class', 'className', 0],\n    ['code', 0, ['applet']],\n    ['codebase', 'codeBase', ['applet']],\n    ['color', 0, ['basefont', 'font', 'hr']],\n    ['cols', 0, ['textarea']],\n    ['colspan', 'colSpan', ['td', 'th']],\n    ['content', 0, ['meta']],\n    ['contenteditable', 'contentEditable', 0],\n    ['contextmenu', 0, 0],\n    ['controls', 0, ['audio', 'video']],\n    ['coords', 0, ['area']],\n    ['data', 0, ['object']],\n    ['datetime', 'dateTime', ['del', 'ins', 'time']],\n    ['default', 0, ['track']],\n    ['defer', 0, ['script']],\n    ['dir', 0, 0],\n    ['dirname', 'dirName', ['input', 'textarea']],\n    ['disabled', 0, ['button', 'command', 'fieldset', 'input', 'keygen', 'optgroup', 'option', 'select', 'textarea']],\n    ['download', 0, ['a', 'area']],\n    ['draggable', 0, 0],\n    ['dropzone', 0, 0],\n    ['enctype', 0, ['form']],\n    ['for', 'htmlFor', ['label', 'output']],\n    ['form', 0, [\n        'button', 'fieldset', 'input', 'keygen', 'label',\n        'meter', 'object', 'output', 'progress', 'select', 'textarea']\n    ],\n    ['formaction', 0, ['input', 'button']],\n    ['headers', 0, ['td', 'th']],\n    ['height', 0, ['canvas', 'embed', 'iframe', 'img', 'input', 'object', 'video']],\n    ['hidden', 0, 0],\n    ['high', 0, ['meter']],\n    ['href', 0, ['a', 'area', 'base', 'link']],\n    ['hreflang', 0, ['a', 'area', 'link']],\n    ['http-equiv', 'httpEquiv', ['meta']],\n    ['icon', 0, ['command']],\n    ['id', 0, 0],\n    ['indeterminate', 0, ['input']],\n    ['ismap', 'isMap', ['img']],\n    ['itemprop', 0, 0],\n    ['keytype', 0, ['keygen']],\n    ['kind', 0, ['track']],\n    ['label', 0, ['track']],\n    ['lang', 0, 0],\n    ['language', 0, ['script']],\n    ['loop', 0, ['audio', 'bgsound', 'marquee', 'video']],\n    ['low', 0, ['meter']],\n    ['manifest', 0, ['html']],\n    ['max', 0, ['input', 'meter', 'progress']],\n    ['maxlength', 'maxLength', ['input', 'textarea']],\n    ['media', 0, ['a', 'area', 'link', 'source', 'style']],\n    ['method', 0, ['form']],\n    ['min', 0, ['input', 'meter']],\n    ['multiple', 0, ['input', 'select']],\n    ['muted', 0, ['audio', 'video']],\n    ['name', 0, [\n        'button', 'form', 'fieldset', 'iframe', 'input', 'keygen',\n        'object', 'output', 'select', 'textarea', 'map', 'meta', 'param']\n    ],\n    ['novalidate', 'noValidate', ['form']],\n    ['open', 0, ['details']],\n    ['optimum', 0, ['meter']],\n    ['pattern', 0, ['input']],\n    ['ping', 0, ['a', 'area']],\n    ['placeholder', 0, ['input', 'textarea']],\n    ['poster', 0, ['video']],\n    ['preload', 0, ['audio', 'video']],\n    ['radiogroup', 0, ['command']],\n    ['readonly', 'readOnly', ['input', 'textarea']],\n    ['rel', 0, ['a', 'area', 'link']],\n    ['required', 0, ['input', 'select', 'textarea']],\n    ['reversed', 0, ['ol']],\n    ['rows', 0, ['textarea']],\n    ['rowspan', 'rowSpan', ['td', 'th']],\n    ['sandbox', 0, ['iframe']],\n    ['scope', 0, ['th']],\n    ['scoped', 0, ['style']],\n    ['seamless', 0, ['iframe']],\n    ['selected', 0, ['option']],\n    ['shape', 0, ['a', 'area']],\n    ['size', 0, ['input', 'select']],\n    ['sizes', 0, ['link', 'img', 'source']],\n    ['span', 0, ['col', 'colgroup']],\n    ['spellcheck', 0, 0],\n    ['src', 0, ['audio', 'embed', 'iframe', 'img', 'input', 'script', 'source', 'track', 'video']],\n    ['srcdoc', 0, ['iframe']],\n    ['srclang', 0, ['track']],\n    ['srcset', 0, ['img']],\n    ['start', 0, ['ol']],\n    ['step', 0, ['input']],\n    ['summary', 0, ['table']],\n    ['tabindex', 'tabIndex', 0],\n    ['target', 0, ['a', 'area', 'base', 'form']],\n    ['title', 0, 0],\n    ['type', 0, ['button', 'command', 'embed', 'object', 'script', 'source', 'style', 'menu']],\n    ['usemap', 'useMap', ['img', 'input', 'object']],\n    ['value', 0, ['button', 'option', 'input', 'li', 'meter', 'progress', 'param', 'select', 'textarea']],\n    ['volume', 0, ['audio', 'video']],\n    ['width', 0, ['canvas', 'embed', 'iframe', 'img', 'input', 'object', 'video']],\n    ['wrap', 0, ['textarea']]\n]\n\ninterface Attr {\n    [key: string]: {name: any, tags: {[key: string]: boolean}}\n}\n\nconst attributes: Attr = ps.reduce((acc: Attr, item) => {\n    acc[item[0]] = {\n        name: item[1],\n        tags: item[2] && (item[2] as string[]).reduce((ac, i) => {\n            ac[i] = true\n            return ac\n        }, {})\n    }\n    return acc\n}, {})\n\n// TODO set style, data set\nexport function setAttribute(el: SVGElement | HTMLElement, name: string, value: any) {\n    const n = name.toLowerCase()\n    const t = el.tagName.toLowerCase()\n    if (attributes[n] && attributes[name].tags[t]) {\n        el[attributes[n].name || n] = value\n    } else {\n        el.setAttribute(name, value)\n    }\n}\n","import { Node } from './node'\nimport { Delay } from './template'\nimport { setAttribute } from './attributes'\n\nexport class StaticNode extends Node {\n    name: string\n    attributes: [string, string][]\n\n    constructor(name: string, attributes: [string, string][] = [], id?: string) {\n        super(id)\n        this.name = name\n        this.attributes = attributes\n        if (name === 'svg') this.inSvg = true\n    }\n\n    render (context: object, delay: Delay) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context, delay)\n        this.parent.append(this.element)\n        this.children.forEach(it => it.render(context, delay))\n    }\n\n    update (context: object, delay: Delay) {\n        this.children.forEach(it => it.update(context, delay))\n    }\n\n    destroy (delay: Delay) {\n        if (!this.rendered) return\n        super.destroy(delay)\n\n        this.parent.remove(this.element)\n        this.rendered = false\n    }\n\n    create () {\n        const element = this.inSvg ?\n            document.createElementNS('http://www.w3.org/2000/svg', this.name) :\n            document.createElement(this.name)\n        this.attributes.forEach(it =>  setAttribute(element, it[0], it[1]))\n        return element\n    }\n}\n","import { View, BindingGroup } from '../view'\nimport { getValue, Updatable } from './template'\nimport { DynamicNode } from './dynamic-node'\n\nconst updateSingleKey = (view: View, context: {[name: string]: any}, to: string, value: any) => {\n    if (context._each) {\n        const each = context._each.find(it => it.key === to)\n        if (each) {\n            each.list[each.index] = value\n            view.set({[each.name]: each.list})\n            return\n        }\n    }\n\n    view.set({[to]: value})\n}\n\nconst updateView = (view: View, context: {[name: string]: any}, to: string, value: any) => {\n    const ps = to.split('.')\n    if (ps.length === 1) return updateSingleKey(view, context, to, value)\n\n    const root = ps.shift()\n    const last = ps.pop()\n    const result = {}\n    let obj\n    let isEach = false\n\n    if (context._each) {\n        const each = context._each.find(it => it.key === root)\n        if (each) {\n            const first = context._each[0]\n            result[first.name] = first.list\n\n            obj = each.list[each.index]\n            isEach = true\n        }\n    }\n\n    if (!isEach) {\n        result[root] = context[root]\n        obj = result[root]\n    }\n\n    result[root] = context[root]\n    obj = ps.reduce((acc, it) => acc[it], obj)\n    obj[last] = value\n    view.set(result)\n}\n\nconst bindIt = <T extends HTMLElement>(\n    context: {[name: string]: any}, view: View, to: string, element: T,\n    event: string, get: (T) => any, set: (T, any) => void\n): Updatable => {\n    let current\n    const obj = {context}\n    const cb = function(this: T) {\n        current = get(element)\n        updateView(view, obj.context, to, current)\n    }\n\n    element.addEventListener(event, cb, false)\n\n    const r = {\n        dispose () {\n            element.removeEventListener(event, cb, false)\n        },\n        update (ctx: object) {\n            obj.context = ctx\n            const v = getValue(to, ctx)\n            if (v !== current) {\n                set(element, v)\n                current = v\n            }\n        }\n    }\n\n    r.update(context)\n    return r\n}\n\nconst getSelectValue = (el: HTMLSelectElement) => {\n    const opt = el.options[el.selectedIndex || 0]\n    return opt && opt.value\n}\n\nconst setSelectOption = (el: HTMLSelectElement, value) => {\n    // tslint:disable-next-line:prefer-for-of\n    for (let i = 0; i < el.options.length; i ++) {\n        const opt = el.options[i]\n        if (opt.value === (value + '')) {\n            opt.selected = true\n            return\n        }\n    }\n}\n\nconst bindGroup = (\n    context: {[name: string]: any}, view: View, group: BindingGroup, to: string,\n    element: HTMLInputElement\n): Updatable => {\n    const obj = {context}\n    let current\n    const cb = function(this: HTMLInputElement) {\n        if (group.busy) return\n        current = (group.type === 'radio' ? element.value : group.items\n            .filter(it => (it.element as HTMLInputElement).checked)\n            .map(it => (it.element as HTMLInputElement).value))\n\n        updateView(view, obj.context, to, current)\n    }\n\n    element.addEventListener('change', cb, false)\n\n    const r = {\n        dispose () {\n            element.removeEventListener('change', cb, false)\n        },\n        update (ctx: object) {\n            obj.context = ctx\n            if (group.busy) return\n            const v = getValue(to, ctx)\n            const its = group.items.map(it => (it.element as HTMLInputElement))\n\n            let changed = false\n            if (group.type === 'radio' && v !== current) changed = true\n            if (!changed && group.type === 'checkbox' && (v as any[]).some((it, i) => current[i] !== it)) changed = true\n            if (!changed) return\n\n            if (group.type === 'radio') {\n                its.forEach(it => it.checked = it.value === v + '')\n                return\n            }\n\n            its.forEach(it => it.checked = (v as any[]).some(vv => vv + '' === it.value))\n        }\n    }\n\n    r.update(context)\n    return r\n}\n\nexport const bind = (node: DynamicNode, context: object, from: string, to: string): Updatable => {\n    const tag = node.name.toLowerCase()\n    const element = node.element\n    const view = node.root as View\n    if ((tag === 'input' || tag === 'textarea') && from === 'value') {\n        return bindIt(\n            context, view, to, element, 'input',\n            el => el.value,\n            (el, value) => el.value = value == null ? '' : value\n        )\n    }\n\n    if (tag === 'input' && from === 'checked') {\n        return bindIt(context, view, to, element, 'change', el => el.checked, (el, value) => el.checked = value)\n    }\n\n    if (tag === 'select' && from === 'value') {\n        return bindIt(context, view, to, element, 'change', getSelectValue, setSelectOption)\n    }\n\n    if (tag === 'input' && from === 'group') {\n        const type = (element as HTMLInputElement).type\n        if (type !== 'checkbox' && type !== 'radio') return null\n        return bindGroup(context, view, view._groups[to], to, (element as HTMLInputElement))\n    }\n\n    return null\n}\n","import { StaticNode } from './static-node'\nimport { Helper, DelayTransfomer } from './helper'\nimport { Disposable } from '../drizzle'\nimport { View } from '../view'\nimport { bind } from './binding'\nimport {\n    Delay, Attribute, ChangeType, resolveEventArgument,\n    Updatable, customEvents, ComponentHook, components\n} from './template'\nimport { Renderable } from '../renderable'\nimport { setAttribute } from './attributes'\n\nexport class DynamicNode extends StaticNode {\n    dynamicAttributes: {[name: string]: Helper[]} = {}\n    components: {[name: string]: Helper[]} = {}\n    events: {[event: string]: {method: string, args: Attribute[]}} = {}\n    actions: {[event: string]: {method: string, args: Attribute[]}} = {}\n    bindings: [string, string][] = []\n\n    eventHooks: Disposable[]\n    actionHooks: Disposable[]\n    bindingHooks: Updatable[]\n    componentHooks: [string, ComponentHook][]\n\n    context: object\n\n    attribute (name: string, helpers: Helper[]) {\n        this.dynamicAttributes[name] = helpers\n    }\n\n    on (event: string, method: string, args: Attribute[] = []) {\n        this.events[event] = {method, args}\n    }\n\n    action (event: string, method: string, args: Attribute[] = []) {\n        this.actions[event] = {method, args}\n    }\n\n    bind (from: string, to: string) {\n        this.bindings.push([from, to])\n    }\n\n    component (name: string, helpers: Helper[]) {\n        this.components[name] = helpers\n    }\n\n    init (root: Renderable<any>, delay: Delay) {\n        super.init(root, delay)\n        if (!(this.root instanceof View)) return\n\n        const view = this.root\n\n        this.bindings.forEach(([from, to]) => {\n            if (from !== 'group' || this.name.toLowerCase() !== 'input') return\n            const attr = this.attributes.find(it => it[0].toLowerCase() === 'type')\n            if (!attr) return\n            const type = attr[1].toLowerCase()\n            if (type !== 'checkbox' && type !== 'radio') return\n\n            const groups = view._groups\n            if (!groups[to]) groups[to] = {type, items: [], busy: false}\n            else if (groups[to].type !== type) {\n                throw Error('binding group can not mix up checkbox and radio')\n            }\n            groups[to].items.push(this) // TODO if this item is hidden by if, should it works?\n        })\n\n        Object.keys(this.dynamicAttributes).forEach(k => {\n            this.dynamicAttributes[k].forEach(it => {\n                if (it instanceof DelayTransfomer) it.init(view)\n            })\n        })\n\n        Object.keys(this.components).forEach(k => this.components[k].forEach(it => {\n            if (it instanceof DelayTransfomer) it.init(view)\n        }))\n    }\n\n    render (context: object, delay: Delay) {\n        if (this.rendered) return\n        super.render(context, delay)\n        this.updateAttributes(context)\n\n        this.context = context\n        this.eventHooks = Object.keys(this.events).map(it =>\n            this.initEvent(it, this.events[it].method, this.events[it].args)\n        )\n        this.actionHooks = Object.keys(this.actions).map(it =>\n            this.initAction(it, this.actions[it].method, this.actions[it].args)\n        )\n        this.bindingHooks = this.bindings.map(it => bind(this, context, it[0], it[1])).filter(it => !!it)\n\n        this.componentHooks = Object.keys(this.components).map(it => {\n            const comp = (this.root as View)._options.components || {}\n            const fn = comp[it] || components[it]\n            if (!fn) {\n                throw new Error(`Component ${it} is not found.`)\n            }\n            const vs = this.renderHelper(context, this.components[it])\n            const hook = fn(this.element, ...vs[1])\n            return [it, hook] as [string, ComponentHook]\n        })\n    }\n\n    initEvent (name: string, method: string, args: Attribute[]): Disposable {\n        const me = this\n        const cb = function(this: HTMLElement, event) {\n            const as = resolveEventArgument(this, me.context, args, event)\n            me.root._event(method, ...as)\n        }\n\n        return this.bindEvent(name, cb)\n    }\n\n    initAction (name: string, action: string, args: Attribute[]): Disposable {\n        if (!(this.root instanceof View)) return\n        const me = this\n\n        const cb = function(this: HTMLElement, event) {\n            const data = resolveEventArgument(this, me.context, args, event)\n            const root = (me.root as View)\n            root._action(action, ...data)\n        }\n\n        return this.bindEvent(name, cb)\n    }\n\n    bindEvent (name: string, cb: (event: any) => void): Disposable {\n        let ce = this.root._options.customEvents\n        if (!ce || !ce[name]) ce = this.root.app.options.customEvents\n        if (!ce || !ce[name]) ce = customEvents\n        if (ce && ce[name]) {\n            return ce[name](this.element, cb)\n        }\n\n        this.element.addEventListener(name, cb, false)\n        return {\n            dispose: () => {\n                this.element.removeEventListener(name, cb, false)\n            }\n        }\n    }\n\n    updateAttributes (context: object) {\n        Object.keys(this.dynamicAttributes).forEach(it => {\n            const vs = this.renderHelper(context, this.dynamicAttributes[it])\n            if (vs[0] === ChangeType.CHANGED) {\n                const vvs = vs[1].filter(v => v != null)\n                if (vvs.length === 1) {\n                    setAttribute(this.element, it, vvs[0])\n                } else {\n                    const v = it === 'class' ? vvs.join(' ') : vvs.join('')\n                    setAttribute(this.element, it, v)\n                }\n            }\n        })\n    }\n\n    renderHelper (context: object, helpers: Helper[]) {\n        const vs = helpers.map(it => it.render(context))\n        if (vs.some(i => i[0] === ChangeType.CHANGED)) {\n            return [ChangeType.CHANGED, vs.map(it => it[1])] as [ChangeType, any[]]\n        }\n        return [ChangeType.NOT_CHANGED, null] as [ChangeType, any[]]\n    }\n\n    update (context: object, delay: Delay) {\n        if (!this.rendered) return\n\n        this.updateAttributes(context)\n        this.context = context\n        this.bindingHooks.forEach(it => it.update(context))\n        this.children.forEach(it => it.update(context, delay))\n        this.componentHooks.forEach(([name, hook]) => {\n            const vs = this.renderHelper(context, this.components[name])\n            if (vs[0] === ChangeType.NOT_CHANGED) return\n            hook.update(...vs[1])\n        })\n    }\n\n    destroy (delay: Delay) {\n        if (!this.rendered) return\n        super.destroy(delay)\n\n        this.bindingHooks.forEach(it => it.dispose())\n        this.actionHooks.forEach(it => it.dispose())\n        this.eventHooks.forEach(it => it.dispose())\n        this.componentHooks.forEach(it => it[1].dispose())\n\n        this.bindingHooks = []\n        this.actionHooks = []\n        this.eventHooks = []\n        this.componentHooks = []\n    }\n\n    clearHelper () {\n        Object.keys(this.dynamicAttributes).forEach(it => this.dynamicAttributes[it].forEach(h => h.clear()))\n        super.clearHelper()\n    }\n}\n","import { Delay, ChangeType } from './template'\nimport { Helper, DelayTransfomer } from './helper'\nimport { Renderable } from '../renderable'\nimport { View } from '../view'\nimport { Node } from './node'\n\nclass StaticTextNode extends Node {\n    data: string\n    node: Text\n\n    constructor (data: string = '') {\n        super()\n        this.data = data\n        this.node = document.createTextNode(this.data)\n    }\n\n    render (context: object, delay: Delay) {\n        if (this.rendered) return\n        this.rendered = true\n        this.parent.append(this.node)\n    }\n\n    destroy (delay: Delay) {\n        if (!this.rendered) return\n        super.destroy(delay)\n        this.parent.remove(this.node)\n        this.rendered = false\n    }\n}\n\nclass DynamicTextNode extends StaticTextNode {\n    helper: Helper\n\n    constructor(helper: Helper) {\n        super()\n        this.helper = helper\n    }\n\n    init (root: Renderable<any>) {\n        if (root instanceof View && this.helper instanceof DelayTransfomer) {\n            this.helper.init(root)\n        }\n    }\n\n    render (context: object, delay: Delay) {\n        super.render(context, delay)\n        this.update(context, delay)\n    }\n\n    update (context: object, delay: Delay) {\n        const r = this.helper.render(context)\n        if (r[0] === ChangeType.CHANGED) {\n            this.node.data = r[1] == null ? '' : r[1]\n        }\n    }\n\n    clearHelper () {\n        this.helper.clear()\n        super.clearHelper()\n    }\n}\n\nexport class TextNode extends Node {\n    nodes: Node[]\n\n    constructor (...args: (string | Helper)[]) {\n        super()\n        this.nodes = args.map(it => {\n            return (typeof it === 'string') ? new StaticTextNode(it) : new DynamicTextNode(it)\n        })\n    }\n\n    init (root: Renderable<any>, delay: Delay) {\n        this.nodes.forEach(it => {\n            it.parent = this.parent\n            it.init(root, delay)\n        })\n    }\n\n    render (context: object, delay: Delay) {\n        this.nodes.forEach(it => {\n            if (!it.parent) it.parent = this.parent\n            it.render(context, delay)\n        })\n    }\n\n    update (context: object, delay: Delay) {\n        this.nodes.forEach(it => it.update(context, delay))\n    }\n\n    destroy (delay: Delay) {\n        this.nodes.forEach(it => it.destroy(delay))\n    }\n\n    clearHelper () {\n        this.nodes.forEach(it => it.clearHelper())\n    }\n}\n","import { Node } from './node'\nimport { Renderable } from '../renderable'\nimport { Delay, Attribute, resolveEventArgument, getValue } from './template'\nimport { Module } from '../module'\nimport { View } from '../view'\nimport { StaticNode } from './static-node'\nimport { Disposable } from '../drizzle'\nimport { AnchorNode } from './anchor-node'\n\ninterface BindResult {\n    fn: (any) => void\n    event: string\n}\n\nexport class ReferenceNode extends AnchorNode {\n    name: string\n    item: Module | View\n    events: {[event: string]: {method: string, args: Attribute[]}} = {}\n    actions: {[event: string]: {method: string, args: Attribute[]}} = {}\n    bindings: [string, string][] = []\n    grouped: {[name: string]: Node[]} = {}\n    statics: {[name: string]: any} = {}\n\n    hooks: Disposable[] = []\n    context: object\n\n    constructor(name: string, statics: {[name: string]: any}, id?: string) {\n        super(id)\n        this.name = name\n        this.statics = statics\n    }\n\n    bind (from: string, to?: string) {\n        this.bindings.push([from, to || from])\n    }\n\n    on (event: string, method: string, args: Attribute[]) {\n        this.events[event] = {method, args}\n    }\n\n    action (event: string, method: string, args: Attribute[]) {\n        this.actions[event] = {method, args}\n    }\n\n    init (root: Renderable<any>, delay: Delay) {\n        this.root = root\n        const fn = (i: Module | View) => {\n            this.item = i\n            if (this.id) root.ids[this.id] = i\n        }\n        if (root instanceof View) {\n            delay.add(root._module._createItem(this.name, this.statics).then(fn))\n        } else {\n            delay.add((root as Module)._createItem(this.name, this.statics).then(fn))\n        }\n\n        this.children.forEach(it => {\n            let name = 'default'\n            if (it instanceof StaticNode) {\n                const attr = (it.attributes as [string, string][]).find(n => n[0] === 'region')\n                if (attr) name = attr[1]\n            }\n\n            it.init(root, delay)\n            if (!this.grouped[name]) this.grouped[name] = []\n            this.grouped[name].push(it)\n        })\n    }\n\n    render (context: object, delay: Delay) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context, delay)\n        delay.add(this.item.set(this.bindings.reduce((acc, item) => {\n            acc[item[1]] = getValue(item[0], context)\n            return acc\n        }, {})))\n        delay.add(this.item._render(this.newParent).then(() => {\n            return Promise.all(Object.keys(this.grouped).map(k => {\n                if (!this.item.regions[k]) return\n                return this.item.regions[k]._showNode(this.grouped[k], context)\n            }).concat(Object.keys(this.item.regions).map(it => {\n                if (!this.grouped[it] || !this.grouped[it].length) return this.item.regions[it]._showChildren()\n            })))\n        }))\n\n        this.context = context\n        let cbs = []\n        if (this.item instanceof Module) {\n            const m = this.item\n            cbs = cbs.concat(this.bindEvents(this.root, m, context))\n            cbs = cbs.concat(this.bindActions(this.root, m, context))\n\n            this.hooks = cbs.map(it => m.on(it.event, it.fn))\n        }\n    }\n\n    bindEvents (root: Renderable<any>, target: Module, context: object): BindResult[] {\n        const me = this\n        const obj = {context}\n\n        return Object.keys(this.events).map(it => {\n            const cb = function (this: Module, event: any) {\n                const data = resolveEventArgument(this, obj.context, me.events[it].args, event)\n                root._event(me.events[it].method, ...data)\n            }\n            return {fn: cb, event: it, update: (ctx) => obj.context = ctx}\n        })\n    }\n\n    bindActions (root: Renderable<any>, target: Module, context: object): BindResult[] {\n        const me = this\n\n        return Object.keys(this.actions).map(it => {\n            const cb = function(this: Module, event: any) {\n                const data = resolveEventArgument(this, me.context, me.actions[it].args, event)\n                root._action(me.actions[it].method, ...data)\n            }\n            return {fn: cb, event: it}\n        })\n    }\n\n    update (context: object, delay: Delay) {\n        delay.add(this.item.set(this.bindings.reduce((acc, item) => {\n            acc[item[1]] = getValue(item[0], context)\n            return acc\n        }, {})))\n\n        this.context = context\n        this.children.forEach(it => it.update(context, delay))\n    }\n\n    destroy (delay: Delay) {\n        if (!this.rendered) return\n        super.destroy(delay)\n\n        delay.add(this.item.destroy())\n        this.hooks.forEach(it => it.dispose())\n        this.hooks = []\n        delay.add(Promise.all(Object.keys(this.grouped).map(it => {\n            if (!this.item.regions[it]) return\n            return this.item.regions[it].close()\n        })))\n        this.rendered = false\n    }\n\n}\n","import { Node } from './node'\nimport { Delay } from './template'\nimport { Renderable } from '../renderable'\nimport { Module } from '../module'\nimport { View } from '../view'\n\nexport class RegionNode extends Node {\n    nodes: Node[]\n    item: Renderable<any>\n    context: object\n    mod: Module\n    isChildren = false\n\n    constructor(id: string = 'default') {\n        super()\n        this.id = id\n    }\n\n    init (root: Renderable<any>, delay: Delay) {\n        this.root = root\n        this.mod = (root instanceof Module) ? root : (root as View)._module\n        this.children.forEach(it => {\n            it.parent = this.parent\n            it.init(root, delay)\n        })\n\n        const me = this\n        this.mod.regions[this.id] = {\n            get item () {\n                return me.item\n            },\n            show (name: string, state: object): Promise<any> {\n                me.isChildren = false\n                return me.show(name, state)\n            },\n            _showNode (nodes: Node[], context: object): Promise<any> {\n                me.isChildren = false\n                return me.showNode(nodes, context)\n            },\n            _showChildren () {\n                if (!me.context) return Promise.resolve()\n                me.isChildren = true\n                return this._showNode(me.children, me.context)\n            },\n            close () {\n                me.isChildren = false\n                return me.close()\n            }\n        }\n    }\n\n    render (context: object, delay: Delay) {\n        if (this.rendered) return\n\n        this.rendered = true\n        this.context = context\n        if (this.isChildren) this.nodes.forEach(it => it.render(context, delay))\n    }\n\n    update (context: object, delay: Delay) {\n        if (!this.rendered) return\n        this.context = context\n        if (this.isChildren) this.nodes.forEach(it => it.update(context, delay))\n    }\n\n    destroy (delay: Delay) {\n        if (!this.rendered) return\n        if (this.nodes) this.nodes.forEach(it => it.destroy(delay))\n        if (this.item) delay.add(this.item.destroy())\n        this.rendered = false\n    }\n\n    showNode (nodes: Node[], context: object): Promise<any> {\n        if (!this.rendered) return\n        return this.close().then(() => {\n            this.nodes = nodes\n            return Delay.also(d => this.nodes.forEach(it => {\n                it.parent = this.parent\n                it.render(context, d)\n            }))\n        })\n    }\n\n    show (name: string, state: object) {\n        if (!this.rendered) return\n        return this.close().then(() => this.mod._createItem(name, state)).then(item => {\n            this.item = item\n            return item._render(this.parent).then(() => item)\n        })\n    }\n\n    close (show = false): Promise<any> {\n        if (!this.nodes && !this.item) return Promise.resolve()\n        return Promise.resolve().then(() => {\n            if (this.nodes) return Delay.also(d => this.nodes.forEach(it => it.destroy(d)))\n        }).then(() => {\n            if (this.item) return this.item.destroy()\n        }).then(() => {\n            this.nodes = null\n            this.item = null\n        })\n    }\n}\n","import {\n    IfHelper, UnlessHelper, Helper, DelayTransfomer, ConcatHelper, EchoHelper\n} from './template/helper'\nimport { IfBlock, UnlessBlock } from './template/if-block'\nimport { EachBlock } from './template/each-block'\nimport { Loader } from './loader'\nimport { customEvents, components, Attribute, AttributeValue, ModuleTemplate, ViewTemplate } from './template/template'\nimport { Application } from './application'\nimport { StaticNode } from './template/static-node'\nimport { DynamicNode } from './template/dynamic-node'\nimport { TextNode } from './template/text-node'\nimport { ReferenceNode } from './template/reference-node'\nimport { RegionNode } from './template/region-node'\nimport { Node } from './template/node'\n\nexport interface Disposable {\n    dispose (): void\n}\n\nconst helpers = {\n    echo: EchoHelper, if: IfHelper, unless: UnlessHelper, concat: ConcatHelper\n}\n\nconst blocks = {\n    if: IfBlock, unless: UnlessBlock, each: EachBlock\n}\n\nconst loaders = {\n    default: Loader\n}\n\nconst SN = (name: string, id: string, ...attributes: [string, string][]) => {\n    return new StaticNode(name, attributes || [], id)\n}\nconst DN = (name: string, id: string, ...attributes: [string, string][]) => {\n    return new DynamicNode(name, attributes || [], id)\n}\nconst DA = (d: DynamicNode, name: string, ...hs: Helper[]) => {\n    d.attribute(name, hs)\n}\nconst BD = (d: DynamicNode | ReferenceNode, from: string, to: string) => {\n    d.bind(from, to)\n}\nconst EV = (d: DynamicNode | ReferenceNode, event: string, method: string, ...attrs: Attribute[]) => {\n    d.on(event, method, attrs)\n}\nconst AC = (d: DynamicNode | ReferenceNode, event: string, method: string, ...attrs: Attribute[]) => {\n    d.action(event, method, attrs)\n}\nconst CO = (d: DynamicNode, name: string, ...hs: Helper[]) => {\n    d.component(name, hs)\n}\n\nconst TX = (...ss: (string | Helper)[]) => new TextNode(...ss)\nconst RG = (id: string = 'default') => new RegionNode(id)\nconst REF = (name: string, statics: [string, any][], id: string) => {\n    const ss = statics.reduce((acc, it) => {\n        acc[it[0]] = it[1]\n        return acc\n    }, {})\n    return new ReferenceNode(name, ss, id)\n}\n\nconst NDA = (v: string) => [null, [1, v]] as Attribute\nconst NSA = (v: string) => [null, [0, v]] as Attribute\n\nconst SV = (v: string) => [0, v] as AttributeValue\nconst DV = (v: string) => [1, v] as AttributeValue\nconst AT = (n: string, v: AttributeValue) => [n, v] as Attribute\nconst KV = (k: string, v?: string) => [k, v || k]\n\nconst H = (n: string | AttributeValue) => Array.isArray(n) ? new EchoHelper(n) : new EchoHelper(DV(n))\nconst HH = (n: string, ...args: AttributeValue[]) => {\n    if (helpers[n]) return new helpers[n](...args)\n    return new DelayTransfomer(n, ...args)\n}\nconst HIF = (...args: AttributeValue[]) => HH('if', ...args)\nconst HUN = (...args: AttributeValue[]) => HH('unless', ...args)\n\nconst EACH = (args: string[], trueNode: () => Node, falseNode?: Node) => new EachBlock(args, trueNode, falseNode)\nconst IF = (n: string, trueNode: Node, falseNode?: Node) => new IfBlock([DV(n)], trueNode, falseNode)\nconst IFC = (args: AttributeValue[], trueNode: Node, falseNode?: Node) => new IfBlock(args, trueNode, falseNode)\nconst UN = (n: string, trueNode: Node, falseNode?: Node) => new UnlessBlock([DV(n)], trueNode, falseNode)\nconst C = (parent: Node, ...children: Node[]) => parent.setChildren(children)\n\nexport default {\n    helpers, blocks, loaders, customEvents, components,\n    lifecycles: {module: [], view: []},\n    ModuleTemplate, ViewTemplate, Application, Loader,\n    factory: {\n        SN, DN, TX, RG, REF, NDA, NSA, SV, DV, AT, KV, H, HH, HIF, HUN,\n        EACH, IF, IFC, UN, C, DA, BD, EV, AC, CO\n    }\n}\n"],"names":["ValueType","ChangeType","createAppendable","target","remove","el","removeChild","append","appendChild","before","anchor","insertBefore","Delay","Promise","resolve","p","busy","then","fn","d","execute","getValue","key","context","ks","split","first","shift","ctx","_computed","length","reduce","acc","item","getAttributeValue","attr","STATIC","resolveEventArgument","me","args","event","values","map","name","v","it","slice","obj","result","keys","forEach","i","push","customEvents","enter","node","cb","ee","e","keyCode","preventDefault","call","addEventListener","dispose","removeEventListener","escape","components","Template","o","stage","nodes","init","creator","also","beforeRender","parent","_target","render","_context","updated","update","destroyed","destroy","ViewTemplate","ModuleTemplate","exportedModels","Node","id","root","delay","element","create","a","children","ids","inSvg","setToSvg","clearHelper","AnchorNode","document","createComment","newParent","MNode","Compare","eq","v1","v2","ne","gt","lt","gte","lte","IfBlock","trueNode","falseNode","useSingle","useCompare","Error","op","rendered","current","use","UnlessBlock","Helper","dynamicKeys","filter","DYNAMIC","check","currentValues","CHANGED","renderIt","vs","currentKeys","some","NOT_CHANGED","idx","arg","numbers","join","doRender","Transfromer","apply","DelayTransfomer","helpers","_options","EchoHelper","ConcatHelper","IfHelper","assertCount","assertDynamic","useMultiple","UnlessHelper","EachBlock","list","Array","isArray","Object","assign","_each","index","isEmpty","renderElse","kv","renderKeyValue","n","arr","currentSize","sub","createTrueNode","empty","updateElse","updateKeyValue","pop","Loader","app","path","_app","_path","_args","file","mod","options","getResource","scriptRoot","callIt","cycles","method","reverse","LifecycleContainer","cs","stages","c","s","_cycles","ComponentState","Renderable","CREATED","_status","INITED","_busy","_doBeforeRender","_doRendered","RENDERED","_doBeforeDestroy","_doDestroyed","_doInit","events","get","computed","actions","data","_dispatch","Model","opt","set","parser","_data","Store","updateKey","_module","models","_names","_models","k","fire","payload","reject","View","template","createLife","state","_state","silent","_doBeforeUpdate","_doUpdated","regions","Token","next","doMatch","vv","value","match","remain","ArgToken","oo","AllToken","ts","trim","reduceRight","charAt","Router","module","routes","initRoutes","_keys","re","doRoute","_next","leave","h","_defs","_currentKey","route","token","sort","b","createHandler","createModuleHandler","ref","createActionHandler","action","model","region","show","Module","_router","UPDATE_ACTION","Date","clone","moduleReferences","loader","extraState","_loader","_extraState","_store","dispatch","handler","_handlers","hs","indexOf","splice","_items","type","_init","store","_loadItems","items","ps","views","concat","refs","createLoader","modules","all","load","Application","entry","registerLoader","loaders","default","startViewport","console","log","startRouter","container","lo","_render","doIt","hash","window","location","attributes","tags","ac","setAttribute","toLowerCase","t","tagName","StaticNode","createElementNS","createElement","updateSingleKey","view","to","each","find","updateView","last","isEach","bindIt","r","getSelectValue","selectedIndex","setSelectOption","selected","bindGroup","group","checked","its","changed","bind","from","tag","_groups","DynamicNode","dynamicAttributes","bindings","groups","updateAttributes","eventHooks","initEvent","actionHooks","initAction","bindingHooks","componentHooks","comp","renderHelper","hook","as","_event","bindEvent","_action","ce","vvs","clear","StaticTextNode","createTextNode","DynamicTextNode","helper","TextNode","ReferenceNode","statics","add","_createItem","grouped","_showNode","_showChildren","cbs","m","bindEvents","bindActions","hooks","on","close","RegionNode","isChildren","showNode","echo","if","unless","blocks","SN","DN","DA","attribute","BD","EV","attrs","AC","CO","component","TX","ss","RG","REF","NDA","NSA","SV","DV","AT","KV","H","HH","HIF","HUN","EACH","IF","IFC","UN","C","setChildren","lifecycles","factory"],"mappings":"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"}