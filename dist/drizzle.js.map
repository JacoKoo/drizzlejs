{"version":3,"file":"drizzle.js","sources":["../src/template/context.ts","../src/template/template.ts","../src/template/util.ts","../src/template/node.ts","../src/template/anchor-node.ts","../src/template/if-block.ts","../src/template/helper.ts","../src/template/each-block.ts","../src/loader.ts","../src/lifecycle.ts","../src/renderable.ts","../src/model.ts","../src/store.ts","../src/view.ts","../src/event.ts","../src/module.ts","../src/application.ts","../src/template/attributes.ts","../src/template/static-node.ts","../src/template/binding.ts","../src/template/dynamic-node.ts","../src/template/text-node.ts","../src/template/reference-node.ts","../src/template/region-node.ts","../src/template/transformer.ts","../src/route.ts","../src/template/special-nodes.ts","../src/drizzle.ts"],"sourcesContent":["import { Disposable } from '../drizzle'\nimport { DynamicNode } from './dynamic-node'\nimport { Module } from '../module'\nimport { View } from '../view'\nimport { Region, Renderable } from '../renderable'\n\nexport interface ComponentHook extends Disposable {\n    update (...args: any[]): void\n}\nexport type Component = (node: Node, ...args: any[]) => ComponentHook\nexport type CustomHelper = (...args: any[]) => any\nexport type CustomEvent = (name: EventTarget, cb: (event: any) => void) => Disposable\n\nexport interface BindingGroup {\n    type: 'checkbox' | 'radio'\n    items: DynamicNode[]\n    busy: boolean\n}\n\nexport interface Context {\n    groups: {[name: string]: BindingGroup}\n\n    name (): string\n    create (name: string, state?: object): Promise<Module | View>\n\n    helper (name: string): CustomHelper | undefined\n    component (name: string): Component | undefined\n    event (name: string): CustomEvent | undefined\n    computed (name: string): (any) => any | undefined\n\n    ref (id: string, node?: HTMLElement | Renderable<any>): void\n    region (id: string, region: Region): void\n\n    delay (p: Promise<any>): void\n    end (): Promise<any>\n}\n\nexport interface DataContext extends Context {\n    data: {[name: string]: any}\n    update (data: object): void\n\n    trigger (name: string, ...args: any[]): void\n    dispatch (name: string, ...args: any[]): void\n\n    sub (data: {[name: string]: any}): DataContext\n}\n\nexport abstract class AbstractDataContext implements DataContext {\n    groups = {}\n    data = {}\n    busy: Promise<any>[]\n    root: Module | View\n\n    constructor (\n        root: Module | View, data?: {[name: string]: any},\n        groups?: {[name: string]: BindingGroup}, busy?: Promise<any>[]\n    ) {\n        this.root = root\n        this.data = data || {}\n        this.groups = groups || {}\n        this.busy = busy || []\n    }\n\n    name () {\n        return this.root._options._file\n    }\n\n    update (data: object): void {\n        this.root.set(data)\n    }\n\n    trigger (name: string, ...args: any[]): void {\n        this.root._event(name, ...args)\n    }\n\n    dispatch (name: string, ...args: any[]): void {\n        this.root._action(name, ...args)\n    }\n\n    ref (id: string, node?: HTMLElement | Renderable<any>): void {\n        if (node) this.root.ids[id] = node\n        else delete this.root.ids[id]\n    }\n\n    region (id: string, region: Region): void {\n        this.root.regions[id] = region\n    }\n\n    delay (p: Promise<any>): void {\n        this.busy.push(p)\n    }\n\n    end (): Promise<any> {\n        const p = this.busy.slice(0)\n        this.busy = []\n        return Promise.all(p)\n    }\n\n    event (name: string): CustomEvent | undefined {\n        const ce = this.root._options.customEvents\n        return (ce && ce[name]) || this.root.app.options.customEvents[name]\n    }\n\n    computed (name: string): (any) => any | undefined {\n        const c = this.root._options.computed\n        return c && c[name]\n    }\n\n    abstract sub (data: {[name: string]: any}): DataContext\n    abstract create (name: string, state?: object): Promise<Module | View>\n    abstract helper (name: string): CustomHelper | undefined\n    abstract component (name: string): Component | undefined\n}\n\nexport class ViewDataContext extends AbstractDataContext {\n    sub (data: {[name: string]: any}): DataContext {\n        return new ViewDataContext(this.root, data, this.groups, this.busy)\n    }\n\n    create (name: string, state?: object): Promise<Module | View> {\n        const p = (this.root as View)._module._createItem(name, state)\n        this.delay(p)\n        return p\n    }\n\n    helper (name: string): CustomHelper | undefined {\n        const h = (this.root as View)._options.helpers\n        return (h && h[name]) || this.root.app.options.helpers[name]\n    }\n\n    component (name: string): Component | undefined {\n        const c = (this.root as View)._options.components\n        return (c && c[name]) || this.root.app.options.components[name]\n    }\n}\n\nexport class ModuleDataContext extends AbstractDataContext {\n    sub (data: {[name: string]: any}): DataContext {\n        return new ModuleDataContext(this.root, data, this.groups, this.busy)\n    }\n\n    create (name: string, state?: object): Promise<Module | View> {\n        const p = (this.root as Module)._createItem(name, state)\n        this.delay(p)\n        return p\n    }\n\n    helper (name: string): CustomHelper | undefined {\n        return\n    }\n\n    component (name: string): Component | undefined {\n        return\n    }\n}\n","import { Disposable } from '../drizzle'\nimport { Node as MNode } from './node'\nimport { Renderable } from '../renderable'\nimport { Transformer } from './transformer'\nimport { DataContext, ViewDataContext, ModuleDataContext, BindingGroup } from './context'\nimport { Module } from '../module'\nimport { View } from '../view'\n\ntype StaticValue = string | number | boolean\ntype DynamicValue = string\n\nexport enum ValueType { STATIC, DYNAMIC, TRANSFORMER }\nexport enum ChangeType { CHANGED, NOT_CHANGED }\n\nexport type NormalValue = [ValueType.STATIC, StaticValue] | [ValueType.DYNAMIC, DynamicValue]\nexport type AttributeValue = NormalValue | [ValueType.TRANSFORMER, Transformer]\nexport type Attribute = [string, AttributeValue]\n\nexport type HelperResult = [ChangeType, any]\n\nexport interface Updatable extends Disposable {\n    update (context: DataContext): void\n}\n\nexport interface Appendable {\n    append (el: Node)\n    remove (el: Node)\n    before (anchor: Node): Appendable\n}\n\nlet i = 0\nexport abstract class Template {\n    creator: () => MNode[]\n\n    createLife () {\n        const me = this\n        const o = {\n            id: i ++,\n            stage: 'template',\n            nodes: [] as MNode[],\n            groups: {} as {[name: string]: BindingGroup},\n\n            init (this: Renderable<any>) {\n                o.nodes = me.creator()\n                const context = me.create(this, o.groups)\n                o.nodes.forEach((it, idx) => {\n                    it.nextSibling = o.nodes[idx + 1]\n                    it.init(context)\n                })\n                return context.end()\n            },\n\n            rendered (this: Renderable<any>, data: object) {\n                const context = me.create(this, o.groups, data)\n                o.nodes.forEach(it => {\n                    it.parent = this._target\n                    it.render(context)\n                })\n                return context.end()\n            },\n\n            updated (this: Renderable<any>, data: object) {\n                const context = me.create(this, o.groups, data)\n                o.nodes.forEach(it => it.update(context))\n                return context.end()\n            },\n\n            destroyed (this: Renderable<any>) {\n                const context = me.create(this, o.groups)\n                o.nodes.forEach(it => it.destroy(context))\n                return context.end()\n            }\n        }\n\n        return o\n    }\n\n    abstract create (root: Renderable<any>, groups: {[name: string]: BindingGroup}, data?: object): DataContext\n}\n\nexport class ViewTemplate extends Template {\n    create (root: View, groups: {[name: string]: BindingGroup}, data: object = {}): DataContext {\n        return new ViewDataContext(root, data, groups)\n    }\n}\n\nexport class ModuleTemplate extends Template {\n    exportedModels: string[] = []\n\n    constructor(exportedModels: string[]) {\n        super()\n        this.exportedModels = exportedModels\n    }\n\n    create (root: Module, groups: {[name: string]: BindingGroup}, data: object = {}): DataContext {\n        return new ModuleDataContext(root, data)\n    }\n}\n","import { AttributeValue, ValueType, Attribute, Appendable } from './template'\nimport { DataContext } from './context'\nimport { Transformer } from './transformer'\n\nexport function tokenize(input: string): string[] {\n    let token = ''\n    const result = [] as string[]\n    let inString = false\n\n    const push = () => {\n        if (token) result.push(token)\n        token = ''\n    }\n\n    for (let i = 0; i < input.length; i++) {\n        const t = input[i]\n        if (inString) {\n            if (t === '\\\\' && input[i + 1] === ']') {\n                token += ']'\n                i++\n                continue\n            }\n            if (t === ']') {\n                push()\n                inString = false\n                continue\n            }\n            token += t\n            continue\n        }\n\n        if (t === '[') {\n            push()\n            inString = true\n            continue\n        }\n\n        if (t === '.') {\n            push()\n            continue\n        }\n        token += t\n    }\n\n    if (token) result.push(token)\n\n    return result\n}\n\nexport function getValue (key: string, context: DataContext): any {\n    const ks = tokenize(key)\n    const first = ks.shift()\n    let ctx\n    const data = context.data\n    const computed = context.computed(first)\n    if (computed) {\n        ctx = computed(data)\n    } else {\n        ctx = data[first]\n    }\n\n    if (ks.length) {\n        ctx = ks.reduce((acc, item) => {\n            if (acc == null) return null\n            return acc[item]\n        }, ctx)\n    }\n\n    return ctx\n}\n\nexport function getAttributeValue(attr: AttributeValue, context: DataContext): any {\n    if (attr[0] === ValueType.STATIC) return attr[1]\n    if (attr[0] === ValueType.DYNAMIC) return getValue(attr[1] as string, context)\n    return (attr[1] as Transformer).render(context)\n}\n\nexport function resolveEventArgument (me: any, context: DataContext, args: Attribute[], event: any): any[] {\n    const o = Object.assign({}, context.data, {event, this: me})\n    const sub = context.sub(o)\n\n    const obj = {}\n    const result = [obj]\n    let keys = 0\n\n    args.forEach(([name, v]) => {\n        const value = getAttributeValue(v, sub)\n        if (name) {\n            keys ++\n            obj[name] = value\n            return\n        }\n        result.push(value)\n    })\n\n    if (keys === 0) result.shift()\n    return result\n}\n\nexport function createAppendable (target: Node): Appendable {\n    if (!target) return null\n    const remove = (el: Node) => target.removeChild(el)\n    const append = (el: Node) => target.appendChild(el)\n    const before = (anchor: Node) => {\n        return {remove, before, append: (el: Node) => target.insertBefore(el, anchor)}\n    }\n    return {append, remove, before}\n}\n","import { createAppendable } from './util'\nimport { Appendable } from './template'\nimport { Context, DataContext } from './context'\n\nexport abstract class Node {\n    id: string\n    element: HTMLElement\n    parent: Appendable\n    children: Node[] = []\n    nextSibling: Node\n    rendered: boolean = false\n    inSvg: boolean = false\n\n    constructor(id?: string) {\n        this.id = id\n    }\n\n    init (context: Context) {\n        this.element = this.create()\n        const a = createAppendable(this.element)\n        this.children.forEach(it => {\n            it.parent = a\n            it.init(context)\n        })\n    }\n\n    render (context: DataContext) {\n        if (this.id && this.element) context.ref(this.id, this.element)\n    }\n\n    update (context: DataContext) {\n    }\n\n    destroy (context: Context) {\n        this.children.forEach(it => it.destroy(context))\n        if (this.id) context.ref(this.id)\n    }\n\n    setChildren (children: Node[]) {\n        this.children = children\n        children.forEach((it, i) => {\n            if (this.inSvg) it.setToSvg()\n            it.nextSibling = children[i + 1]\n        })\n    }\n\n    setToSvg () {\n        this.inSvg = true\n        this.children.forEach(it => it.inSvg = true)\n    }\n\n    create () {\n        return null\n    }\n}\n","import { Node as MNode } from './node'\nimport { Appendable } from './template'\nimport { DataContext, Context } from './context'\n\nexport abstract class AnchorNode extends MNode {\n    newParent: Appendable\n    anchor: Node\n\n    constructor (id?: string) {\n        super(id)\n    }\n\n    render (context: DataContext) {\n        super.render(context)\n        if (this.newParent) return\n\n        if (this.nextSibling) {\n            this.anchor = document.createComment(Object.getPrototypeOf(this).constructor.name)\n            this.parent.append(this.anchor)\n            this.newParent = this.parent.before(this.anchor)\n        } else {\n            this.newParent = this.parent\n        }\n    }\n\n    destroy (context: Context) {\n        super.destroy(context)\n\n        if (this.anchor) this.parent.remove(this.anchor)\n        this.newParent = null\n    }\n}\n","import { Node } from './node'\nimport { AttributeValue, ValueType } from './template'\nimport { AnchorNode } from './anchor-node'\nimport { getAttributeValue } from './util'\nimport { Context, DataContext } from './context'\n\nexport const Compare: {[key: string]: (v1: any, v2: any) => boolean} = {\n    '==': (v1, v2) => v1 === v2,\n    '!=': (v1, v2) => v1 !== v2,\n    '>': (v1, v2) => v1 > v2,\n    '<': (v1, v2) => v1 < v2,\n    '>=': (v1, v2) => v1 >= v2,\n    '<=': (v1, v2) => v1 <= v2\n}\n\nexport class IfBlock extends AnchorNode {\n    args: AttributeValue[]\n    trueNode: Node\n    falseNode?: Node\n    current: Node\n\n    constructor (args: AttributeValue[], trueNode: Node, falseNode?: Node) {\n        super()\n        this.trueNode = trueNode\n        this.falseNode = falseNode\n        this.args = args\n    }\n\n    init (context: Context) {\n        this.trueNode.init(context)\n        if (this.falseNode) {\n            this.falseNode.init(context)\n        }\n    }\n\n    use (context: DataContext): boolean {\n        if (this.args.length === 1) return this.useSingle(context)\n        if (this.args.length === 3) return this.useCompare(context)\n        throw new Error('if block should have 1 or 3 arguments')\n    }\n\n    useCompare (context: DataContext): boolean {\n        const op = this.args[1][1] as string\n        if (!Compare[op]) {\n            throw Error(`${op} is not a valid compare operator, use: ==, !=, >, <, >=, <=`)\n        }\n        return Compare[op](getAttributeValue(this.args[0], context), getAttributeValue(this.args[2], context))\n    }\n\n    useSingle (context: DataContext): boolean {\n        if (this.args[0][0] === ValueType.STATIC) {\n            return !!this.args[0][1]\n        }\n        return !!getAttributeValue(this.args[0], context)\n    }\n\n    render (context: DataContext) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context)\n\n        this.trueNode.parent = this.newParent\n        if (this.falseNode) {\n            this.falseNode.parent = this.newParent\n        }\n\n        this.current = this.use(context) ? this.trueNode : this.falseNode\n\n        if (this.current) {\n            this.current.render(context)\n        }\n    }\n\n    update (context: DataContext) {\n        if (!this.rendered) return\n\n        const use = this.use(context) ? this.trueNode : this.falseNode\n        if (use === this.current) {\n            if (use) use.update(context)\n            return\n        }\n\n        if (this.current) this.current.destroy(context)\n        this.current = use === this.trueNode ? this.trueNode : this.falseNode\n        if (this.current) this.current.render(context)\n    }\n\n    destroy (context: Context) {\n        if (!this.rendered) return\n        if (this.current) this.current.destroy(context)\n        super.destroy(context)\n        this.rendered = false\n    }\n\n}\n\nexport class UnlessBlock extends IfBlock {\n    use (context: any): boolean {\n        return !getAttributeValue(this.args[0], context)\n    }\n}\n","import { HelperResult, ChangeType } from './template'\nimport { AttributeValue, ValueType } from './template'\nimport { Compare } from './if-block'\nimport { getAttributeValue } from './util'\nimport { DataContext } from './context'\n\nexport abstract class Helper {\n    name: string = ''\n    args: AttributeValue[]\n    current: any\n\n    constructor (...args: AttributeValue[]) {\n        this.args = args\n        this.check()\n    }\n\n    render (context: DataContext): HelperResult {\n        if (!this.current) return [ChangeType.CHANGED, this.renderIt(context)]\n\n        const c = this.current\n        const u = this.renderIt(context)\n        if (c !== u) {\n            return [ChangeType.CHANGED, this.current]\n        }\n\n        return [ChangeType.NOT_CHANGED, this.current]\n    }\n\n    arg (idx: number, context: DataContext): any {\n        if (!this.args[idx]) return ''\n        return getAttributeValue(this.args[idx], context)\n    }\n\n    check () {}\n\n    assertCount (...numbers: number[]) {\n        if (!numbers.some(it => it === this.args.length)) {\n            throw new Error(`${name} helper should have ${numbers.join(' or ')} arguments`)\n        }\n    }\n\n    assertDynamic (...numbers: number[]) {\n        numbers.forEach(it => {\n            if (this.args[it][0] === ValueType.STATIC) {\n                throw new Error(`the ${it}th argument of ${name} helper should be dynamic`)\n            }\n        })\n    }\n\n    abstract doRender (context: DataContext): any\n\n    private renderIt (context: DataContext): any {\n        this.current = this.doRender(context)\n        return this.current\n    }\n}\n\nexport class DelayHelper extends Helper {\n    constructor(name: string, ...args: AttributeValue[]) {\n        super(...args)\n        this.name = name\n    }\n\n    doRender (context: DataContext): any {\n        const fn = context.helper(this.name)\n        if (!fn) throw new Error(`no helper found: ${this.name}`)\n        return fn.apply(null, this.args.map((it, i) => this.arg(i, context)))\n    }\n}\n\nexport class EchoHelper extends Helper {\n    doRender (context) {\n        return this.arg(0, context)\n    }\n}\n\nexport class ConcatHelper extends Helper {\n    doRender (context) {\n        return this.args.map((it, idx) => this.arg(idx, context)).join('')\n    }\n}\n\nexport class IfHelper extends Helper {\n    name = 'if'\n\n    check () {\n        this.assertCount(2, 3, 4, 5)\n        this.assertDynamic(0)\n    }\n\n    doRender (context: DataContext): any {\n        return this.arg(this.use(context), context)\n    }\n\n    use (context: DataContext): number {\n        if (this.args.length <= 3) return this.useSingle(context)\n        return this.useMultiple(context)\n    }\n\n    useSingle (context): number {\n        return this.arg(0, context) ? 1 : 2\n    }\n\n    useMultiple (context): number {\n        const op = this.args[1][1] as string\n        if (!Compare[op]) {\n            throw Error(`${op} is not a valid compare operator, use: ==, !=, >, <, >=, <=`)\n        }\n\n        return Compare[op](this.arg(0, context), this.arg(2, context)) ? 3 : 4\n    }\n}\n\nexport class UnlessHelper extends IfHelper {\n    name = 'unless'\n\n    use (context: DataContext): number {\n        return this.arg(0, context) ? 2 : 1\n    }\n}\n","import { Node } from './node'\nimport { getValue } from './util'\nimport { AnchorNode } from './anchor-node'\nimport { DataContext, Context } from './context'\n\nexport class EachBlock extends AnchorNode {\n    args: string[]\n    trueNode: () => Node\n    falseNode?: Node\n    currentSize = 0\n    nodes: Node[] = []\n\n    constructor (args: string[], trueNode: () => Node, falseNode?: Node) {\n        super()\n        this.args = args\n        this.trueNode = trueNode\n        this.falseNode = falseNode\n    }\n\n    init () {}\n\n    isEmpty (list: any): boolean {\n        return !list || (Array.isArray(list) && !list.length) || (typeof list === 'object' && !Object.keys(list))\n    }\n\n    sub (context: DataContext, i: number | string) {\n        const o = Object.assign({}, context.data)\n        if (!o._each) o._each = []\n        else o._each = o._each.slice(0)\n\n        const v = getValue(this.args[0], context)\n        o._each.push({list: v, index: i, key: this.args[2], name: this.args[0]})\n\n        o[this.args[2]] = v[i]\n        if (this.args[3]) o[this.args[3]] = i\n        return context.sub(o)\n    }\n\n    render (context: DataContext) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context)\n        if (this.falseNode) this.falseNode.parent = this.newParent\n\n        const list = getValue(this.args[0], context)\n        if (this.isEmpty(list)) {\n            this.renderElse(context)\n            return\n        }\n\n        const kv = Array.isArray(list) ?\n            list.map((it, i) => [i, it]) as [number | string, any] :\n            Object.keys(list).map(it => [it, list[it]] as [number | string, any])\n\n        this.renderKeyValue(kv, context)\n    }\n\n    createTrueNode (i: number, context: DataContext) {\n        const n = this.trueNode()\n        n.parent = this.newParent\n        this.nodes[i] = n\n        n.init(context)\n        context.end().then(() => n.render(context))\n    }\n\n    renderKeyValue (arr: [number | string, any][], context: DataContext) {\n        this.currentSize = arr.length\n        arr.forEach((it, i) => {\n            const sub = this.sub(context, it[0])\n            this.createTrueNode(i, sub)\n        })\n    }\n\n    renderElse (context: DataContext) {\n        if (!this.falseNode) return\n        this.falseNode.init(context)\n        this.falseNode.render(context)\n    }\n\n    update (context: DataContext) {\n        if (!this.rendered) return\n\n        const list = getValue(this.args[0], context)\n        const empty = this.isEmpty(list)\n        if (empty && !this.currentSize) {\n            this.updateElse(context)\n            return\n        }\n\n        if (empty) {\n            this.currentSize = 0\n            this.nodes.forEach(it => it.destroy(context))\n            this.nodes = []\n\n            this.renderElse(context)\n            return\n        }\n\n        if (!this.currentSize && this.falseNode) {\n            this.falseNode.destroy(context)\n        }\n\n        const kv = Array.isArray(list) ?\n            list.map((it, i) => [i, it] as [any, any]) :\n            Object.keys(list).map(it => [it, list[it]] as [any, any])\n\n        this.updateKeyValue(kv, context)\n    }\n\n    updateElse (context: DataContext) {\n        if (this.falseNode) this.falseNode.update(context)\n    }\n\n    updateKeyValue (arr: [any, any][], context: DataContext) {\n        this.currentSize = arr.length\n        arr.forEach((it, i) => {\n            const sub = this.sub(context, it[0])\n\n            if (this.nodes[i]) {\n                this.nodes[i].update(sub)\n            } else {\n                this.createTrueNode(i, sub)\n            }\n        })\n\n        while (this.nodes.length !== this.currentSize) {\n            const node = this.nodes.pop()\n            node.destroy(context)\n        }\n    }\n\n    destroy (context: Context) {\n        if (!this.rendered) return\n        super.destroy(context)\n\n        if (!this.currentSize) {\n            if (this.falseNode) this.falseNode.destroy(context)\n            return\n        }\n\n        this.currentSize = 0\n        this.nodes.forEach(it => it.destroy(context))\n        this.nodes = []\n        this.rendered = false\n    }\n}\n","import { Application } from './application'\nimport { Module } from './module'\n\nexport class Loader {\n    protected _app: Application\n    protected _path: string\n    protected _args: any\n\n    constructor(app: Application, path: string, args: any) {\n        this._app = app\n        this._path = path\n        this._args = args\n    }\n\n    load (file, mod: Module): Promise<object> {\n        return this._app.options.getResource(`${this._app.options.scriptRoot}/${this._path}/${file}`)\n    }\n}\n","import {Application} from './application'\n\nexport interface Lifecycle {\n    stage?: string\n    init? (): any\n\n    collect? (data: object): object\n\n    beforeRender? (): any\n    rendered? (data: object): any\n\n    beforeUpdate? (): any\n    updated? (data: object): any\n\n    beforeDestroy? (): any\n    destroyed? (): any\n}\n\nconst callIt = (\n    ctx: LifecycleContainer, cycles: Lifecycle[], method: string, reverse = false, args: any[] = []\n): Promise<any> => {\n    return cycles.filter(it => it[method])[reverse ? 'reduceRight' : 'reduce']((acc, it) => {\n        return acc.then(() => it[method].apply(ctx, args))\n    }, Promise.resolve())\n}\n\nexport class LifecycleContainer {\n    app: Application\n    private _cycles: Lifecycle[] = []\n\n    constructor (app: Application, options: {cycles?: Lifecycle[]} & Lifecycle, ...args: Lifecycle[]) {\n        this.app = app\n\n        const cs = options.cycles || []\n        cs.push(options)\n        args.forEach(it => it && cs.push(it))\n        cs.forEach(it => !it.stage && (it.stage = 'default'))\n\n        app.options.stages.forEach(s => cs.forEach(c => {\n            if (c.stage === s) this._cycles.push(c)\n        }))\n    }\n\n    protected _doInit () {\n        return callIt(this, this._cycles, 'init')\n    }\n\n    protected _doCollect (data: object): object {\n        return this._cycles.filter(it => !!it.collect).reduce((acc, item) => item.collect.call(this, acc), data)\n    }\n\n    protected _doBeforeRender () {\n        return callIt(this, this._cycles, 'beforeRender')\n    }\n\n    protected _doRendered (data: object) {\n        return callIt(this, this._cycles, 'rendered', false, [data])\n    }\n\n    protected _doBeforeUpdate () {\n        return callIt(this, this._cycles, 'beforeUpdate')\n    }\n\n    protected _doUpdated (data: object) {\n        return callIt(this, this._cycles, 'updated', false, [data])\n    }\n\n    protected _doBeforeDestroy () {\n        return callIt(this, this._cycles, 'beforeDestroy', true)\n    }\n\n    protected _doDestroyed () {\n        return callIt(this, this._cycles, 'destroyed', true)\n    }\n}\n","import { Lifecycle, LifecycleContainer } from './lifecycle'\nimport { Application } from './application'\nimport { Disposable } from './drizzle'\nimport { Node } from './template/node'\nimport { Appendable, ModuleTemplate } from './template/template'\n\nexport interface RenderOptions extends Lifecycle {\n    cycles?: Lifecycle[]\n    customEvents?: {[name: string]: (HTMLElement, callback: (any) => void) => Disposable}\n    events?: {[name: string]: (...args) => void}\n    template?: ModuleTemplate\n    computed?: {[name: string]: (any) => any}\n    actions?: {[name: string]: (cb: (data: any) => Promise<any>, data: object) => void}\n    _file?: string\n}\n\nexport enum ComponentState {\n    CREATED, INITED, RENDERED\n}\n\nexport interface Region {\n    item: Renderable<any>\n    show (name: string, state: object): Promise<Renderable<any>>\n    close (): Promise<any>\n\n    _showNode (nodes: Node[], context: object): Promise<any>\n    _showChildren ()\n}\n\nexport abstract class Renderable<T extends RenderOptions> extends LifecycleContainer {\n    _target: Appendable\n    _options: T\n    ids: {[key: string]: HTMLElement | Renderable<T>} = {}\n    regions: {[key: string]: Region}\n\n    protected _busy: Promise<any> = Promise.resolve()\n    protected _status = ComponentState.CREATED\n\n    constructor(app: Application, options: T, ...args: Lifecycle[]) {\n        super(app, options, ...args)\n        this._options = options\n    }\n\n    _render (target: Appendable) {\n        if (this._status !== ComponentState.INITED) return Promise.resolve()\n\n        this._target = target\n        this._busy = this._busy\n            .then(() => this._doBeforeRender())\n            .then(() => this._doCollect(this.get()))\n            .then(data => this._doRendered(data))\n            .then(() => this._status = ComponentState.RENDERED)\n\n        return this._busy\n    }\n\n    destroy () {\n        if (this._status !== ComponentState.RENDERED) return Promise.resolve()\n\n        this._busy = this._busy\n            .then(() => this._doBeforeDestroy())\n            .then(() => this._doDestroyed())\n            .then(() => this._status = ComponentState.INITED)\n\n        return this._busy\n    }\n\n    _init () {\n        return this._busy = this._busy\n            .then(() => this._doInit())\n            .then(() => this._status = ComponentState.INITED)\n    }\n\n    _event (name, ...args: any[]) {\n        const {events} = this._options\n        if (events && events[name]) events[name].apply(this, args)\n    }\n\n    _action (name: string, ...data: any[]) {\n        const {actions} = this._options\n        if (actions && actions[name]) {\n            actions[name].call(this, (d: any) => {\n                return this._dispatch(name, d)\n            }, ...data)\n            return\n        }\n\n        this._dispatch(name, data[0])\n    }\n\n    abstract get (name?: string): object\n    abstract _dispatch (name: string, data: any): Promise<any>\n}\n","export interface ModelOptions {\n    data: Supplier\n}\n\ntype Supplier = () => any\n\nexport class Model {\n    protected _options: ModelOptions\n    protected _data: any\n\n    constructor(options: ModelOptions | Supplier) {\n        const opt = typeof options === 'function' ? { data: options } : options\n        this._options = opt\n        this.set(opt.data())\n    }\n\n    set (data: any) {\n        this._data = data\n    }\n\n    get () {\n        // clone it or make it readonly in dev mode\n        return this._data\n    }\n}\n","import { ModelOptions, Model } from './model'\nimport { Module } from './module'\n\nexport interface StoreOptions {\n    models?: {[key: string]: ModelOptions}\n    actions?: {[key: string]: (payload: any) => void}\n}\n\nexport class Store {\n    private _options: StoreOptions\n    private _models: {[key: string]: Model} = {}\n    private _names: string[] = []\n    private _module: Module\n\n    constructor(mod: Module, options: StoreOptions, updateKey: string) {\n        this._options = options\n        this._module = mod\n        const {models} = options\n        if (models) {\n            this._names = Object.keys(models)\n            this._names.forEach(k => this._models[k] = new Model(models[k]))\n        }\n\n        if (!options.actions) options.actions = {}\n        options.actions[updateKey] = data => {\n            this.set(data)\n        }\n    }\n\n    fire (name: string, data: any) {\n        this._module.fire(name, data)\n    }\n\n    get models () {\n        return this._models\n    }\n\n    get (name?: string) {\n        if (name) return this._models[name].get()\n\n        return this._names.reduce((acc: {[key: string]: any}, item) => {\n            acc[item] = this._models[item].get()\n            return acc\n        }, {})\n    }\n\n    set (data: object) {\n        this._names.forEach(k => (k in data) && this._models[k].set(data[k]))\n    }\n\n    dispatch (name: string, payload: any): Promise<void> {\n        const {actions} = this._options\n        if (!actions || !actions[name]) return Promise.reject()\n        return Promise.resolve(actions[name].call(this, payload))\n    }\n}\n","import { RenderOptions, Renderable, ComponentState } from './renderable'\nimport { Module } from './module'\nimport { Component } from './template/context'\n\nexport interface ViewOptions extends RenderOptions {\n    helpers?: {[name: string]: (...any) => any},\n    state?: object,\n    components?: {[name: string]: Component}\n}\n\nexport class View extends Renderable<ViewOptions> {\n    _module: Module\n    _state: object = {}\n\n    constructor(mod: Module, options: ViewOptions) {\n        super(mod.app, options, options.template && options.template.createLife(), ...mod.app.options.viewLifecycles)\n        this._module = mod\n    }\n\n    get regions () {\n        return this._module.regions\n    }\n\n    _init () {\n        if (this._options.state) this.set(this._options.state, true)\n        return super._init()\n    }\n\n    get (key?: string) {\n        if (!key) return this._state\n\n        if (this._options.computed && this._options.computed[key]) {\n            return this._options.computed[key](this._state)\n        }\n\n        return this._state[key]\n    }\n\n    set (data: object, silent: boolean = false) {\n        if (silent || this._status !== ComponentState.RENDERED) {\n            Object.assign(this._state, data)\n            return Promise.resolve()\n        }\n\n        this._busy = this._busy\n            .then(() => this._doBeforeUpdate())\n            .then(() => Object.assign(this._state, data))\n            .then(() => this._doCollect(this.get()))\n            .then(d => this._doUpdated(d))\n\n        return this._busy\n    }\n\n    _dispatch (name: string, data: any) {\n        return this._module._dispatch(name, data)\n    }\n}\n","import { Disposable } from './drizzle'\n\ntype Handler = (data: any) => void\n\nexport class Events {\n    _handlers: {[name: string]: Handler[]} = {}\n\n    on (name: string, handler: (data: any) => void): Disposable {\n        if (!this._handlers[name]) this._handlers[name] = []\n        const hs = this._handlers[name]\n\n        if (hs.indexOf(handler) !== -1) return {dispose: () => {}}\n        hs.push(handler)\n\n        return {\n            dispose: () => {\n                const idx = hs.indexOf(handler)\n                if (idx !== -1) hs.splice(idx, 1)\n            }\n        }\n    }\n\n    fire (name: string, data: any) {\n        if (!this._handlers[name]) return\n        const hs = this._handlers[name].slice()\n        hs.forEach(it => it.call(this, data))\n    }\n}\n","import { RenderOptions, Renderable, ComponentState } from './renderable'\nimport { StoreOptions, Store } from './store'\nimport { Application } from './application'\nimport { Loader } from './loader'\nimport { View, ViewOptions } from './view'\nimport { Appendable } from './template/template'\nimport { Events } from './event'\nimport { Disposable } from './drizzle'\n\nexport interface ItemOptions {\n    views?: string[]\n    refs?: string[]\n    modules?: {[name: string]: string}\n}\n\nexport interface ModuleOptions extends RenderOptions {\n    store?: StoreOptions\n    items?: ItemOptions\n}\n\nconst UPDATE_ACTION = `update${+new Date()}`\n\nconst clone = (target: any) => {\n    if (Array.isArray(target)) {\n        return target.map(it => clone(it))\n    }\n    if (typeof target === 'object') {\n        return Object.keys(target).reduce((acc: any, it) => {\n            acc[it] = clone(target[it])\n            return acc\n        }, {})\n    }\n    return target\n}\n\ninterface ModuleRenference {\n    [name: string]: {\n        loader: string,\n        path: string\n        args?: any\n    }\n}\n\nexport const moduleReferences: ModuleRenference = {}\n\nexport class Module extends Renderable<ModuleOptions> implements Events {\n    _items: {[key: string]: {\n        type: 'view' | 'module'\n        options: ModuleOptions | ViewOptions\n        loader: Loader\n    }} = {}\n    _extraState: object\n    _handlers = {}\n\n    private _store: Store\n    private _loader: Loader\n\n    constructor(app: Application, loader: Loader, options: ModuleOptions, extraState: object = {}) {\n        super(app, options, options.template && options.template.createLife(), ...app.options.moduleLifecycles)\n        this._loader = loader\n        this._extraState = extraState\n        this.regions = {}\n    }\n\n    set (data: object) {\n        if (!this._options.template) return\n\n        const {exportedModels} = this._options.template\n        if (!exportedModels || !exportedModels.length) return\n\n        const d = exportedModels.reduce((acc, item) => {\n            if (data[item]) acc[item] = data[item]\n            return acc\n        }, {})\n\n        return this._status === ComponentState.CREATED ?\n            this._store.dispatch(UPDATE_ACTION, d) : this._dispatch(UPDATE_ACTION, d)\n    }\n\n    get (name?: string) {\n        const obj = this._store.get(name)\n\n        // TODO only works in dev mode\n        return clone(obj)\n    }\n\n    _createItem (name: string, state?: object) {\n        const opt = this._items[name]\n        const item = opt.type === 'view' ?\n            new View(this, opt.options) :\n            new Module(this.app, opt.loader, opt.options, state)\n        return item._init().then(() => item)\n    }\n\n    _dispatch (name: string, payload?: any) {\n        this._busy = this._busy\n            .then(() => this._doBeforeUpdate())\n            .then(() => this._store.dispatch(name, payload))\n            .then(() => this._doCollect(this.get()))\n            .then(data => this._doUpdated(data))\n\n        return this._busy\n    }\n\n    _render (target: Appendable) {\n        return super._render(target).then(() => {\n            if (this._status === ComponentState.RENDERED) {\n                const {store} = this._options\n                if (store && store.actions && store.actions.init) {\n                    return this._dispatch('init')\n                }\n            }\n        })\n    }\n\n    _init () {\n        this._store = new Store(this, this._options.store || {}, UPDATE_ACTION)\n        this.set(Object.assign({}, this._extraState))\n        const p = this._loadItems().then(() => super._init())\n        return p\n    }\n\n    on (name: string, handler: (data: any) => void): Disposable {\n        return null\n    }\n\n    fire (name: string, data: any) {\n    }\n\n    private _loadItems (): Promise<any> {\n        const {items} = this._options\n        if (!items) return Promise.resolve()\n\n        let ps: {name: string, type: string, loader: Loader}[] = []\n\n        if (items.views) {\n            ps = ps.concat(items.views.map(it => {\n                return {name: it, type: 'view', loader: this._loader}\n            }))\n        }\n\n        if (items.refs) {\n            ps = ps.concat(items.refs.map(it => {\n                const obj = moduleReferences[it]\n                const loader = this.app.createLoader(obj.path, {name: obj.loader, args: obj.args})\n                return {name: it, type: 'module', loader}\n            }))\n        }\n\n        if (items.modules) {\n            ps = ps.concat(Object.keys(items.modules).map(it => {\n                const path = items.modules[it]\n                const loader = this.app.createLoader(path)\n                return {name: it, type: 'module', loader}\n            }))\n        }\n\n        return Promise.all(ps.map((k, i) => ps[i].loader.load(ps[i].type === 'view' ? ps[i].name : 'index', this)))\n            .then(data => {\n                ps.forEach((p, i) => {\n                    this._items[p.name] = {type: p.type as ('view' | 'module'), loader: p.loader, options: data[i]}\n                })\n            })\n    }\n}\n\nObject.getOwnPropertyNames(Events.prototype).forEach(it => {\n    Module.prototype[it] = Events.prototype[it]\n})\n","import { Loader } from './loader'\nimport { Module, ModuleOptions } from './module'\nimport { createAppendable } from './template/util'\nimport { CustomEvent, CustomHelper, Component } from './template/context'\nimport { Disposable, DrizzlePlugin } from './drizzle'\nimport { Lifecycle } from './lifecycle'\nimport { Events } from './event'\n\nexport interface ApplicationOptions {\n    stages?: string[]\n    scriptRoot?: string\n    container: HTMLElement\n    entry: string | ModuleOptions\n    customEvents?: {[name: string]: CustomEvent}\n    helpers?: {[name: string]: CustomHelper}\n    components?: {[name: string]: Component}\n    moduleLifecycles?: Lifecycle[]\n    viewLifecycles?: Lifecycle[]\n    getResource? (path): Promise<object>\n}\n\ninterface LoaderConstructor {\n    new (app: Application, path: string, args?: any): Loader\n}\n\nconst customEvents: {[name: string]: CustomEvent} = {\n    enter (node: HTMLElement, cb: (any) => void): Disposable {\n        const ee = function (this: HTMLElement, e) {\n            if (e.keyCode !== 13) return\n            e.preventDefault()\n            cb.call(this, e)\n        }\n        node.addEventListener('keypress', ee, false)\n        return {\n            dispose () {\n                node.removeEventListener('keypress', ee, false)\n            }\n        }\n    }\n}\n\nexport class Application extends Events {\n    options: ApplicationOptions\n    loaders: {[name: string]: LoaderConstructor} = {}\n    private _plugins: DrizzlePlugin[] = []\n\n    constructor(options: ApplicationOptions) {\n        super()\n        this.options = Object.assign({\n            stages: ['init', 'template', 'default'],\n            scriptRoot: 'app',\n            entry: 'viewport',\n            helpers: {},\n            components: {},\n            moduleLifecycles: [],\n            viewLifecycles: []\n        }, options)\n\n        this.options.customEvents = Object.assign(customEvents, this.options.customEvents)\n        this.registerLoader(Loader)\n    }\n\n    registerLoader (loader: LoaderConstructor, name: string = 'default') {\n        this.loaders[name] = loader\n    }\n\n    createLoader (path: string, loader?: {name: string, args?: any}): Loader {\n        if (loader) {\n            return new this.loaders[loader.name](this, path, loader.args)\n        }\n        return new this.loaders.default(this, path)\n    }\n\n    use (plugin: DrizzlePlugin) {\n        plugin.init(this)\n        this.options.moduleLifecycles = this.options.moduleLifecycles.concat(plugin.moduleLifecycles)\n        this.options.viewLifecycles = this.options.viewLifecycles.concat(plugin.viewLifecycles)\n        this._plugins.push(plugin)\n    }\n\n    start (): Promise<any> {\n        return this.startViewport().then(item => {\n            this._plugins.forEach(it => it.started(item))\n        })\n    }\n\n    private startViewport () {\n        let loader: Loader\n\n        const {entry, container} = this.options\n        const create = (lo, options) => {\n            const v = new Module(this, lo, options)\n            return v._init().then(() => v._render(createAppendable(container))).then(() => v)\n        }\n        if (typeof entry === 'string') {\n            loader = this.createLoader(entry)\n        } else {\n            return create(this.createLoader(null), entry)\n        }\n\n        return loader.load('index', null).then(opt => create(loader, opt))\n    }\n}\n","const ps: [string, number | string, string[] | number][] = [\n    ['accept', 0, ['form', 'input']],\n    ['accept-charset', 'acceptCharset', ['form']],\n    ['accesskey', 'accessKey', 0],\n    ['action', 0, ['form']],\n    ['align', 0, [\n        'applet', 'caption', 'col', 'colgroup', 'hr', 'iframe',\n        'img', 'table', 'tbody', 'td', 'tfoot', 'th', 'thead', 'tr']\n    ],\n    ['allowfullscreen', 'allowFullscreen', ['iframe']],\n    ['alt', 0, ['applet', 'area', 'img', 'input']],\n    ['async', 0, ['script']],\n    ['autocomplete', 0, ['form', 'input']],\n    ['autofocus', 0, ['button', 'input', 'keygen', 'select', 'textarea']],\n    ['autoplay', 0, ['audio', 'video']],\n    ['autosave', 0, ['input']],\n    ['bgcolor', 'bgColor', ['body', 'col', 'colgroup', 'marquee', 'table', 'tbody', 'tfoot', 'td', 'th', 'tr']],\n    ['border', 0, ['img', 'object', 'table']],\n    ['buffered', 0, ['audio', 'video']],\n    ['challenge', 0, ['keygen']],\n    ['charset', 0, ['meta', 'script']],\n    ['checked', 0, ['command', 'input']],\n    ['cite', 0, ['blockquote', 'del', 'ins', 'q']],\n    ['class', 'className', 0],\n    ['code', 0, ['applet']],\n    ['codebase', 'codeBase', ['applet']],\n    ['color', 0, ['basefont', 'font', 'hr']],\n    ['cols', 0, ['textarea']],\n    ['colspan', 'colSpan', ['td', 'th']],\n    ['content', 0, ['meta']],\n    ['contenteditable', 'contentEditable', 0],\n    ['contextmenu', 0, 0],\n    ['controls', 0, ['audio', 'video']],\n    ['coords', 0, ['area']],\n    ['data', 0, ['object']],\n    ['datetime', 'dateTime', ['del', 'ins', 'time']],\n    ['default', 0, ['track']],\n    ['defer', 0, ['script']],\n    ['dir', 0, 0],\n    ['dirname', 'dirName', ['input', 'textarea']],\n    ['disabled', 0, ['button', 'command', 'fieldset', 'input', 'keygen', 'optgroup', 'option', 'select', 'textarea']],\n    ['download', 0, ['a', 'area']],\n    ['draggable', 0, 0],\n    ['dropzone', 0, 0],\n    ['enctype', 0, ['form']],\n    ['for', 'htmlFor', ['label', 'output']],\n    ['form', 0, [\n        'button', 'fieldset', 'input', 'keygen', 'label',\n        'meter', 'object', 'output', 'progress', 'select', 'textarea']\n    ],\n    ['formaction', 0, ['input', 'button']],\n    ['headers', 0, ['td', 'th']],\n    ['height', 0, ['canvas', 'embed', 'iframe', 'img', 'input', 'object', 'video']],\n    ['hidden', 0, 0],\n    ['high', 0, ['meter']],\n    ['href', 0, ['a', 'area', 'base', 'link']],\n    ['hreflang', 0, ['a', 'area', 'link']],\n    ['http-equiv', 'httpEquiv', ['meta']],\n    ['icon', 0, ['command']],\n    ['id', 0, 0],\n    ['indeterminate', 0, ['input']],\n    ['ismap', 'isMap', ['img']],\n    ['itemprop', 0, 0],\n    ['keytype', 0, ['keygen']],\n    ['kind', 0, ['track']],\n    ['label', 0, ['track']],\n    ['lang', 0, 0],\n    ['language', 0, ['script']],\n    ['loop', 0, ['audio', 'bgsound', 'marquee', 'video']],\n    ['low', 0, ['meter']],\n    ['manifest', 0, ['html']],\n    ['max', 0, ['input', 'meter', 'progress']],\n    ['maxlength', 'maxLength', ['input', 'textarea']],\n    ['media', 0, ['a', 'area', 'link', 'source', 'style']],\n    ['method', 0, ['form']],\n    ['min', 0, ['input', 'meter']],\n    ['multiple', 0, ['input', 'select']],\n    ['muted', 0, ['audio', 'video']],\n    ['name', 0, [\n        'button', 'form', 'fieldset', 'iframe', 'input', 'keygen',\n        'object', 'output', 'select', 'textarea', 'map', 'meta', 'param']\n    ],\n    ['novalidate', 'noValidate', ['form']],\n    ['open', 0, ['details']],\n    ['optimum', 0, ['meter']],\n    ['pattern', 0, ['input']],\n    ['ping', 0, ['a', 'area']],\n    ['placeholder', 0, ['input', 'textarea']],\n    ['poster', 0, ['video']],\n    ['preload', 0, ['audio', 'video']],\n    ['radiogroup', 0, ['command']],\n    ['readonly', 'readOnly', ['input', 'textarea']],\n    ['rel', 0, ['a', 'area', 'link']],\n    ['required', 0, ['input', 'select', 'textarea']],\n    ['reversed', 0, ['ol']],\n    ['rows', 0, ['textarea']],\n    ['rowspan', 'rowSpan', ['td', 'th']],\n    ['sandbox', 0, ['iframe']],\n    ['scope', 0, ['th']],\n    ['scoped', 0, ['style']],\n    ['seamless', 0, ['iframe']],\n    ['selected', 0, ['option']],\n    ['shape', 0, ['a', 'area']],\n    ['size', 0, ['input', 'select']],\n    ['sizes', 0, ['link', 'img', 'source']],\n    ['span', 0, ['col', 'colgroup']],\n    ['spellcheck', 0, 0],\n    ['src', 0, ['audio', 'embed', 'iframe', 'img', 'input', 'script', 'source', 'track', 'video']],\n    ['srcdoc', 0, ['iframe']],\n    ['srclang', 0, ['track']],\n    ['srcset', 0, ['img']],\n    ['start', 0, ['ol']],\n    ['step', 0, ['input']],\n    ['summary', 0, ['table']],\n    ['tabindex', 'tabIndex', 0],\n    ['target', 0, ['a', 'area', 'base', 'form']],\n    ['title', 0, 0],\n    ['type', 0, ['button', 'command', 'embed', 'object', 'script', 'source', 'style', 'menu']],\n    ['usemap', 'useMap', ['img', 'input', 'object']],\n    ['value', 0, ['button', 'option', 'input', 'li', 'meter', 'progress', 'param', 'select', 'textarea']],\n    ['volume', 0, ['audio', 'video']],\n    ['width', 0, ['canvas', 'embed', 'iframe', 'img', 'input', 'object', 'video']],\n    ['wrap', 0, ['textarea']]\n]\n\ninterface Attr {\n    [key: string]: {name: any, tags: {[key: string]: boolean}}\n}\n\nconst attributes: Attr = ps.reduce((acc: Attr, item) => {\n    acc[item[0]] = {\n        name: item[1],\n        tags: item[2] && (item[2] as string[]).reduce((ac, i) => {\n            ac[i] = true\n            return ac\n        }, {})\n    }\n    return acc\n}, {})\n\n// TODO set style, data set\nexport function setAttribute(el: SVGElement | HTMLElement, name: string, value: any) {\n    const n = name.toLowerCase()\n    const t = el.tagName.toLowerCase()\n    if (attributes[n] && (!attributes[n].tags || attributes[n].tags[t])) {\n        el[attributes[n].name || n] = value\n    } else {\n        el.setAttribute(name, value)\n    }\n}\n","import { Node } from './node'\nimport { setAttribute } from './attributes'\nimport { DataContext, Context } from './context'\n\nexport class StaticNode extends Node {\n    name: string\n    attributes: [string, any][] = []\n\n    constructor(name: string, id?: string) {\n        super(id)\n        this.name = name\n        if (name === 'svg') this.inSvg = true\n    }\n\n    attribute (name: string, value: any) {\n        this.attributes.push([name, value])\n    }\n\n    render (context: DataContext) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context)\n        if (this.element) this.parent.append(this.element)\n        this.children.forEach(it => it.render(context))\n    }\n\n    update (context: DataContext) {\n        this.children.forEach(it => it.update(context))\n    }\n\n    destroy (context: Context) {\n        if (!this.rendered) return\n        super.destroy(context)\n\n        if (this.element) this.parent.remove(this.element)\n        this.rendered = false\n    }\n\n    create () {\n        const element = this.inSvg ?\n            document.createElementNS('http://www.w3.org/2000/svg', this.name) :\n            document.createElement(this.name)\n        this.attributes.forEach(it =>  setAttribute(element, it[0], it[1]))\n        return element\n    }\n}\n","import { Updatable } from './template'\nimport { DynamicNode } from './dynamic-node'\nimport { getValue, tokenize } from './util'\nimport { DataContext, BindingGroup } from './context'\n\nconst updateSingleKey = (context: DataContext, to: string, value: any) => {\n    const data = context.data\n    if (data._each) {\n        const each = data._each.find(it => it.key === to)\n        if (each) {\n            each.list[each.index] = value\n            context.update({[each.name]: each.list})\n            return\n        }\n    }\n\n    context.update({[to]: value})\n}\n\nexport const updateContext = (context: DataContext, to: string, value: any) => {\n    const ps = tokenize(to)\n    if (ps.length === 1) return updateSingleKey(context, to, value)\n\n    const root = ps.shift()\n    const last = ps.pop()\n    const result = {}\n    let obj\n    let isEach = false\n\n    const data = context.data\n    if (data._each) {\n        const each = data._each.find(it => it.key === root)\n        if (each) {\n            const first = data._each[0]\n            result[first.name] = first.list\n\n            obj = each.list[each.index]\n            isEach = true\n        }\n    }\n\n    if (!isEach) {\n        result[root] = context[root]\n        obj = result[root]\n    }\n\n    result[root] = context[root]\n    obj = ps.reduce((acc, it) => acc[it], obj)\n    obj[last] = value\n    context.update(result)\n}\n\nconst createBinding = <T extends HTMLElement>(\n    context: DataContext, to: string, element: T | Window,\n    event: string, get: (T) => any, set: (T, any) => void\n): Updatable => {\n    let current\n    const obj = {context}\n    const cb = function(this: T) {\n        current = get(element)\n        updateContext(obj.context, to, current)\n    }\n\n    element.addEventListener(event, cb, false)\n\n    const r = {\n        dispose () {\n            element.removeEventListener(event, cb, false)\n        },\n        update (ctx: DataContext) {\n            obj.context = ctx\n            const v = getValue(to, ctx)\n            if (v !== current) {\n                set(element, v)\n                current = v\n            }\n        }\n    }\n\n    r.update(context)\n    return r\n}\n\nconst getSelectValue = (el: HTMLSelectElement) => {\n    const opt = el.options[el.selectedIndex || 0]\n    return opt && opt.value\n}\n\nconst setSelectOption = (el: HTMLSelectElement, value) => {\n    // tslint:disable-next-line:prefer-for-of\n    for (let i = 0; i < el.options.length; i ++) {\n        const opt = el.options[i]\n        if (opt.value === (value + '')) {\n            opt.selected = true\n            return\n        }\n    }\n}\n\nconst bindGroup = (\n    context: DataContext, group: BindingGroup, to: string,\n    element: HTMLInputElement\n): Updatable => {\n    const obj = {context}\n    let current\n    const cb = function(this: HTMLInputElement) {\n        if (group.busy) return\n        current = (group.type === 'radio' ? element.value : group.items\n            .filter(it => (it.element as HTMLInputElement).checked)\n            .map(it => (it.element as HTMLInputElement).value))\n\n        updateContext(obj.context, to, current)\n    }\n\n    element.addEventListener('change', cb, false)\n\n    const r = {\n        dispose () {\n            element.removeEventListener('change', cb, false)\n        },\n        update (ctx: DataContext) {\n            obj.context = ctx\n            if (group.busy) return\n            const v = getValue(to, ctx)\n            const its = group.items.map(it => (it.element as HTMLInputElement))\n\n            let changed = false\n            if (group.type === 'radio' && v !== current) changed = true\n            if (\n                !changed && group.type === 'checkbox' &&\n                (v as any[]).some((it, i) => !current || current[i] !== it)\n            ) changed = true\n            if (!changed) return\n\n            if (group.type === 'radio') {\n                its.forEach(it => it.checked = it.value === v + '')\n                return\n            }\n\n            its.forEach(it => it.checked = (v as any[]).some(vv => vv + '' === it.value))\n        }\n    }\n\n    r.update(context)\n    return r\n}\n\nexport const bind = (node: DynamicNode, context: DataContext, from: string, to: string): Updatable => {\n    const tag = node.name.toLowerCase()\n    const element = node.element\n    if ((tag === 'input' || tag === 'textarea') && from === 'value') {\n        return createBinding(\n            context, to, element, 'input',\n            el => el.value,\n            (el, value) => el.value = value == null ? '' : value\n        )\n    }\n\n    if (tag === 'input' && from === 'checked') {\n        return createBinding(context, to, element, 'change', el => el.checked, (el, value) => el.checked = value)\n    }\n\n    if (tag === 'select' && from === 'value') {\n        return createBinding(context, to, element, 'change', getSelectValue, setSelectOption)\n    }\n\n    if (tag === 'input' && from === 'group') {\n        const type = (element as HTMLInputElement).type\n        if (type !== 'checkbox' && type !== 'radio') return null\n        return bindGroup(context, context.groups[to], to, (element as HTMLInputElement))\n    }\n\n    if (tag === 'window' && from === 'scrollX') {\n        return createBinding(\n            context, to, window, 'scroll',\n            el => el.pageXOffset,\n            (el, value) => el.scrollTo(value, el.pageYOffset)\n        )\n    }\n\n    if (tag === 'window' && from === 'scrollY') {\n        return createBinding(\n            context, to, window, 'scroll',\n            el => el.pageYOffset,\n            (el, value) => el.scrollTo(el.pageXOffset, value)\n        )\n    }\n\n    return null\n}\n","import { StaticNode } from './static-node'\nimport { Helper, DelayHelper } from './helper'\nimport { Disposable } from '../drizzle'\nimport { bind } from './binding'\nimport { Attribute, ChangeType, Updatable } from './template'\nimport { setAttribute } from './attributes'\nimport { resolveEventArgument } from './util'\nimport { ComponentHook, Context, DataContext } from './context'\n\nexport class DynamicNode extends StaticNode {\n    dynamicAttributes: {[name: string]: Helper[]} = {}\n    components: {[name: string]: Helper[]} = {}\n    events: {[event: string]: {method: string, args: Attribute[]}} = {}\n    actions: {[event: string]: {method: string, args: Attribute[]}} = {}\n    bindings: [string, string][] = []\n\n    eventHooks: Disposable[]\n    actionHooks: Disposable[]\n    bindingHooks: Updatable[]\n    componentHooks: [string, ComponentHook][]\n\n    context: DataContext\n\n    dynamicAttribute (name: string, helpers: Helper[]) {\n        this.dynamicAttributes[name] = helpers\n    }\n\n    on (event: string, method: string, args: Attribute[] = []) {\n        this.events[event] = {method, args}\n    }\n\n    action (event: string, method: string, args: Attribute[] = []) {\n        this.actions[event] = {method, args}\n    }\n\n    bind (from: string, to: string) {\n        this.bindings.push([from, to])\n    }\n\n    component (name: string, helpers: Helper[]) {\n        this.components[name] = helpers\n    }\n\n    init (context: Context) {\n        super.init(context)\n\n        this.bindings.forEach(([from, to]) => {\n            if (from !== 'group' || this.name.toLowerCase() !== 'input') return\n            const attr = this.attributes.find(it => it[0].toLowerCase() === 'type')\n            if (!attr) return\n            const type = attr[1].toLowerCase()\n            if (type !== 'checkbox' && type !== 'radio') return\n\n            const groups = context.groups\n            if (!groups[to]) groups[to] = {type, items: [], busy: false}\n            else if (groups[to].type !== type) {\n                throw Error('binding group can not mix up checkbox and radio')\n            }\n            groups[to].items.push(this) // TODO if this item is hidden by if, should it works?\n        })\n    }\n\n    render (context: DataContext) {\n        if (this.rendered) return\n        super.render(context)\n        this.updateAttributes(context)\n\n        this.context = context\n        this.eventHooks = Object.keys(this.events).map(it =>\n            this.initEvent(it, this.events[it].method, this.events[it].args)\n        )\n        this.actionHooks = Object.keys(this.actions).map(it =>\n            this.initAction(it, this.actions[it].method, this.actions[it].args)\n        )\n        this.bindingHooks = this.bindings.map(it => bind(this, context, it[0], it[1])).filter(it => !!it)\n\n        this.componentHooks = Object.keys(this.components).map(it => {\n            const fn = context.component(it)\n            if (!fn) {\n                throw new Error(`Component ${it} is not found.`)\n            }\n            const vs = this.renderHelper(context, this.components[it])\n            const hook = fn(this.element, ...vs[1])\n            return [it, hook] as [string, ComponentHook]\n        })\n    }\n\n    initEvent (name: string, method: string, args: Attribute[]): Disposable {\n        const me = this\n        const cb = function(this: HTMLElement, event) {\n            const as = resolveEventArgument(this, me.context, args, event)\n            me.context.trigger(method, ...as)\n        }\n\n        return this.bindEvent(this.element, name, cb)\n    }\n\n    initAction (name: string, action: string, args: Attribute[]): Disposable {\n        const me = this\n        const cb = function(this: HTMLElement, event) {\n            const data = resolveEventArgument(this, me.context, args, event)\n            me.context.dispatch(action, ...data)\n        }\n\n        return this.bindEvent(this.element, name, cb)\n    }\n\n    bindEvent (el: EventTarget, name: string, cb: (event: any) => void): Disposable {\n        const ce = this.context.event(name)\n        if (ce) return ce(el, cb)\n\n        el.addEventListener(name, cb, false)\n        return {\n            dispose: () => {\n                el.removeEventListener(name, cb, false)\n            }\n        }\n    }\n\n    updateAttributes (context: DataContext) {\n        Object.keys(this.dynamicAttributes).forEach(it => {\n            const vs = this.renderHelper(context, this.dynamicAttributes[it])\n            if (vs[0] === ChangeType.CHANGED) {\n                const vvs = vs[1].filter(v => v != null)\n                if (vvs.length === 1) {\n                    setAttribute(this.element, it, vvs[0])\n                } else {\n                    const v = it === 'class' ? vvs.join(' ') : vvs.join('')\n                    setAttribute(this.element, it, v)\n                }\n            }\n        })\n    }\n\n    renderHelper (context: DataContext, helpers: Helper[]) {\n        const vs = helpers.map(it => it.render(context))\n        if (vs.some(i => i[0] === ChangeType.CHANGED)) {\n            return [ChangeType.CHANGED, vs.map(it => it[1])] as [ChangeType, any[]]\n        }\n        return [ChangeType.NOT_CHANGED, null] as [ChangeType, any[]]\n    }\n\n    update (context: DataContext) {\n        if (!this.rendered) return\n\n        this.updateAttributes(context)\n        this.context = context\n        this.bindingHooks.forEach(it => it.update(context))\n        this.children.forEach(it => it.update(context))\n        this.componentHooks.forEach(([name, hook]) => {\n            const vs = this.renderHelper(context, this.components[name])\n            if (vs[0] === ChangeType.NOT_CHANGED) return\n            hook.update(...vs[1])\n        })\n    }\n\n    destroy (context: Context) {\n        if (!this.rendered) return\n        super.destroy(context)\n\n        this.bindingHooks.forEach(it => it.dispose())\n        this.actionHooks.forEach(it => it.dispose())\n        this.eventHooks.forEach(it => it.dispose())\n        this.componentHooks.forEach(it => it[1].dispose())\n\n        this.bindingHooks = []\n        this.actionHooks = []\n        this.eventHooks = []\n        this.componentHooks = []\n    }\n\n}\n","import { ChangeType } from './template'\nimport { Helper, ConcatHelper } from './helper'\nimport { Node } from './node'\nimport { DataContext, Context } from './context'\n\nclass StaticTextNode extends Node {\n    data: string\n    node: Text\n\n    constructor (data: string = '') {\n        super()\n        this.data = data\n        this.node = document.createTextNode(this.data)\n    }\n\n    init () {}\n\n    render (context: DataContext) {\n        if (this.rendered) return\n        this.rendered = true\n        this.parent.append(this.node)\n    }\n\n    destroy (context: Context) {\n        if (!this.rendered) return\n        super.destroy(context)\n        this.parent.remove(this.node)\n        this.rendered = false\n    }\n}\n\nclass DynamicTextNode extends StaticTextNode {\n    helper: Helper\n\n    constructor(helper: Helper) {\n        super()\n        this.helper = helper\n    }\n\n    render (context: DataContext) {\n        super.render(context)\n        this.update(context)\n    }\n\n    update (context: DataContext) {\n        const r = this.helper.render(context)\n        if (r[0] === ChangeType.CHANGED) {\n            this.node.data = r[1] == null ? '' : r[1]\n        }\n    }\n\n}\n\nclass HtmlDynamicTextNode extends Node {\n    helper: Helper\n    begin: HTMLElement\n    end: HTMLElement\n\n    constructor(helper: Helper) {\n        super()\n        this.helper = new ConcatHelper(...helper.args)\n    }\n\n    init () {\n        this.begin = document.createElement('noscript')\n        this.end = document.createElement('noscript')\n    }\n\n    render (context: DataContext) {\n        if (this.rendered) return\n        this.rendered = true\n        this.parent.append(this.begin)\n        this.parent.append(this.end)\n        this.update(context)\n    }\n\n    update (context: DataContext) {\n        const r = this.helper.render(context)\n        if (r[0] === ChangeType.CHANGED) {\n            this.remove()\n            this.begin.insertAdjacentHTML('afterend', r[1])\n        }\n    }\n\n    remove () {\n        while (this.begin.nextSibling && this.begin.nextSibling !== this.end) {\n            this.begin.parentNode.removeChild(this.begin.nextSibling)\n        }\n    }\n\n    destroy (context: Context) {\n        if (!this.rendered) return\n        this.rendered = false\n\n        this.remove()\n        this.parent.remove(this.end)\n        this.parent.remove(this.begin)\n    }\n}\n\nexport class TextNode extends Node {\n    nodes: Node[]\n\n    constructor (...args: (string | Helper)[]) {\n        super()\n        this.nodes = args.map(it => {\n            if (typeof it === 'string') return new StaticTextNode(it)\n            if (it.name === 'html') return new HtmlDynamicTextNode(it)\n            return new DynamicTextNode(it)\n        })\n    }\n\n    init (context: Context) {\n        this.nodes.forEach(it => {\n            it.parent = this.parent\n            it.init(context)\n        })\n    }\n\n    render (context: DataContext) {\n        this.nodes.forEach(it => {\n            if (!it.parent) it.parent = this.parent\n            it.render(context)\n        })\n    }\n\n    update (context: DataContext) {\n        this.nodes.forEach(it => it.update(context))\n    }\n\n    destroy (context: Context) {\n        this.nodes.forEach(it => it.destroy(context))\n    }\n\n}\n","import { Node } from './node'\nimport { Attribute } from './template'\nimport { Module } from '../module'\nimport { View } from '../view'\nimport { StaticNode } from './static-node'\nimport { Disposable } from '../drizzle'\nimport { AnchorNode } from './anchor-node'\nimport { getValue, resolveEventArgument } from './util'\nimport { Context, DataContext } from './context'\n\ninterface BindResult {\n    fn: (any) => void\n    event: string\n}\n\nexport class ReferenceNode extends AnchorNode {\n    name: string\n    item: Module | View\n    events: {[event: string]: {method: string, args: Attribute[]}} = {}\n    actions: {[event: string]: {method: string, args: Attribute[]}} = {}\n    mappings: [string, string][] = []\n    grouped: {[name: string]: Node[]} = {}\n    statics: {[name: string]: any} = {}\n\n    hooks: Disposable[] = []\n    context: DataContext\n\n    constructor(name: string, id?: string) {\n        super(id)\n        this.name = name\n    }\n\n    attribute (name: string, value: any) {\n        this.statics[name] = value\n    }\n\n    map (from: string, to?: string) {\n        this.mappings.push([from, to || from])\n    }\n\n    on (event: string, method: string, args: Attribute[]) {\n        this.events[event] = {method, args}\n    }\n\n    action (event: string, method: string, args: Attribute[]) {\n        this.actions[event] = {method, args}\n    }\n\n    init (context: Context) {\n        const fn = (i: Module | View) => {\n            this.item = i\n            if (this.id) context.ref(this.id, i)\n        }\n\n        context.create(this.name, this.statics).then(fn)\n\n        this.children.forEach(it => {\n            let name = 'default'\n            if (it instanceof StaticNode) {\n                const attr = (it.attributes as [string, string][]).find(n => n[0] === 'region')\n                if (attr) name = attr[1]\n            }\n\n            it.init(context)\n            if (!this.grouped[name]) this.grouped[name] = []\n            this.grouped[name].push(it)\n        })\n    }\n\n    render (context: DataContext) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context)\n        context.delay(this.item.set(this.mappings.reduce((acc, item) => {\n            acc[item[1]] = getValue(item[0], context)\n            return acc\n        }, {})))\n\n        // TODO why blocks?\n        this.item._render(this.newParent).then(() => {\n            return Promise.all(Object.keys(this.grouped).map(k => {\n                if (!this.item.regions[k]) return\n                return this.item.regions[k]._showNode(this.grouped[k], context)\n            }).concat(Object.keys(this.item.regions).map(it => {\n                if (!this.grouped[it] || !this.grouped[it].length) return this.item.regions[it]._showChildren()\n            })))\n        })\n\n        this.context = context\n        let cbs = []\n        if (this.item instanceof Module) {\n            const m = this.item\n            cbs = cbs.concat(this.bindEvents(context))\n            cbs = cbs.concat(this.bindActions(context))\n\n            this.hooks = cbs.map(it => m.on(it.event, it.fn))\n        }\n    }\n\n    bindEvents (context: DataContext): BindResult[] {\n        const me = this\n\n        return Object.keys(this.events).map(it => {\n            const cb = function (this: Module, event: any) {\n                const data = resolveEventArgument(this, me.context, me.events[it].args, event)\n                context.trigger(me.events[it].method, ...data)\n            }\n            return {fn: cb, event: it}\n        })\n    }\n\n    bindActions (context: DataContext): BindResult[] {\n        const me = this\n\n        return Object.keys(this.actions).map(it => {\n            const cb = function(this: Module, event: any) {\n                const data = resolveEventArgument(this, me.context, me.actions[it].args, event)\n                context.dispatch(me.actions[it].method, ...data)\n            }\n            return {fn: cb, event: it}\n        })\n    }\n\n    update (context: DataContext) {\n        const p = this.item.set(this.mappings.reduce((acc, item) => {\n            acc[item[1]] = getValue(item[0], context)\n            return acc\n        }, {}))\n        context.delay(p)\n\n        this.context = context\n        this.children.forEach(it => it.update(context))\n    }\n\n    destroy (context: Context) {\n        if (!this.rendered) return\n        super.destroy(context)\n\n        context.delay(this.item.destroy())\n        this.hooks.forEach(it => it.dispose())\n        this.hooks = []\n        context.delay(Promise.all(Object.keys(this.grouped).map(it => {\n            if (!this.item.regions[it]) return\n            return this.item.regions[it].close()\n        })))\n        this.rendered = false\n    }\n\n}\n","import { Node } from './node'\nimport { Renderable, Region } from '../renderable'\nimport { Context, DataContext } from './context'\nimport { AnchorNode } from './anchor-node'\n\nexport class RegionNode extends AnchorNode {\n    nodes: Node[]\n    item: Renderable<any>\n    context: DataContext\n\n    constructor(id: string = 'default') {\n        super()\n        this.id = id\n    }\n\n    init (context: Context) {\n        context.region(this.id, this.createRegion())\n    }\n\n    render (context: DataContext) {\n        if (this.rendered) return\n        this.rendered = true\n\n        super.render(context)\n        this.context = context\n\n        this.children.forEach(it => {\n            it.parent = this.newParent\n            it.init(context)\n        })\n    }\n\n    update (context: DataContext) {\n        if (!this.rendered) return\n        this.context = context\n\n        if (this.nodes === this.children) this.nodes.forEach(it => it.update(context))\n    }\n\n    destroy (context: Context) {\n        if (!this.rendered) return\n        super.destroy(context)\n        if (this.nodes) this.nodes.forEach(it => it.destroy(context))\n        if (this.item) context.delay(this.item.destroy())\n        this.rendered = false\n    }\n\n    showNode (nodes: Node[], context: DataContext): Promise<any> {\n        if (!this.rendered) return\n        this.context = context\n        return context.end().then(() => this.close().then(() => {\n            this.nodes = nodes\n            this.nodes.forEach(it => {\n                it.parent = this.newParent\n                it.render(context)\n            })\n            return context.end()\n        }))\n    }\n\n    show (name: string, state: object) {\n        if (!this.rendered) return\n        return this.context.end().then(() => this.close().then(() => this.context.create(name, state)).then(item => {\n            this.item = item\n            return item._render(this.newParent).then(() => {\n                return item\n            })\n        }))\n    }\n\n    close (): Promise<any> {\n        if (!this.nodes && !this.item) return Promise.resolve()\n        return Promise.resolve().then(() => {\n            if (this.nodes) {\n                this.nodes.forEach(it => it.destroy(this.context))\n                return this.context.end()\n            }\n        }).then(() => {\n            if (this.item) return this.item.destroy()\n        }).then(() => {\n            this.nodes = null\n            this.item = null\n        })\n    }\n\n    protected createRegion (): Region {\n        const me = this\n        return {\n            get item () {\n                return me.item\n            },\n            show (name: string, state: object): Promise<any> {\n                return me.show(name, state)\n            },\n            _showNode (nodes: Node[], ctx: DataContext): Promise<any> {\n                return me.showNode(nodes, ctx)\n            },\n            _showChildren () {\n                if (!me.context) return Promise.resolve()\n                return me.showNode(me.children, me.context)\n            },\n            close () {\n                return me.close()\n            }\n        }\n    }\n}\n","import { NormalValue } from './template'\nimport { DataContext } from './context'\nimport { getValue, getAttributeValue } from './util'\n\nexport class Transformer {\n    value: string\n    end: NormalValue\n    items: TransformerItem[]\n\n    constructor (value: string, items: TransformerItem[], end?: NormalValue) {\n        this.value = value\n        this.items = items || []\n        this.end = end\n    }\n\n    render (context: DataContext): any {\n        let v = getValue(this.value, context)\n        v = this.items.reduce((acc, item) => item.render(context, acc), v)\n        if (v == null && this.end) {\n            return getAttributeValue(this.end, context)\n        }\n        return v\n    }\n}\n\nexport class TransformerItem {\n    name: string\n    args: NormalValue[]\n\n    constructor(name: string, args: NormalValue[]) {\n        this.name = name\n        this.args = args || []\n    }\n\n    render (context: DataContext, v: any): any {\n        const fn = context.helper(this.name)\n        if (!fn) {\n            throw new Error(`no helper found: ${this.name}`)\n        }\n        const args = this.args.map(it => getAttributeValue(it, context)).concat(v)\n        return fn.apply(null, args)\n    }\n}\n","import { Module } from './module'\nimport { Lifecycle } from './lifecycle'\nimport { View } from './view'\nimport { DrizzlePlugin, Application } from './drizzle'\n\ninterface ActionHandler {\n    action: string\n}\n\ninterface EventHandler {\n    event: string\n}\n\ninterface ModuleHandler {\n    ref: string\n    region?: string\n    model?: string\n}\n\ntype Handler = DefaultHandler | ActionHandler | EventHandler | ModuleHandler | string\n\ninterface RouteOptions {\n    [route: string]: Handler\n}\n\ndeclare module './module' {\n    interface Module {\n        _router?: Router\n    }\n\n    interface ModuleOptions {\n        routes?: RouteOptions\n    }\n}\n\ninterface DefaultHandler {\n    enter (args: object): Promise<Router>\n    update? (args: object): Promise<any>\n    leave? (): Promise<any>\n}\n\ninterface MatchResult {\n    remain: string[]\n    consumed: string\n    args?: object\n}\n\n// /name\nclass Token {\n    protected key: string\n    protected next: Token\n    protected v = 9\n\n    constructor(key: string, next: Token) {\n        this.key = key\n        this.next = next\n    }\n\n    match (keys: string[]): MatchResult | false {\n        const c = keys[0]\n        return this.doMatch(c, keys.slice(1))\n    }\n\n    value (v: number = 0): number {\n        const vv = v + this.v\n        return this.next ? this.next.value(vv * 10) : vv\n    }\n\n    protected doMatch (key: string, keys: string[]): MatchResult | false {\n        if (key !== this.key) return false\n        if (this.next) {\n            const o = this.next.match(keys)\n            if (!o) return false\n            o.consumed = o.consumed ? `${key}/${o.consumed}` : key\n            return o\n        }\n        return {remain: keys, consumed: key}\n    }\n}\n\n// /:name\nclass ArgToken extends Token {\n    v = 8\n    doMatch (key: string, keys: string[]): MatchResult | false {\n        const oo = {[this.key]: key}\n        if (!this.next) return {remain: keys, args: oo, consumed: key}\n\n        const o = this.next.match(keys)\n        if (o === false) return false\n\n        o.args ? Object.assign(o.args, oo) : (o.args = oo)\n        if (key && o.consumed) o.consumed = `${key}/${o.consumed}`\n        else if (key) o.consumed = key\n        return o\n    }\n}\n\n// /*name\nclass AllToken extends Token {\n    v = 7\n    match (keys: string[]): MatchResult | false {\n        if (!keys.length) return false\n        return { args: {[this.key]: keys}, remain: [], consumed: keys.join('/')}\n    }\n}\n\nconst create = (path) => {\n    const ts = path.trim().split('/').filter(it => !!it)\n    return ts.reduceRight((acc, item) => {\n        if (item.charAt(0) === '*') return new AllToken(item.slice(1), acc)\n        if (item.charAt(0) === ':') return new ArgToken(item.slice(1), acc)\n        return new Token(item, acc)\n    }, null)\n}\n\nclass Router {\n    _prefix: string\n\n    private _module: Module\n    private _keys: Token[] = []\n    private _defs: DefaultHandler[] = []\n    private _currentKey: number = -1\n    private _next: Router\n    private _previous: string[]\n\n    constructor (module: Module, routes: RouteOptions, prefix: string = '#/') {\n        this._module = module\n        this._prefix = prefix\n        this.initRoutes(routes)\n    }\n\n    route (keys: string[]) {\n        for (let i = 0; i < this._keys.length; i ++) {\n            const re = this._keys[i].match(keys)\n            if (re) {\n                return this.doRoute(i, re).then(d => {\n                    this._previous = keys\n                    return d\n                })\n            }\n        }\n        return Promise.resolve(false)\n    }\n\n    private leave (): Promise<any> {\n        this._previous = undefined\n        return Promise.resolve().then(() => {\n            if (this._next) return this._next.leave()\n        }).then(() => {\n            const h = this._defs[this._currentKey]\n            if (h && h.leave) return h.leave()\n        })\n    }\n\n    private enter (idx: number, result: MatchResult) {\n        this._currentKey = idx\n        const o = Object.assign({_router_prefix: `${this._prefix}${result.consumed}/`}, result.args)\n        return this._defs[idx].enter(o).then(it => {\n            this._next = it\n            if (it) return it.route(result.remain)\n        })\n    }\n\n    private doRoute (idx: number, result: MatchResult): Promise<any> {\n        const h = this._defs[idx]\n        if (this._currentKey === -1) {\n            return this.enter(idx, result)\n        }\n        if (idx === this._currentKey) {\n            return Promise.resolve().then(() => {\n                if (h.update) return h.update(result.args)\n            }).then(() => {\n                if (this._next) return this._next.route(result.remain)\n            })\n        }\n\n        return this.leave().then(() => {\n            return this.enter(idx, result)\n        })\n    }\n\n    private initRoutes (routes: RouteOptions) {\n        Object.keys(routes).map(key => {\n            return { key, token: create(key) }\n        }).sort((a, b) => b.token.value() - a.token.value()).forEach(it => {\n            this._keys.push(it.token)\n            this._defs.push(this.createHandler(routes[it.key]))\n        })\n    }\n\n    private createHandler (h: Handler): DefaultHandler {\n        if (typeof h === 'string') return this.createModuleHandler({ref: h})\n        if ('enter' in h) return h as DefaultHandler\n        if ('action' in h) return this.createActionHandler(h as ActionHandler)\n        if ('event' in h) return this.createEventHandler(h as EventHandler)\n        if ('ref' in h) return this.createModuleHandler(h as ModuleHandler)\n        throw new Error('unsupported router handler')\n    }\n\n    private createActionHandler (h: ActionHandler) {\n        return {\n            enter: (args: object) => {\n                return this._module._dispatch(h.action, args).then(() => null)\n            },\n            update: (args: object) => {\n                return this._module._dispatch(h.action, args)\n            }\n        }\n    }\n\n    private createEventHandler (h: EventHandler) {\n        return {\n            enter: (args: object) => {\n                this._module._event(h.event, args, this._previous)\n                return Promise.resolve(null)\n            },\n            update: (args: object) => {\n                this._module._event(h.event, args, this._previous)\n                return Promise.resolve()\n            }\n        }\n    }\n\n    private createModuleHandler (h: ModuleHandler) {\n        let item\n        return {\n            enter: (args: object) => {\n                const o = h.model ? {[h.model]: args} : args\n                return this._module.regions[h.region || 'default'].show(h.ref, o).then(it => {\n                    item = it\n                    if (it instanceof Module) return it._router\n                    return null\n                })\n            },\n\n            update: (args: object) => {\n                if (!args) return Promise.resolve()\n                const o = h.model ? {[h.model]: args} : args\n                if (item && (item instanceof Module)) return item.set(o)\n                return Promise.resolve()\n            }\n        }\n    }\n}\n\nconst RouterModuleLifecycle: Lifecycle = {\n    stage: 'init',\n    init (this: Module) {\n        const {routes} = this._options\n        if (!routes) return\n        const prefix = (this._extraState as any)._router_prefix\n        this._router = new Router(this, routes, prefix)\n    },\n\n    collect (this: Module, data: object): object {\n        const r = this._router\n        if (r) data['@router'] = r._prefix\n        return data\n    }\n}\n\nconst RouterViewLifecycle: Lifecycle = {\n    collect (this: View, data: object): object {\n        const r = this._module._router\n        if (r) data['@router'] = r._prefix\n        return data\n    }\n}\n\nexport const RouterPlugin: DrizzlePlugin = {\n    moduleLifecycles: [RouterModuleLifecycle],\n    viewLifecycles: [RouterViewLifecycle],\n\n    init (app: Application) {\n\n    },\n\n    started (item: Module) {\n        const router = item._router\n        if (!router) return\n        const doIt = () => {\n            const hash = window.location.hash\n            if (hash.slice(0, 2) !== '#/') return\n            const hs = hash.slice(2).split('/').filter(it => !!it)\n            if (!hs.length) return\n            router.route(hs).then(it => {\n                console.log(it)\n            })\n        }\n\n        window.addEventListener('popstate', doIt)\n        doIt()\n    }\n}\n","import { DynamicNode } from './dynamic-node'\nimport { Disposable } from '../drizzle'\nimport { AbstractDataContext } from './context'\n\nexport class WindowNode extends DynamicNode {\n    constructor (id?: string) {\n        super('window', id)\n        this.children = []\n    }\n\n    init () {}\n    dynamicAttribute () {}\n    component () {}\n\n    bind (from: string, to: string) {\n        if (from !== 'scrollX' && from !== 'scrollY') {\n            throw new Error('Can only bind scrollX and scrollY on window object')\n        }\n        super.bind(from, to)\n    }\n\n    bindEvent (el: EventTarget, name: string, cb: (event: any) => void): Disposable {\n        return super.bindEvent(window, name, cb)\n    }\n}\n\nexport class ApplicationNode extends DynamicNode {\n    constructor (id?: string) {\n        super('app', id)\n        this.children = []\n    }\n\n    init () {}\n    dynamicAttribute () {}\n    component () {}\n    bind () {}\n\n    bindEvent (el: EventTarget, name: string, cb: (event: any) => void): Disposable {\n        return (this.context as AbstractDataContext).root.app.on(name, cb)\n    }\n}\n","import {\n    IfHelper, UnlessHelper, Helper, DelayHelper, EchoHelper\n} from './template/helper'\nimport { IfBlock, UnlessBlock } from './template/if-block'\nimport { EachBlock } from './template/each-block'\nimport { Loader } from './loader'\nimport {\n    Attribute, AttributeValue, ModuleTemplate,\n    ViewTemplate, NormalValue, ValueType,\n} from './template/template'\nimport { Application } from './application'\nimport { StaticNode } from './template/static-node'\nimport { DynamicNode } from './template/dynamic-node'\nimport { TextNode } from './template/text-node'\nimport { ReferenceNode } from './template/reference-node'\nimport { RegionNode } from './template/region-node'\nimport { Node } from './template/node'\nimport { TransformerItem, Transformer } from './template/transformer'\nimport { Lifecycle } from './lifecycle'\nimport { Module } from './module'\nimport { RouterPlugin } from './route'\nimport { WindowNode, ApplicationNode } from './template/special-nodes'\n\nexport interface Disposable {\n    dispose (): void\n}\n\nconst innerHelpers = {\n    if: IfHelper, unless: UnlessHelper\n}\n\ninterface NodeConstructor {\n    new (id?: string): DynamicNode\n}\n\nconst nodes: {[name: string]: NodeConstructor} = {\n    window: WindowNode,\n    app: ApplicationNode\n}\n\nfunction createNode(name: string, id?: string): DynamicNode | undefined {\n    if (nodes[name]) return new nodes[name](id)\n}\n\ninterface RegionConstructor {\n    new (id: string): RegionNode\n}\n\nconst regions: {[name: string]: RegionConstructor} = {\n}\n\nfunction createRegion(name: string, id: string): RegionNode | undefined {\n    if (regions[name]) return new regions[name](id)\n}\n\n// nodes\nconst SN = (name: string, id?: string) => {\n    const node = createNode(name, id)\n    return node ? node : new StaticNode(name, id)\n}\nconst DN = (name: string, id?: string) => {\n    const node = createNode(name, id)\n    return node ? node : new DynamicNode(name, id)\n}\nconst REF = (name: string, id?: string) => new ReferenceNode(name, id)\nconst TX = (...ss: (string | Helper)[]) => new TextNode(...ss)\nconst RG = (name: string, id: string = 'default') => {\n    const region = createRegion(name, id)\n    return region ? region : new RegionNode(id)\n}\n\n// node attribute\nconst SA = (d: StaticNode | DynamicNode | ReferenceNode, name: string, value: any) => {\n    d.attribute(name, value)\n}\nconst DA = (d: DynamicNode, name: string, ...hs: Helper[]) => d.dynamicAttribute(name, hs)\nconst BD = (d: DynamicNode, from: string, to: string) => d.bind(from, to)\nconst MP = (d: ReferenceNode, from: string, to?: string) => d.map(from, to)\nconst EV = (d: DynamicNode | ReferenceNode, event: string, method: string, ...attrs: Attribute[]) => {\n    d.on(event, method, attrs)\n}\nconst AC = (d: DynamicNode | ReferenceNode, event: string, method: string, ...attrs: Attribute[]) => {\n    d.action(event, method, attrs)\n}\nconst CO = (d: DynamicNode, name: string, ...hs: Helper[]) => d.component(name, hs)\nconst C = (parent: Node, ...children: Node[]) => parent.setChildren(children)\n\n// attributes\nconst TI = (name: string, ...args: NormalValue[]) => new TransformerItem(name, args)\n\nconst TV = (value: string, end?: NormalValue, ...items: TransformerItem[]) =>\n    [ValueType.TRANSFORMER, new Transformer(value, items, end)] as AttributeValue\nconst SV = (v: string) => [ValueType.STATIC, v] as NormalValue\nconst DV = (v: string) => [ValueType.DYNAMIC, v] as NormalValue\nconst AT = (n: string, v: AttributeValue) => [n, v] as Attribute\n\n// helpers\nconst H = (n: string | AttributeValue) => Array.isArray(n) ? new EchoHelper(n) : new EchoHelper(DV(n))\nconst HH = (n: string, ...args: AttributeValue[]) => {\n    if (innerHelpers[n]) return new innerHelpers[n](...args)\n    return new DelayHelper(n, ...args)\n}\n\n// block\nconst EACH = (args: string[], trueNode: () => Node, falseNode?: Node) => new EachBlock(args, trueNode, falseNode)\nconst IF = (args: AttributeValue[], trueNode: Node, falseNode?: Node) => new IfBlock(args, trueNode, falseNode)\nconst UN = (n: string, trueNode: Node, falseNode?: Node) => new UnlessBlock([DV(n)], trueNode, falseNode)\n\nexport const factory = {\n    SN, DN, TX, RG, REF, SV, DV, AT, H, HH,\n    EACH, IF, UN, C, SA, DA, BD, EV, AC, CO, TI, TV, MP\n}\n\nexport {\n    ModuleTemplate, ViewTemplate, Application, Loader, RouterPlugin\n}\n\nexport function registerNode(name: string, type: NodeConstructor) {\n    nodes[name] = type\n}\n\nexport function registerRegion(name: string, type: RegionConstructor) {\n    regions[name] = type\n}\n\nexport interface DrizzlePlugin {\n    moduleLifecycles: Lifecycle[]\n    viewLifecycles: Lifecycle[]\n    init (app: Application): void\n    started (item: Module): void\n}\n"],"names":["AbstractDataContext","root","data","groups","busy","_options","_file","set","name","args","_event","_action","id","node","ids","region","regions","p","push","slice","Promise","all","ce","customEvents","app","options","c","computed","ViewDataContext","state","_module","_createItem","delay","h","helpers","components","ModuleDataContext","ValueType","ChangeType","i","Template","me","o","stage","nodes","init","creator","context","create","forEach","it","idx","nextSibling","end","rendered","parent","_target","render","updated","update","destroyed","destroy","ViewTemplate","ModuleTemplate","exportedModels","tokenize","input","token","result","inString","length","t","getValue","key","ks","first","shift","ctx","reduce","acc","item","getAttributeValue","attr","STATIC","DYNAMIC","resolveEventArgument","event","Object","assign","this","sub","obj","keys","v","value","createAppendable","target","remove","el","removeChild","append","appendChild","before","anchor","insertBefore","Node","element","a","children","ref","inSvg","setToSvg","AnchorNode","newParent","document","createComment","getPrototypeOf","constructor","MNode","Compare","v1","v2","IfBlock","trueNode","falseNode","useSingle","useCompare","Error","op","current","use","UnlessBlock","Helper","check","CHANGED","renderIt","u","NOT_CHANGED","numbers","some","join","doRender","DelayHelper","fn","helper","apply","map","arg","EchoHelper","ConcatHelper","IfHelper","assertCount","assertDynamic","useMultiple","UnlessHelper","EachBlock","list","Array","isArray","_each","index","isEmpty","renderElse","kv","renderKeyValue","n","then","arr","currentSize","createTrueNode","empty","updateElse","updateKeyValue","pop","Loader","path","_app","_path","_args","file","mod","getResource","scriptRoot","callIt","cycles","method","reverse","filter","resolve","LifecycleContainer","cs","stages","s","_cycles","collect","call","ComponentState","Renderable","CREATED","_status","INITED","_busy","_doBeforeRender","_doCollect","get","_doRendered","RENDERED","_doBeforeDestroy","_doDestroyed","_doInit","events","actions","d","_dispatch","Model","opt","_data","Store","updateKey","models","_names","_models","k","fire","payload","reject","View","template","createLife","viewLifecycles","_state","silent","_doBeforeUpdate","_doUpdated","Events","handler","_handlers","hs","indexOf","dispose","splice","UPDATE_ACTION","Date","clone","moduleReferences","Module","loader","extraState","moduleLifecycles","_loader","_extraState","_store","dispatch","_items","type","_init","babelHelpers.get","store","_loadItems","items","ps","views","concat","refs","createLoader","modules","load","getOwnPropertyNames","prototype","enter","cb","ee","e","keyCode","preventDefault","addEventListener","removeEventListener","Application","entry","registerLoader","loaders","default","plugin","_plugins","startViewport","started","container","lo","_render","attributes","tags","ac","setAttribute","toLowerCase","tagName","StaticNode","createElementNS","createElement","updateSingleKey","to","each","find","updateContext","last","isEach","createBinding","r","getSelectValue","selectedIndex","setSelectOption","selected","bindGroup","group","checked","its","changed","vv","bind","from","tag","window","pageXOffset","scrollTo","pageYOffset","DynamicNode","dynamicAttributes","bindings","updateAttributes","eventHooks","initEvent","actionHooks","initAction","bindingHooks","componentHooks","component","vs","renderHelper","hook","as","trigger","bindEvent","action","vvs","StaticTextNode","createTextNode","DynamicTextNode","HtmlDynamicTextNode","begin","insertAdjacentHTML","parentNode","TextNode","ReferenceNode","statics","mappings","grouped","_showNode","_showChildren","cbs","m","bindEvents","bindActions","hooks","on","close","RegionNode","createRegion","show","showNode","Transformer","TransformerItem","Token","next","doMatch","match","consumed","remain","ArgToken","oo","AllToken","ts","trim","split","reduceRight","charAt","Router","module","routes","prefix","_prefix","initRoutes","_keys","re","doRoute","_previous","undefined","_next","leave","_defs","_currentKey","_router_prefix","route","sort","b","createHandler","createModuleHandler","createActionHandler","createEventHandler","model","_router","RouterModuleLifecycle","RouterViewLifecycle","RouterPlugin","router","doIt","hash","location","console","log","WindowNode","ApplicationNode","innerHelpers","if","unless","createNode","SN","DN","REF","TX","ss","RG","SA","attribute","DA","dynamicAttribute","BD","MP","EV","attrs","AC","CO","C","setChildren","TI","TV","TRANSFORMER","SV","DV","AT","H","HH","EACH","IF","UN","factory","registerNode","registerRegion"],"mappings":"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"}