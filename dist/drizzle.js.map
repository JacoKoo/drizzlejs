{"version":3,"file":"drizzle.js","sources":["../src/loader.ts","../src/template/common.ts","../src/template/value.ts","../src/template/cache.ts","../src/template/context.ts","../src/template/template.ts","../src/lifecycle.ts","../src/renderable.ts","../src/model.ts","../src/store.ts","../src/view.ts","../src/event.ts","../src/component.ts","../src/application.ts","../src/route.ts","../src/template/helper.ts","../src/template/tag.ts","../src/template/static-tag.ts","../src/template/dynamic-tag.ts","../src/template/block-tag.ts","../src/template/reference-tag.ts","../src/template/text-tag.ts","../src/template/transformer.ts","../src/template/each-tag.ts","../src/template/if-tag.ts","../src/template/binding.ts","../src/drizzle.ts"],"sourcesContent":["import { Application } from './application'\nimport { Component } from './component'\n\nexport class Loader {\n    protected _app: Application\n    protected _path: string\n    protected _args: any\n\n    constructor(app: Application, path: string, args: any) {\n        this._app = app\n        this._path = path\n        this._args = args\n    }\n\n    load (file, mod: Component): Promise<object> {\n        return this._app.options.getResource(`${this._app.options.scriptRoot}/${this._path}/${file}`)\n    }\n}\n","import { Transformer } from './transformer'\n\nexport enum ChangeType { CHANGED, NOT_CHANGED }\nexport type HelperResult = [ChangeType, any, any]\nexport type CustomTransformer = (...args: any[]) => any\n\nexport interface State {\n    get (key: string): any\n    set (key: string, val: any)\n    clear (key: string)\n}\n\nexport interface CustomEvent {\n    on (state: State, el: Element, cb: (event: any) => void)\n    off (state: State, el: Element, cb: (event: any) => void)\n}\n\nexport interface Widget {\n    create (state: State, el: Node, ...args: any[]): any\n    update (state: State, changed: boolean, el: Node, ...args: any[])\n    destory (state: State, el: Node)\n}\n\nexport interface WidgetDef {\n    name: string\n    args: string[] // helper ids\n}\n\nexport interface RefDef {\n    id: string\n    each: string[]\n}\n\nexport interface RefContainer {\n    ref (name: string): any\n}\n\nexport interface EachState {\n    _id: string[]\n    _def: EachDef[]\n    _state: (string | number)[]\n}\n\nexport interface EachDef {\n    name: string // helper id\n    alias: string\n    idx?: string\n    key?: string\n}\n\ntype StaticValue = string | number | boolean\ntype DynamicValue = string\ntype AttributeName = string\n\nexport enum ValueType { STATIC, DYNAMIC, TRANSFORMER }\n\nexport type NormalValue = [ValueType.STATIC, StaticValue] | [ValueType.DYNAMIC, DynamicValue]\nexport type AttributeValue = NormalValue | [ValueType.TRANSFORMER, Transformer]\nexport type Attribute = [AttributeName, AttributeValue]\n","import { DataContext, EventDef, EventTarget } from './context'\nimport { Transformer } from './transformer'\nimport { ValueType, AttributeValue, EachState } from './common'\n\nexport function resolveEventArguments (ctx: DataContext, me: EventTarget, event: any, def: EventDef): any[] {\n    const result = []\n    def.attrs.forEach(it => {\n        if (it[0] === ValueType.STATIC) {\n            result.push(it[1])\n            return\n        }\n        if (it[0] === ValueType.DYNAMIC) {\n            const ts = tokenize(it[1])\n            const first = ts.shift()\n            if (first === 'event' || first === 'this') {\n                let o = first === 'event' ? event : me\n                o = ts.reduce((acc, key) => {\n                    return acc[key]\n                }, o)\n                result.push(o)\n                return\n            }\n        }\n        result.push(getAttributeValue(ctx, it, me))\n    })\n    return result\n}\n\nexport function getAttributeValue (ctx: DataContext, av: AttributeValue, state: EachState): any {\n    switch (av[0]) {\n    case ValueType.STATIC:\n        return av[1]\n    case ValueType.DYNAMIC:\n        return getValue(ctx, av[1], state)\n    case ValueType.TRANSFORMER:\n        return (av[1] as Transformer).get(ctx, state)\n    }\n}\n\nexport function getValue (ctx: DataContext, key: string, state: EachState): any {\n    const ks = tokenize(key)\n    const first = ks.shift()\n    let o = ctx.data\n    const computed = ctx.root._options.computed && ctx.root._options.computed[key]\n    if (computed) {\n        o = computed(o)\n    } else {\n        let oo: any = o\n        if (state._def.some((v, i) => {\n            if (v.idx === first) {\n                oo = state._state[i]\n                return true\n            }\n            if (v.alias === first) {\n                [, oo, ] = ctx.get(v.name, state)\n                oo = oo[state._state[i]]\n                return true\n            }\n            return false\n        })) {\n            o = oo\n        } else {\n            o = o[first]\n        }\n    }\n\n    if (ks.length) {\n        o = ks.reduce((acc, item) => {\n            if (acc == null) return null\n            return acc[item]\n        }, o)\n    }\n\n    return o\n}\n\nconst cache: {[key: string]: string[]} = {}\n\nexport function tokenize(input: string): string[] {\n    if (cache[input]) {\n        return cache[input].slice()\n    }\n    let token = ''\n    const result = [] as string[]\n    let inString = false\n\n    const push = () => {\n        if (token) result.push(token)\n        token = ''\n    }\n\n    for (let i = 0; i < input.length; i++) {\n        const t = input[i]\n        if (inString) {\n            if (t === '\\\\' && input[i + 1] === ']') {\n                token += ']'\n                i++\n                continue\n            }\n            if (t === ']') {\n                push()\n                inString = false\n                continue\n            }\n            token += t\n            continue\n        }\n\n        if (t === '[') {\n            push()\n            inString = true\n            continue\n        }\n\n        if (t === '.') {\n            push()\n            continue\n        }\n        token += t\n    }\n\n    if (token) result.push(token)\n\n    cache[input] = result\n    return result.slice()\n}\n","import { EachKey } from './each-tag'\nimport { EachDef, EachState, RefDef, RefContainer } from './common'\nimport { Disposable } from '../drizzle'\n\nconst walk = (re: any[], def: RefDef, current: number, o: object) => {\n    if (current === def.each.length) {\n        if (o[def.id]) re.push(o[def.id])\n        return\n    }\n\n    const keys = o[`_keys_${def.each[current]}`]\n    keys.forEach(it => {\n        walk(re, def, current + 1, o[def.each[current]][it])\n    })\n}\n\nexport class Cache implements EachState {\n    current: any\n    cache: object = {}\n    _id: string[] = []\n    _def: EachDef[] = []\n    _state: (string | number)[] = []\n\n    push (id: string, def: EachDef) {\n        const c = this.getCache()\n        if (!c[id]) {\n            c[id] = {}\n        }\n\n        this._id.push(id)\n        this._def.push(def)\n        this._state.push(0)\n        this.current = null\n    }\n\n    next (key: EachKey): Disposable {\n        const ca = this.getCache(this, 1)\n        const id = this._id[this._id.length - 1]\n        const c = ca[id]\n        let o = c[key]\n        if (!o) {\n            o = {}\n            c[key] = o\n        }\n        this.current = o\n\n        this._state.pop()\n        this._state.push(key)\n\n        return {\n            dispose () {\n                delete c[key]\n            }\n        }\n    }\n\n    pop (clear?: boolean) {\n        const id = this._id.pop()\n        this._def.pop()\n        this._state.pop()\n        this.current = null\n        if (this._def.length) this.current = this.getCache()\n\n        if (clear) {\n            const c = this.getCache()\n            delete c[id]\n        }\n    }\n\n    getCache (state: EachState = this, exclude: number = 0): object {\n        if (exclude === 0 && this.current) return this.current\n        let o = this.cache\n        state._id.forEach((it, i) => {\n            if (i + exclude >= state._id.length) return\n            o = o[it]\n            if (!o) return\n            o = o[state._state[i]]\n        })\n        return o\n    }\n\n    get (key: string): any {\n        if (!this._id.length) return this.getCache()[key]\n\n        for (let i = 0; i <= this._id.length; i ++) {\n            const v = this.getCache(this, i)[key]\n            if (v) return v\n        }\n        return null\n    }\n\n    set (key: string, value: any) {\n        this.getCache()[key] = value\n    }\n\n    clear (key: string) {\n        delete this.getCache()[key]\n    }\n\n    ref (def: RefDef): any {\n        if (!def.each.length) {\n            return this.cache[def.id]\n        }\n\n        const re = []\n        walk(re, def, 0, this.cache)\n        return re\n    }\n}\n","import { Template } from './template'\nimport { Component } from '../component'\nimport { View, ViewOptions } from '../view'\nimport { resolveEventArguments } from './value'\nimport { Cache } from './cache'\nimport { Slot } from './slot-tag'\nimport { EachState, HelperResult, ChangeType, CustomTransformer, AttributeValue, State, RefContainer } from './common'\nimport { ViewTemplate } from '../drizzle'\n\nexport interface Helper {\n    get (dh: DataContext, state: EachState): any\n}\n\nexport interface ElementContainer {\n    append (ctx: Context, el: Element | Comment, anchor?: Comment)\n    remove (ctx: Context, el: Element | Comment)\n}\n\nexport interface EventTarget extends EachState {\n    _ctx: Context\n    addEventListener (name: string, fn: (e: any) => void, options: any)\n    removeEventListener (name: string, fn: (e: any) => void, options: any)\n}\n\nexport interface EventDef {\n    name: string\n    method: string\n    attrs: AttributeValue[]\n    isAction: boolean\n    fn?: (e: any) => void\n    on?: (el: EventTarget) => void\n    off?: (el: EventTarget) => void\n}\n\nexport interface Context extends RefContainer {\n    cache: Cache\n    name (): string // for log\n\n    getEl (key: string): Element | Comment\n    setEl (key: string, el: Element | Comment)\n\n    set (data: object)\n    update (obj: object)\n\n    // get value of id (helper id)\n    get (id: string, state?: EachState): HelperResult\n\n    fillState (el: any): EventTarget\n\n    startSvg (): void\n    endSvg (): void\n    createElement (name: string): Element\n\n    event (isUnbind: boolean, el: EventTarget, eventId: string)\n    trigger (def: EventDef, el: EventTarget, event: any)\n    create (name: string, state?: object): Promise<Component | View>\n    slot (id: string, slot: Slot): void\n}\n\nexport class Waiter {\n    busy: any[] = []\n\n    wait (p: any) {\n        this.busy.push(p)\n    }\n\n    end (): Promise<any> {\n        const bs = this.busy\n        this.busy = []\n        return Promise.all(bs)\n    }\n}\n\nclass ElementState implements State {\n    el: any\n\n    constructor (el: Element) {\n        this.el = el\n    }\n\n    get (key: string): any {\n        return this.el[`s_${key}`]\n    }\n\n    set (key: string, val: any) {\n        this.el[`s_${key}`] = val\n    }\n\n    clear (key: string) {\n        delete this.el[`s_${key}`]\n    }\n}\n\nexport abstract class DataContext implements Context {\n    root: Component | View\n    template: Template\n    data: object\n    cache: Cache\n    version: number = 0\n\n    inSvg: boolean = false\n\n    constructor (root: Component | View, template: Template) {\n        this.root = root\n        this.template = template\n        this.cache = new Cache()\n    }\n\n    name (): string {\n        return this.root._options._file\n    }\n\n    getEl (key: string): Element | Comment {\n        return this.cache.get(key)\n    }\n\n    setEl (key: string, el: Element | Comment) {\n        if (el == null) {\n            this.cache.clear(key)\n            return\n        }\n        this.cache.set(key, el)\n    }\n\n    get (id: string, state?: EachState): HelperResult {\n        const c = this.cache.getCache(state || this.cache)\n        const ck = `h_${id}`\n        const ex = c[ck] as [number, HelperResult]\n        if (ex && ex[0] === this.version) {\n            return ex[1]\n        }\n        const old = ex ? ex[1][1] : null\n\n        const v = this.template.helpers[id].get(this, state || this.cache)\n        const type = v === old ? ChangeType.NOT_CHANGED : ChangeType.CHANGED\n        const re = [type, v, old] as HelperResult\n        c[ck] = [this.version, re]\n        return re\n    }\n\n    fillState (el: any): EventTarget {\n        const es = el as EventTarget\n        es._ctx = this\n        es._def = this.cache._def.slice()\n        es._id = this.cache._id.slice()\n        es._state = this.cache._state.slice()\n        return es\n    }\n\n    startSvg () {\n        this.inSvg = true\n    }\n\n    endSvg () {\n        this.inSvg = false\n    }\n\n    createElement (name: string) {\n        return this.inSvg ?\n            document.createElementNS('http://www.w3.org/2000/svg', name) :\n            document.createElement(name)\n    }\n\n    event (isUnbind: boolean, el: EventTarget, eventId: string) {\n        const def = this.template.events[eventId]\n        const ces = this.root._options.customEvents\n        const ce = (ces && ces[def.name]) || this.root.app.options.customEvents[def.name]\n        if (ce) {\n            const ee = el as any as Element\n            const s = new ElementState(ee)\n            isUnbind ? ce.off(s, ee, def.fn) : ce.on(s, ee, def.fn)\n            return\n        }\n        isUnbind ? def.off(el) : def.on(el)\n    }\n\n    trigger (def: EventDef, el: EventTarget, event: any) {\n        const args = resolveEventArguments(this, el, event, def)\n        if (def.isAction) {\n            this.root._action(def.method, ...args)\n            return\n        }\n        this.root._event(def.method, ...args)\n    }\n\n    set (data: object) {\n        this.data = data\n        this.version ++\n    }\n\n    update (obj: object) {\n\n    }\n\n    slot (id: string, slot: Slot): void {\n        this.root.slots[id] = slot\n    }\n\n    ref (name: string): any {\n        const def = this.template.refs[name]\n        if (!def) {\n            throw new Error(`no ref found: ${name}`)\n        }\n        return this.cache.ref(def)\n    }\n\n    abstract transformer (name: string): CustomTransformer | undefined\n    abstract create (name: string, state?: object): Promise<Component | View>\n}\n\nexport class ViewContext extends DataContext {\n    state: State\n\n    constructor (root: Component | View, template: Template) {\n        super(root, template)\n        this.root = root\n        this.state = {\n            get: (key: string) => {\n                return this.cache.get(`w_${key}`)\n            },\n\n            set: (key: string, val: any) => {\n                this.cache.set(`w_${key}`, val)\n            },\n\n            clear: (key: string) => {\n                this.cache.clear(`w_${key}`)\n            }\n        }\n    }\n    transformer (name: string): CustomTransformer | undefined {\n        const h = (this.root as View)._options.transformers\n        return (h && h[name]) || this.root.app.options.transformers[name]\n    }\n\n    create (name: string, state?: object): Promise<Component | View> {\n        return (this.root as View)._component._createItem(name, state)\n    }\n\n    widget (type: number, el: Element, id: string) {\n        const def = (this.template as ViewTemplate).widgets[id]\n        let ws = (this.root._options as ViewOptions).widgets\n        if (!ws || !ws[def.name]) {\n            ws = this.root.app.options.widgets\n        }\n\n        const w = (ws && ws[def.name])\n        if (!w) {\n            throw new Error(`no widgit definition found: ${def.name}`)\n        }\n\n        switch (type) {\n        case 0:\n            const args = def.args.map(it => this.get(it)[1])\n            const obj = w.create(this.state, el, ...args)\n            this.cache.set(id, obj)\n            break\n        case 1:\n            const as = def.args.map(it => this.get(it))\n            const changed = as.some(it => it[0] === ChangeType.CHANGED)\n            w.update(this.state, changed, el, ...as.map(it => it[1]))\n            break\n        case 2:\n            w.destory(this.state, el)\n            this.cache.clear(id)\n        }\n    }\n\n    bind (type: number, el: EventTarget, id: string): void {\n        const bd = (this.template as ViewTemplate).bindings[id]\n        if (type === 0) return bd.bind(el)\n        if (type === 1) return bd.update(el)\n        if (type === 2) return bd.unbind(el)\n    }\n}\n\nexport class ComponentContext extends DataContext {\n    transformer (name: string): CustomTransformer | undefined {\n        return null\n    }\n\n    create (name: string, state?: object): Promise<Component | View> {\n        return (this.root as Component)._createItem(name, state)\n    }\n}\n","import { Tag, Tags } from './tag'\nimport {\n    Helper, Context, Waiter, ViewContext, ComponentContext, ElementContainer, EventDef, EventTarget\n} from './context'\nimport { Lifecycle } from '../lifecycle'\nimport { Renderable } from '../renderable'\nimport { View } from '../view'\nimport { Component } from '../component'\nimport { WidgetDef, RefDef } from './common'\nimport { Binding } from './binding'\n\nconst TargetKey = '_t_'\n\nclass RootParent implements ElementContainer {\n    target: ElementContainer\n\n    append (ctx: Context, el: Element | Comment, anchor?: Comment) {\n        if (!this.target) {\n            this.target = ctx.cache.get(TargetKey)\n        }\n        this.target.append(ctx, el, anchor)\n    }\n\n    remove (ctx: Context, el: Element | Comment) {\n        if (!this.target) {\n            this.target = ctx.cache.get(TargetKey)\n        }\n        this.target.remove(ctx, el)\n    }\n}\n\nexport class ElementParent implements ElementContainer {\n    el: HTMLElement\n\n    constructor (el: HTMLElement) {\n        this.el = el\n    }\n\n    append (ctx: Context, el: Element | Comment, anchor?: Comment) {\n        if (anchor) {\n            this.el.insertBefore(el, anchor)\n            return\n        }\n\n        this.el.appendChild(el)\n    }\n\n    remove (ctx: Context, el: Element | Comment) {\n        this.el.removeChild(el)\n    }\n}\n\nexport abstract class Template {\n    tags: {[id: string]: Tag} = {}\n    events: {[id: string]: EventDef} = {}\n    helpers: {[id: string]: Helper} = {}\n    refs: {[name: string]: RefDef} = {}\n    root: Tags\n\n    constructor (root: Tags) {\n        this.root = root\n    }\n\n    tag (...ts: Tag[]) {\n        ts.forEach(it => this.tags[it.id] = it)\n    }\n\n    event (id: string, def: EventDef) {\n        def.fn = function (this: EventTarget, e: any) {\n            this._ctx.trigger(def, this, e)\n        }\n        def.on = function (this: null, el: EventTarget) {\n            el.addEventListener(def.name, def.fn, false)\n        }\n        def.off = function (this: null, el: EventTarget) {\n            el.removeEventListener(def.name, def.fn, false)\n        }\n        this.events[id] = def\n    }\n\n    helper (id: string, helper: Helper) {\n        this.helpers[id] = helper\n    }\n\n    ref (name: string, def: RefDef) {\n        this.refs[name] = def\n    }\n\n    abstract context (root: Renderable<any>): Context\n\n    create (): Lifecycle {\n        const me = this\n        const o = {\n            context: null as Context,\n            stage: 'template',\n            init (this: Renderable<any>) {\n                o.context = me.context(this)\n                this._refs = o.context\n                const w = new Waiter()\n                const p = new RootParent()\n                me.root.forEach(it => {\n                    it.parent = p\n                    it.init(o.context, w)\n                })\n                return w.end()\n            },\n\n            rendered (this: Renderable<any>, data: any) {\n                o.context.set(data)\n                o.context.cache.set(TargetKey, this._target)\n                const w = new Waiter()\n                me.root.render(o.context, w)\n                return w.end()\n            },\n\n            updated (this: Renderable<any>, data: any) {\n                o.context.set(data)\n                const w = new Waiter()\n                me.root.update(o.context, w)\n                return w.end()\n            },\n\n            destroyed (this: Renderable<any>) {\n                const w = new Waiter()\n                me.root.destroy(o.context, w, true)\n                return w.end()\n            }\n        }\n\n        return o as Lifecycle\n    }\n}\n\nexport class ViewTemplate extends Template {\n    widgets: {[id: string]: WidgetDef} = {}\n    bindings: {[id: string]: Binding} = {}\n\n    widget (id: string, def: WidgetDef) {\n        this.widgets[id] = def\n    }\n\n    binding (id: string, def: Binding) {\n        this.bindings[id] = def\n    }\n\n    context (root: Renderable<any>): Context {\n        return new ViewContext(root as View, this)\n    }\n}\n\nexport class ComponentTemplate extends Template {\n    exportedModels: string[] = []\n\n    constructor(root: Tags, exportedModels: string[]) {\n        super(root)\n        this.exportedModels = exportedModels\n    }\n\n    context (root: Renderable<any>): Context {\n        return new ComponentContext(root as Component, this)\n    }\n}\n","import {Application} from './application'\n\nexport interface Lifecycle {\n    stage?: string\n    init? (): any\n\n    collect? (data: object): object\n\n    beforeRender? (): any\n    rendered? (data: object): any\n\n    beforeUpdate? (): any\n    updated? (data: object): any\n\n    beforeDestroy? (): any\n    destroyed? (): any\n}\n\nconst callIt = (\n    ctx: LifecycleContainer, cycles: Lifecycle[], method: string, reverse = false, args: any[] = [], exclude?: any\n): Promise<any> => {\n    return cycles.filter(it => it !== exclude && it[method])[reverse ? 'reduceRight' : 'reduce']((acc, it) => {\n        return acc.then(() => it[method].apply(ctx, args))\n    }, Promise.resolve())\n}\n\nexport class LifecycleContainer {\n    app: Application\n    private _cycles: Lifecycle[] = []\n\n    constructor (app: Application, options: {cycles?: Lifecycle[]} & Lifecycle, ...args: Lifecycle[]) {\n        this.app = app\n\n        const cs = options.cycles || []\n        cs.push(options)\n        args.forEach(it => it && cs.push(it))\n        cs.forEach(it => !it.stage && (it.stage = 'default'))\n\n        app.options.stages.forEach(s => cs.forEach(c => {\n            if (c.stage === s) this._cycles.push(c)\n        }))\n    }\n\n    protected _doInit () {\n        return callIt(this, this._cycles, 'init')\n    }\n\n    protected _doCollect (data: object): object {\n        return this._cycles.filter(it => !!it.collect).reduce((acc, item) => item.collect.call(this, acc), data)\n    }\n\n    protected _doBeforeRender () {\n        return callIt(this, this._cycles, 'beforeRender')\n    }\n\n    protected _doRendered (data: object) {\n        return callIt(this, this._cycles, 'rendered', false, [data])\n    }\n\n    protected _doBeforeUpdate () {\n        return callIt(this, this._cycles, 'beforeUpdate')\n    }\n\n    protected _doUpdated (data: object, exclude: any) {\n        return callIt(this, this._cycles, 'updated', false, [data], exclude)\n    }\n\n    protected _doBeforeDestroy () {\n        return callIt(this, this._cycles, 'beforeDestroy', true)\n    }\n\n    protected _doDestroyed () {\n        return callIt(this, this._cycles, 'destroyed', true)\n    }\n}\n","import { Lifecycle, LifecycleContainer } from './lifecycle'\nimport { Application } from './application'\nimport { Slot } from './template/slot-tag'\nimport { ElementContainer } from './template/context'\nimport { CustomEvent, RefContainer } from './template/common'\n\nexport interface RenderOptions extends Lifecycle {\n    cycles?: Lifecycle[]\n    customEvents?: {[name: string]: CustomEvent}\n    events?: {[name: string]: (...args) => void}\n    computed?: {[name: string]: (any) => any}\n    actions?: {[name: string]: (cb: (data: any) => Promise<any>, data: object) => void}\n    _file?: string\n}\n\nexport enum ComponentState {\n    CREATED, INITED, RENDERED\n}\n\nexport abstract class Renderable<T extends RenderOptions> extends LifecycleContainer {\n    _target: ElementContainer\n    _options: T\n    _refs: RefContainer\n    ids: {[key: string]: HTMLElement | Renderable<T>} = {}\n    slots: {[key: string]: Slot}\n\n    protected _busy: Promise<any> = Promise.resolve()\n    protected _status = ComponentState.CREATED\n\n    constructor(app: Application, options: T, ...args: Lifecycle[]) {\n        super(app, options, ...args)\n        this._options = options\n    }\n\n    _render (target: ElementContainer) {\n        if (this._status !== ComponentState.INITED) return Promise.resolve()\n\n        this._target = target\n        this._busy = this._busy\n            .then(() => this._doBeforeRender())\n            .then(() => this._doCollect(this.get()))\n            .then(data => this._doRendered(data))\n            .then(() => this._status = ComponentState.RENDERED)\n\n        return this._busy\n    }\n\n    ref (name: string): any {\n        return this._refs.ref(name)\n    }\n\n    destroy () {\n        if (this._status !== ComponentState.RENDERED) return Promise.resolve()\n\n        this._busy = this._busy\n            .then(() => this._doBeforeDestroy())\n            .then(() => this._doDestroyed())\n            .then(() => this._status = ComponentState.INITED)\n\n        return this._busy\n    }\n\n    _init () {\n        return this._busy = this._busy\n            .then(() => this._doInit())\n            .then(() => this._status = ComponentState.INITED)\n    }\n\n    _event (name, ...args: any[]) {\n        const {events} = this._options\n        if (events && events[name]) events[name].apply(this, args)\n    }\n\n    _action (name: string, ...data: any[]) {\n        const {actions} = this._options\n        if (actions && actions[name]) {\n            actions[name].call(this, (d: any) => {\n                return this._dispatch(name, d)\n            }, ...data)\n            return\n        }\n\n        this._dispatch(name, data[0])\n    }\n\n    abstract get (name?: string): object\n    abstract _dispatch (name: string, data: any): Promise<any>\n}\n","export interface ModelOptions {\n    data: Supplier\n}\n\ntype Supplier = () => any\n\nexport class Model {\n    protected _options: ModelOptions\n    protected _data: any\n\n    constructor(options: ModelOptions | Supplier) {\n        const opt = typeof options === 'function' ? { data: options } : options\n        this._options = opt\n        this.set(opt.data())\n    }\n\n    set (data: any) {\n        this._data = data\n    }\n\n    get () {\n        // clone it or make it readonly in dev mode\n        return this._data\n    }\n}\n","import { ModelOptions, Model } from './model'\nimport { Component } from './component'\n\nexport interface StoreOptions {\n    models?: {[key: string]: ModelOptions}\n    actions?: {[key: string]: (payload: any) => void}\n}\n\nexport class Store {\n    private _options: StoreOptions\n    private _models: {[key: string]: Model} = {}\n    private _names: string[] = []\n    private _component: Component\n\n    constructor(mod: Component, options: StoreOptions, updateKey: string) {\n        this._options = options\n        this._component = mod\n        const {models} = options\n        if (models) {\n            this._names = Object.keys(models)\n            this._names.forEach(k => this._models[k] = new Model(models[k]))\n        }\n\n        if (!options.actions) options.actions = {}\n        options.actions[updateKey] = data => {\n            this.set(data)\n        }\n    }\n\n    fire (name: string, data: any) {\n        this._component.fire(name, data)\n    }\n\n    get models () {\n        return this._models\n    }\n\n    get (name?: string) {\n        if (name) return this._models[name].get()\n\n        return this._names.reduce((acc: {[key: string]: any}, item) => {\n            acc[item] = this._models[item].get()\n            return acc\n        }, {})\n    }\n\n    set (data: object) {\n        this._names.forEach(k => (k in data) && this._models[k].set(data[k]))\n    }\n\n    dispatch (name: string, payload: any): Promise<void> {\n        const {actions} = this._options\n        if (!actions || !actions[name]) return Promise.reject(`no action defined: ${name}`)\n        return Promise.resolve(actions[name].call(this, payload))\n    }\n}\n","import { RenderOptions, Renderable, ComponentState } from './renderable'\nimport { Component } from './component'\nimport { CustomTransformer, Widget } from './template/common'\nimport { ViewTemplate } from './template/template'\n\nexport interface ViewOptions extends RenderOptions {\n    template?: ViewTemplate\n    transformers?: {[name: string]: CustomTransformer},\n    state?: object,\n    widgets?: {[name: string]: Widget}\n}\n\nexport class View extends Renderable<ViewOptions> {\n    _component: Component\n    _state: object = {}\n\n    constructor(mod: Component, options: ViewOptions) {\n        super(mod.app, options, options.template && options.template.create(), ...mod.app.options.viewLifecycles)\n        this._component = mod\n    }\n\n    get slots () {\n        return this._component.slots\n    }\n\n    _init () {\n        if (this._options.state) this._set(this._options.state, true)\n        return super._init()\n    }\n\n    get (key?: string) {\n        if (!key) return Object.assign({}, this._state)\n\n        if (this._options.computed && this._options.computed[key]) {\n            return this._options.computed[key](this._state)\n        }\n\n        return this._state[key]\n    }\n\n    set (data: object) {\n        return this._set(data, false)\n    }\n\n    _set (data: object, silent: boolean, source?: any) {\n        if (silent || this._status !== ComponentState.RENDERED) {\n            Object.assign(this._state, data)\n            return Promise.resolve()\n        }\n\n        this._busy = this._busy\n            .then(() => this._doBeforeUpdate())\n            .then(() => Object.assign(this._state, data))\n            .then(() => this._doCollect(this.get()))\n            .then(d => this._doUpdated(d, source))\n\n        return this._busy\n    }\n\n    _dispatch (name: string, data: any) {\n        return this._component._dispatch(name, data)\n    }\n}\n","import { Disposable } from './drizzle'\n\ntype Handler = (data: any) => void\n\nexport class Events {\n    _handlers: {[name: string]: Handler[]} = {}\n\n    on (name: string, handler: (data: any) => void): Disposable {\n        if (!this._handlers[name]) this._handlers[name] = []\n        const hs = this._handlers[name]\n\n        if (hs.indexOf(handler) !== -1) return {dispose: () => {}}\n        hs.push(handler)\n\n        return {\n            dispose: () => {\n                const idx = hs.indexOf(handler)\n                if (idx !== -1) hs.splice(idx, 1)\n            }\n        }\n    }\n\n    fire (name: string, data: any) {\n        if (!this._handlers[name]) return\n        const hs = this._handlers[name].slice()\n        hs.forEach(it => it.call(this, data))\n    }\n}\n","import { RenderOptions, Renderable, ComponentState } from './renderable'\nimport { StoreOptions, Store } from './store'\nimport { Application } from './application'\nimport { Loader } from './loader'\nimport { View, ViewOptions } from './view'\nimport { Events } from './event'\nimport { Disposable } from './drizzle'\nimport { ElementContainer } from './template/context'\nimport { ComponentTemplate } from './template/template'\n\nexport interface ItemOptions {\n    views?: string[]\n    refs?: string[]\n    components?: {[name: string]: string}\n}\n\nexport interface ComponentOptions extends RenderOptions {\n    template?: ComponentTemplate\n    store?: StoreOptions\n    items?: ItemOptions\n}\n\nconst UPDATE_ACTION = `update${+new Date()}`\n\ninterface ComponentRenference {\n    [name: string]: {\n        loader: string,\n        path: string\n        args?: any\n    }\n}\n\nexport const componentReferences: ComponentRenference = {}\n\nexport class Component extends Renderable<ComponentOptions> implements Events {\n    _items: {[key: string]: {\n        type: 'view' | 'component'\n        options: ComponentOptions | ViewOptions\n        loader: Loader\n    }} = {}\n    _extraState: object\n    _handlers = {}\n\n    private _store: Store\n    private _loader: Loader\n\n    constructor(app: Application, loader: Loader, options: ComponentOptions, extraState: object = {}) {\n        super(app, options, options.template && options.template.create(), ...app.options.componentLifecycles)\n        this._loader = loader\n        this._extraState = extraState\n        this.slots = {}\n    }\n\n    set (data: object) {\n        if (!this._options.template) return\n\n        const {exportedModels} = this._options.template\n        if (!exportedModels || !exportedModels.length) return\n\n        const d = exportedModels.reduce((acc, item) => {\n            if (data[item]) acc[item] = data[item]\n            return acc\n        }, {})\n\n        return this._set(data)\n    }\n\n    _set (data: object, source?: any) {\n        return this._status === ComponentState.CREATED ?\n        this._store.dispatch(UPDATE_ACTION, data) : this._dispatch(UPDATE_ACTION, data, source)\n    }\n\n    get (name?: string) {\n        return Object.assign({}, this._store.get(name))\n    }\n\n    _createItem (name: string, state?: object) {\n        const opt = this._items[name]\n        const item = opt.type === 'view' ?\n            new View(this, opt.options as ViewOptions) :\n            new Component(this.app, opt.loader, opt.options as ComponentOptions, state)\n        return item._init().then(() => item)\n    }\n\n    _dispatch (name: string, payload?: any, source?: any) {\n        this._busy = this._busy\n            .then(() => this._doBeforeUpdate())\n            .then(() => this._store.dispatch(name, payload))\n            .then(() => this._doCollect(this.get()))\n            .then(data => this._doUpdated(data, source))\n\n        return this._busy\n    }\n\n    _render (target: ElementContainer) {\n        return super._render(target).then(() => {\n            if (this._status === ComponentState.RENDERED) {\n                const {store} = this._options\n                if (store && store.actions && store.actions.init) {\n                    return this._dispatch('init')\n                }\n            }\n        })\n    }\n\n    _init () {\n        this._store = new Store(this, this._options.store || {}, UPDATE_ACTION)\n        this.set(Object.assign({}, this._extraState))\n        const p = this._loadItems().then(() => super._init())\n        return p\n    }\n\n    on (name: string, handler: (data: any) => void): Disposable {\n        return null\n    }\n\n    fire (name: string, data: any) {\n    }\n\n    private _loadItems (): Promise<any> {\n        const {items} = this._options\n        if (!items) return Promise.resolve()\n\n        let ps: {name: string, type: string, loader: Loader}[] = []\n\n        if (items.views) {\n            ps = ps.concat(items.views.map(it => {\n                return {name: it, type: 'view', loader: this._loader}\n            }))\n        }\n\n        if (items.refs) {\n            ps = ps.concat(items.refs.map(it => {\n                const obj = componentReferences[it]\n                const loader = this.app.createLoader(obj.path, {name: obj.loader, args: obj.args})\n                return {name: it, type: 'component', loader}\n            }))\n        }\n\n        if (items.components) {\n            ps = ps.concat(Object.keys(items.components).map(it => {\n                const path = items.components[it]\n                const loader = this.app.createLoader(path)\n                return {name: it, type: 'component', loader}\n            }))\n        }\n\n        return Promise.all(ps.map((k, i) => ps[i].loader.load(ps[i].type === 'view' ? ps[i].name : 'index', this)))\n            .then(data => {\n                ps.forEach((p, i) => {\n                    this._items[p.name] = {type: p.type as ('view' | 'component'), loader: p.loader, options: data[i]}\n                })\n            })\n    }\n}\n\nObject.getOwnPropertyNames(Events.prototype).forEach(it => {\n    Component.prototype[it] = Events.prototype[it]\n})\n","import { Loader } from './loader'\nimport { Component, ComponentOptions } from './component'\nimport { DrizzlePlugin } from './drizzle'\nimport { Lifecycle } from './lifecycle'\nimport { Events } from './event'\nimport { ElementParent } from './template/template'\nimport { CustomTransformer, CustomEvent, State, Widget } from './template/common'\n\nexport interface ApplicationOptions {\n    stages?: string[]\n    scriptRoot?: string\n    container: HTMLElement\n    entry: string | ComponentOptions\n    customEvents?: {[name: string]: CustomEvent}\n    transformers?: {[name: string]: CustomTransformer}\n    widgets?: {[name: string]: Widget}\n    componentLifecycles?: Lifecycle[]\n    viewLifecycles?: Lifecycle[]\n    getResource? (path): Promise<object>\n}\n\ninterface LoaderConstructor {\n    new (app: Application, path: string, args?: any): Loader\n}\n\nconst customEvents: {[name: string]: CustomEvent} = {\n    enter: {\n        on (state: State, node: Element, cb: (any) => void) {\n            const ee = function (this: Element, e) {\n                if (e.keyCode !== 13) return\n                e.preventDefault()\n                cb.call(this, e)\n            }\n            state.set('enter', ee)\n            node.addEventListener('keypress', ee, false)\n        },\n        off (state: State, node: Element, cb: (any) => void) {\n            const ee = state.get('enter')\n            if (!ee) return\n            node.removeEventListener('keypress', ee, false)\n            state.clear('enter')\n        }\n    }\n}\n\nexport class Application extends Events {\n    options: ApplicationOptions\n    loaders: {[name: string]: LoaderConstructor} = {}\n    private _plugins: DrizzlePlugin[] = []\n\n    constructor(options: ApplicationOptions) {\n        super()\n        this.options = Object.assign({\n            stages: ['init', 'template', 'default'],\n            scriptRoot: 'app',\n            entry: 'viewport',\n            helpers: {},\n            components: {},\n            componentLifecycles: [],\n            viewLifecycles: []\n        }, options)\n\n        this.options.customEvents = Object.assign(customEvents, this.options.customEvents)\n        this.registerLoader(Loader)\n    }\n\n    registerLoader (loader: LoaderConstructor, name: string = 'default') {\n        this.loaders[name] = loader\n    }\n\n    createLoader (path: string, loader?: {name: string, args?: any}): Loader {\n        if (loader) {\n            return new this.loaders[loader.name](this, path, loader.args)\n        }\n        return new this.loaders.default(this, path)\n    }\n\n    use (plugin: DrizzlePlugin) {\n        plugin.init(this)\n        this.options.componentLifecycles = this.options.componentLifecycles.concat(plugin.componentLifecycles)\n        this.options.viewLifecycles = this.options.viewLifecycles.concat(plugin.viewLifecycles)\n        this._plugins.push(plugin)\n    }\n\n    start (): Promise<any> {\n        return this.startViewport().then(item => {\n            this._plugins.forEach(it => it.started(item))\n        })\n    }\n\n    private startViewport () {\n        let loader: Loader\n\n        const {entry, container} = this.options\n        const create = (lo, options) => {\n            const v = new Component(this, lo, options)\n            return v._init().then(() => v._render(new ElementParent(container))).then(() => v)\n        }\n        if (typeof entry === 'string') {\n            loader = this.createLoader(entry)\n        } else {\n            return create(this.createLoader(null), entry)\n        }\n\n        return loader.load('index', null).then(opt => create(loader, opt))\n    }\n}\n","import { Component } from './component'\nimport { Lifecycle } from './lifecycle'\nimport { View } from './view'\nimport { DrizzlePlugin, Application } from './drizzle'\n\ninterface ActionHandler {\n    action: string\n}\n\ninterface EventHandler {\n    event: string\n}\n\ninterface ComponentHandler {\n    ref: string\n    slot?: string\n    model?: string\n}\n\ntype Handler = DefaultHandler | ActionHandler | EventHandler | ComponentHandler | string\n\ninterface RouteOptions {\n    [route: string]: Handler\n}\n\ndeclare module './component' {\n    interface Component {\n        _router?: Router\n    }\n\n    interface ComponentOptions {\n        routes?: RouteOptions\n    }\n}\n\ninterface DefaultHandler {\n    enter (args: object): Promise<Router>\n    update? (args: object): Promise<any>\n    leave? (): Promise<any>\n}\n\ninterface MatchResult {\n    remain: string[]\n    consumed: string\n    args?: object\n}\n\n// /name\nclass Token {\n    protected key: string\n    protected next: Token\n    protected v = 9\n\n    constructor(key: string, next: Token) {\n        this.key = key\n        this.next = next\n    }\n\n    match (keys: string[]): MatchResult | false {\n        const c = keys[0]\n        return this.doMatch(c, keys.slice(1))\n    }\n\n    value (v: number = 0): number {\n        const vv = v + this.v\n        return this.next ? this.next.value(vv * 10) : vv\n    }\n\n    protected doMatch (key: string, keys: string[]): MatchResult | false {\n        if (key !== this.key) return false\n        if (this.next) {\n            const o = this.next.match(keys)\n            if (!o) return false\n            o.consumed = o.consumed ? `${key}/${o.consumed}` : key\n            return o\n        }\n        return {remain: keys, consumed: key}\n    }\n}\n\n// /:name\nclass ArgToken extends Token {\n    v = 8\n    doMatch (key: string, keys: string[]): MatchResult | false {\n        const oo = {[this.key]: key}\n        if (!this.next) return {remain: keys, args: oo, consumed: key}\n\n        const o = this.next.match(keys)\n        if (o === false) return false\n\n        o.args ? Object.assign(o.args, oo) : (o.args = oo)\n        if (key && o.consumed) o.consumed = `${key}/${o.consumed}`\n        else if (key) o.consumed = key\n        return o\n    }\n}\n\n// /*name\nclass AllToken extends Token {\n    v = 7\n    match (keys: string[]): MatchResult | false {\n        if (!keys.length) return false\n        return { args: {[this.key]: keys}, remain: [], consumed: keys.join('/')}\n    }\n}\n\nconst create = (path) => {\n    const ts = path.trim().split('/').filter(it => !!it)\n    return ts.reduceRight((acc, item) => {\n        if (item.charAt(0) === '*') return new AllToken(item.slice(1), acc)\n        if (item.charAt(0) === ':') return new ArgToken(item.slice(1), acc)\n        return new Token(item, acc)\n    }, null)\n}\n\nclass Router {\n    _prefix: string\n\n    private _component: Component\n    private _keys: Token[] = []\n    private _defs: DefaultHandler[] = []\n    private _currentKey: number = -1\n    private _next: Router\n    private _previous: string[]\n\n    constructor (comp: Component, routes: RouteOptions, prefix: string = '#/') {\n        this._component = comp\n        this._prefix = prefix\n        this.initRoutes(routes)\n    }\n\n    route (keys: string[]) {\n        for (let i = 0; i < this._keys.length; i ++) {\n            const re = this._keys[i].match(keys)\n            if (re) {\n                return this.doRoute(i, re).then(d => {\n                    this._previous = keys\n                    return d\n                })\n            }\n        }\n        return Promise.resolve(false)\n    }\n\n    private leave (): Promise<any> {\n        this._previous = undefined\n        return Promise.resolve().then(() => {\n            if (this._next) return this._next.leave()\n        }).then(() => {\n            const h = this._defs[this._currentKey]\n            if (h && h.leave) return h.leave()\n        })\n    }\n\n    private enter (idx: number, result: MatchResult) {\n        this._currentKey = idx\n        const o = Object.assign({_router_prefix: `${this._prefix}${result.consumed}/`}, result.args)\n        return this._defs[idx].enter(o).then(it => {\n            this._next = it\n            if (it) return it.route(result.remain)\n        })\n    }\n\n    private doRoute (idx: number, result: MatchResult): Promise<any> {\n        const h = this._defs[idx]\n        if (this._currentKey === -1) {\n            return this.enter(idx, result)\n        }\n        if (idx === this._currentKey) {\n            return Promise.resolve().then(() => {\n                if (h.update) return h.update(result.args)\n            }).then(() => {\n                if (this._next) return this._next.route(result.remain)\n            })\n        }\n\n        return this.leave().then(() => {\n            return this.enter(idx, result)\n        })\n    }\n\n    private initRoutes (routes: RouteOptions) {\n        Object.keys(routes).map(key => {\n            return { key, token: create(key) }\n        }).sort((a, b) => b.token.value() - a.token.value()).forEach(it => {\n            this._keys.push(it.token)\n            this._defs.push(this.createHandler(routes[it.key]))\n        })\n    }\n\n    private createHandler (h: Handler): DefaultHandler {\n        if (typeof h === 'string') return this.createComponentHandler({ref: h})\n        if ('enter' in h) return h as DefaultHandler\n        if ('action' in h) return this.createActionHandler(h as ActionHandler)\n        if ('event' in h) return this.createEventHandler(h as EventHandler)\n        if ('ref' in h) return this.createComponentHandler(h as ComponentHandler)\n        throw new Error('unsupported router handler')\n    }\n\n    private createActionHandler (h: ActionHandler) {\n        return {\n            enter: (args: object) => {\n                return this._component._dispatch(h.action, args).then(() => null)\n            },\n            update: (args: object) => {\n                return this._component._dispatch(h.action, args)\n            }\n        }\n    }\n\n    private createEventHandler (h: EventHandler) {\n        return {\n            enter: (args: object) => {\n                this._component._event(h.event, args, this._previous)\n                return Promise.resolve(null)\n            },\n            update: (args: object) => {\n                this._component._event(h.event, args, this._previous)\n                return Promise.resolve()\n            }\n        }\n    }\n\n    private createComponentHandler (h: ComponentHandler) {\n        let item\n        return {\n            enter: (args: object) => {\n                const o = h.model ? {[h.model]: args} : args\n                return this._component._createItem(h.ref, o).then(it => {\n                    const slot = this._component.slots[h.slot || 'default']\n                    return slot.get().then(target => {\n                        slot.setCleaner(w => w.wait(it.destroy()))\n                        return it._render(target)\n                    }).then(() => {\n                        item = it\n                        if (it instanceof Component) return it._router\n                        return null\n                    })\n                })\n            },\n\n            update: (args: object) => {\n                if (!args) return Promise.resolve()\n                const o = h.model ? {[h.model]: args} : args\n                if (item && (item instanceof Component)) return item.set(o)\n                return Promise.resolve()\n            }\n        }\n    }\n}\n\nconst RouterComponentLifecycle: Lifecycle = {\n    stage: 'init',\n    init (this: Component) {\n        const {routes} = this._options\n        if (!routes) return\n        const prefix = (this._extraState as any)._router_prefix\n        this._router = new Router(this, routes, prefix)\n    },\n\n    collect (this: Component, data: object): object {\n        const r = this._router\n        if (r) data['@router'] = r._prefix\n        return data\n    }\n}\n\nconst RouterViewLifecycle: Lifecycle = {\n    collect (this: View, data: object): object {\n        const r = this._component._router\n        if (r) data['@router'] = r._prefix\n        return data\n    }\n}\n\nexport const RouterPlugin: DrizzlePlugin = {\n    componentLifecycles: [RouterComponentLifecycle],\n    viewLifecycles: [RouterViewLifecycle],\n\n    init (app: Application) {\n\n    },\n\n    started (item: Component) {\n        const router = item._router\n        if (!router) return\n        const doIt = () => {\n            const hash = window.location.hash\n            if (hash.slice(0, 2) !== '#/') return\n            const hs = hash.slice(2).split('/').filter(it => !!it)\n            if (!hs.length) return\n            router.route(hs).then(it => {\n                console.log(it)\n            })\n        }\n\n        window.addEventListener('popstate', doIt)\n        doIt()\n    }\n}\n","import { Helper, DataContext } from './context'\nimport { getAttributeValue } from './value'\nimport { AttributeValue, EachState } from './common'\n\nexport const Compare: {[key: string]: (v1: any, v2: any) => boolean} = {\n    '==': (v1, v2) => v1 === v2,\n    '!=': (v1, v2) => v1 !== v2,\n    '>': (v1, v2) => v1 > v2,\n    '<': (v1, v2) => v1 < v2,\n    '>=': (v1, v2) => v1 >= v2,\n    '<=': (v1, v2) => v1 <= v2\n}\n\nabstract class AbstractHelper implements Helper {\n    args: AttributeValue[]\n\n    constructor (args: AttributeValue[]) {\n        this.args = args\n    }\n\n    arg (idx: number, dc: DataContext, state: EachState): any {\n        if (!this.args[idx]) return ''\n        return getAttributeValue(dc, this.args[idx], state)\n    }\n\n    abstract get (dc: DataContext, state: EachState): any\n}\n\nexport class BoolHelper extends AbstractHelper {\n    get (dc: DataContext, state: EachState): any {\n        if (this.args.length === 1) {\n            return !!this.arg(0, dc, state)\n        }\n\n        const op = this.args[1][1] as string\n        if (!Compare[op]) {\n            throw Error(`${op} is not a valid compare operator, use: ==, !=, >, <, >=, <=`)\n        }\n\n        return Compare[op](this.arg(0, dc, state), this.arg(2, dc, state))\n    }\n}\n\nexport class IfHelper extends AbstractHelper {\n    bool: string\n\n    constructor (bool: string, args: AttributeValue[]) {\n        super(args)\n        this.bool = bool\n    }\n\n    get (dc: DataContext, state: EachState): any {\n        return this.arg(this.use(dc, state), dc, state)\n    }\n\n    use (dc: DataContext, state: EachState): number {\n        const [, v, ] = dc.get(this.bool, state)\n        return v ? 0 : 1\n    }\n}\n\nexport class UnlessHelper extends IfHelper {\n    use (dc: DataContext, state: EachState): number {\n        const [, v, ] = dc.get(this.bool, state)\n        return v ? 1 : 0\n    }\n}\n\nexport class DelayHelper extends AbstractHelper {\n    name: string\n\n    constructor(name: string, args: AttributeValue[]) {\n        super(args)\n        this.name = name\n    }\n\n    get (dc: DataContext, state: EachState): any {\n        const fn = dc.transformer(this.name)\n        if (!fn) throw new Error(`no transformer found: ${this.name}`)\n        return fn.apply(null, this.args.map((it, i) => this.arg(i, dc, state)))\n    }\n}\n\nexport class EchoHelper extends AbstractHelper {\n    get (dc: DataContext, state: EachState): any {\n        return this.arg(0, dc, state)\n    }\n}\n\nexport class ConcatHelper extends AbstractHelper {\n    get (dc: DataContext, state: EachState): any {\n        return this.args.map((it, idx) => this.arg(idx, dc, state)).join('')\n    }\n}\n\nexport class MultiHelper implements Helper {\n    helpers: string[]\n    joiner: string\n\n    constructor (joiner: string, helpers: string[]) {\n        this.helpers = helpers\n        this.joiner = joiner\n    }\n\n    get (dc: DataContext, state: EachState): any {\n        return this.helpers.map(it => {\n            const [, v] = dc.get(it, state)\n            return v\n        }).join(this.joiner)\n    }\n}\n","import { Context, Waiter, ElementContainer } from './context'\n\nexport class Tags {\n    tags: Tag[]\n\n    constructor (tags: Tag[]) { this.tags = tags }\n    init (ctx: Context, waiter: Waiter) { this.tags.forEach(it => it.init(ctx, waiter)) }\n    render (ctx: Context, waiter: Waiter) { this.tags.forEach(it => it.render(ctx, waiter)) }\n    update (ctx: Context, waiter: Waiter) { this.tags.forEach(it => it.update(ctx, waiter)) }\n    forEach (fn: (t: Tag, i: number) => void) { this.tags.forEach(fn)}\n\n    destroy (ctx: Context, waiter: Waiter, domRemove: boolean) {\n        this.tags.forEach(it => it.destroy(ctx, waiter, domRemove))\n    }\n}\n\nexport const emptyTags = new Tags([])\n\nexport abstract class Tag implements ElementContainer {\n    id: string\n    parent: ElementContainer\n    children: Tags = emptyTags\n\n    constructor(id: string) {\n        this.id = id\n    }\n\n    init (ctx: Context, waiter: Waiter) {\n        if (this.children) this.children.init(ctx, waiter)\n    }\n\n    abstract render (ctx: Context, waiter: Waiter)\n    abstract update (ctx: Context, waiter: Waiter)\n    abstract destroy (ctx: Context, waiter: Waiter, domRemove: boolean)\n    abstract append (ctx: Context, el: Element | Comment, anchor?: Comment)\n    abstract remove (ctx: Context, el: Element | Comment)\n}\n","import { Tag } from './tag'\nimport { Context, Waiter } from './context'\n\nexport function setAttribute(el: Element, attr: [string, any, boolean]) {\n    if (attr[2]) {\n        el.setAttribute(attr[0], attr[1])\n        return\n    }\n    el[attr[0]] = attr[1]\n}\n\nexport class StaticTag extends Tag {\n    name: string\n    as: [string, any, boolean][] = []\n    inSvg: boolean = false\n\n    constructor(name: string, id: string) {\n        super(id)\n        this.name = name\n        this.inSvg = name === 'svg'\n    }\n\n    attr (name: string, value: any, useSet?: boolean) {\n        this.as.push([name, value, useSet === true])\n    }\n\n    init (ctx: Context, waiter: Waiter) {\n        if (this.inSvg) ctx.startSvg()\n        ctx.setEl(this.id, this.create(ctx))\n        super.init(ctx, waiter)\n        if (this.inSvg) ctx.endSvg()\n    }\n\n    render (ctx: Context, waiter: Waiter) {\n        this.parent.append(ctx, ctx.getEl(this.id))\n        this.children.render(ctx, waiter)\n    }\n\n    update (ctx: Context, waiter: Waiter) {\n        this.children.update(ctx, waiter)\n    }\n\n    destroy (ctx: Context, waiter: Waiter, domRemove: boolean) {\n        if (domRemove) {\n            this.parent.remove(ctx, ctx.getEl(this.id))\n        }\n        ctx.setEl(this.id, null)\n\n        this.children.destroy(ctx, waiter, false)\n    }\n\n    append (ctx: Context, el: Element | Comment, anchor?: Comment) {\n        const ee = ctx.getEl(this.id)\n        if (anchor) {\n            ee.insertBefore(el, anchor)\n            return\n        }\n        ee.appendChild(el)\n    }\n\n    remove (ctx: Context, el: Element | Comment) {\n        ctx.getEl(this.id).removeChild(el)\n    }\n\n    create (ctx: Context): Element {\n        // const element = ctx.isInSvg() ?\n        //     document.createElementNS('http://www.w3.org/2000/svg', this.name) :\n        //     document.createElement(this.name)\n\n        const element = ctx.createElement(this.name)\n        this.as.forEach(it => setAttribute(element, it))\n        return element\n    }\n}\n","import { StaticTag, setAttribute } from './static-tag'\nimport { Context, Waiter, EventTarget, ViewContext } from './context'\nimport { ChangeType} from './common'\n\nexport class DynamicTag extends StaticTag {\n    das: [string, string, boolean][] = []\n    evs: string[]\n    widgets: string[]\n    bindings: string[]\n\n    constructor (name: string, id: string, events: string[] = [], widgets: string[] = [], bds: string[] = []) {\n        super(name, id)\n        this.evs = events\n        this.widgets = widgets\n        this.bindings = bds\n    }\n\n    dattr (name: string, helperId: string, useSet?: boolean) {\n        this.das.push([name, helperId, useSet === true])\n    }\n\n    render (ctx: Context, waiter: Waiter) {\n        super.render(ctx, waiter)\n        this.updateAttrs(ctx)\n        if (!this.evs.length && !this.widgets.length) return\n\n        const el = ctx.getEl(this.id) as Element\n        if (this.evs.length || this.bindings.length) {\n            const ee = ctx.fillState(el)\n            this.evs.forEach(it => ctx.event(false, ee, it))\n            this.bindings.forEach(it => (ctx as ViewContext).bind(0, ee, it))\n        }\n        this.widgets.forEach(it => (ctx as ViewContext).widget(0, el, it))\n    }\n\n    update (ctx: Context, waiter: Waiter) {\n        super.update(ctx, waiter)\n        this.updateAttrs(ctx)\n        const el = ctx.getEl(this.id) as Element\n\n        if (this.evs.length || this.bindings.length) {\n            const ee = ctx.fillState(el)\n            this.bindings.forEach(it => (ctx as ViewContext).bind(1, ee, it))\n        }\n        this.widgets.forEach(it => (ctx as ViewContext).widget(1, el, it))\n    }\n\n    updateAttrs (ctx: Context) {\n        const el = ctx.getEl(this.id)\n        this.das.forEach(it => {\n            const v = ctx.get(it[1])\n            if (v[0] === ChangeType.CHANGED) {\n                setAttribute(el as Element, [it[0], v[1], it[2]])\n            // TODO temporally solve a bug\n            } else if (this.name === 'input' && it[0] === 'checked') {\n                setAttribute(el as Element, [it[0], v[1], it[2]])\n            }\n        })\n    }\n\n    destroy (ctx: Context, waiter: Waiter, domRemove: boolean) {\n        const el = ctx.getEl(this.id) as Element\n        if (this.evs.length || this.bindings.length) {\n            const ee = el as any as EventTarget\n            this.evs.forEach(it => ctx.event(true, ee, it))\n            this.bindings.forEach(it => (ctx as ViewContext).bind(2, ee, it))\n        }\n        this.widgets.forEach(it => (ctx as ViewContext).widget(2, el, it))\n        super.destroy(ctx, waiter, domRemove)\n    }\n}\n","import { Tag } from './tag'\nimport { Context, Waiter } from './context'\n\nexport abstract class BlockTag extends Tag {\n    needAnchor: boolean = false\n    anid: string\n\n    constructor (id: string, needAnchor: boolean) {\n        super(id)\n        this.needAnchor = needAnchor\n        this.anid = `${id}anchor`\n    }\n\n    init (ctx: Context, waiter: Waiter) {\n        if (this.needAnchor) {\n            const anchor = document.createComment(Object.getPrototypeOf(this).constructor.name || 'anchor')\n            ctx.setEl(this.anid, anchor)\n        }\n        super.init(ctx, waiter)\n    }\n\n    render (ctx: Context, waiter: Waiter) {\n        if (!this.needAnchor) return\n        this.parent.append(ctx, ctx.getEl(this.anid))\n    }\n\n    destroy (ctx: Context, waiter: Waiter, domRemove: boolean) {\n        this.children.destroy(ctx, waiter, domRemove)\n        if (!this.needAnchor) return\n        if (domRemove) {\n            this.parent.remove(ctx, ctx.getEl(this.anid))\n        }\n        ctx.setEl(this.anid, null)\n    }\n\n    append (ctx: Context, el: Element | Comment, anchor?: Comment) {\n        if (this.needAnchor && !anchor) {\n            anchor = ctx.getEl(this.anid) as Comment\n        }\n        this.parent.append(ctx, el, anchor)\n    }\n\n    remove (ctx: Context, el: Element | Comment) {\n        this.parent.remove(ctx, el)\n    }\n\n    abstract update (ctx: Context, waiter: Waiter)\n}\n","import { BlockTag } from './block-tag'\nimport { Tags } from './tag'\nimport { Context, Waiter, EventTarget, ElementContainer } from './context'\nimport { Component } from '../component'\nimport { View } from '../view'\n\nclass ReferenceContainer implements ElementContainer {\n    ctx: Context\n    target: ElementContainer\n\n    constructor (ctx: Context, target: ElementContainer) {\n        this.ctx = ctx\n        this.target = target\n    }\n\n    append (ctx: Context, el: Element | Comment, anchor?: Comment) {\n        this.target.append(this.ctx, el, anchor)\n    }\n\n    remove (ctx: Context, el: Element | Comment) {\n        this.target.remove(this.ctx, el)\n    }\n}\n\nexport class ReferenceTag extends BlockTag  {\n    name: string\n    events: string[]\n\n    slots: {[id: string]: Tags} = {}\n    attrs: object = {}\n    mappings: [string, string][] // [name, helper-id]\n\n    constructor (id: string, needAnchor: boolean, name: string, events: string[] = [], mps: [string, string][] = []) {\n        super(id, needAnchor)\n        this.name = name\n        this.events = events\n        this.mappings = mps\n    }\n\n    attr (name: string, value: any) {\n        this.attrs[name] = value\n    }\n\n    init (ctx: Context, waiter: Waiter) {\n        waiter.wait(ctx.create(this.name, this.attr).then(it => ctx.cache.set(this.id, it)))\n        Object.keys(this.slots).forEach(it => this.slots[it].init(ctx, waiter))\n        super.init(ctx, waiter)\n    }\n\n    render (ctx: Context, waiter: Waiter) {\n        super.render(ctx, waiter)\n\n        const item = ctx.cache.get(this.id) as View | Component\n        if (this.events.length) {\n            const et = ctx.fillState(item)\n            this.events.forEach(it => ctx.event(false, et, it))\n        }\n\n        waiter.wait(item.set(this.mappings.reduce((acc, it) => {\n            const [, v, ] = ctx.get(it[1])\n            acc[it[0]] = v\n            return acc\n        }, {})).then(() => {\n            return item._render(new ReferenceContainer(ctx, this))\n        }).then(() => {\n            Object.keys(this.slots).forEach(s => {\n                if (!item.slots[s]) throw new Error(`No slot defined: ${s}`)\n            })\n            return Promise.all(Object.keys(item.slots).map(it => {\n                if (this.slots[it]) {\n                    return item.slots[it].get().then(c => {\n                        const w = new Waiter()\n                        this.slots[it].forEach(s => {\n                            s.parent = c\n                            s.render(ctx, w)\n                        })\n                        return w.end()\n                    })\n                }\n                return item.slots[it].render()\n            }))\n        }))\n    }\n\n    update (ctx: Context, waiter: Waiter) {\n        const item = ctx.cache.get(this.id) as View | Component\n        waiter.wait(item.set(this.mappings.reduce((acc, it) => {\n            const [, v, ] = ctx.get(it[1])\n            acc[it[0]] = v\n            return acc\n        }, {})))\n\n        const w = new Waiter()\n        Object.keys(this.slots).forEach(it => this.slots[it].update(ctx, w))\n        waiter.wait(w.end())\n    }\n\n    destroy (ctx: Context, waiter: Waiter, domRemove: boolean) {\n        const w = new Waiter()\n        Object.keys(this.slots).forEach(it => this.slots[it].destroy(ctx, w, domRemove))\n        waiter.wait(w.end().then(() => {\n            const item = ctx.cache.get(this.id) as View | Component\n            if (this.events.length) {\n                this.events.forEach(it => ctx.event(true, item as any as EventTarget, it))\n            }\n            return item.destroy()\n        }))\n        super.destroy(ctx, waiter, domRemove)\n    }\n}\n","import { Tag } from './tag'\nimport { Context, Waiter, ElementContainer } from './context'\nimport { ChangeType } from './common'\n\ninterface TextItem {\n    parent: ElementContainer\n    init (ctx: Context)\n    render (ctx: Context)\n    update (ctx: Context)\n    destroy (ctx: Context, domRemove: boolean)\n}\n\nclass Static implements TextItem {\n    parent: Tag\n    id: string\n    value: any\n\n    constructor (id: string, value: any) {\n        this.id = id\n        this.value = value\n    }\n\n    init (ctx: Context) {\n        ctx.setEl(this.id, document.createTextNode(this.value))\n    }\n\n    render (ctx: Context) {\n        this.parent.append(ctx, ctx.getEl(this.id))\n    }\n\n    update (ctx: Context) {}\n\n    destroy (ctx: Context, domRemove: boolean) {\n        if (domRemove) {\n            this.parent.remove(ctx, ctx.getEl(this.id))\n        }\n        ctx.setEl(this.id, null)\n    }\n}\n\nclass Dynamic extends Static {\n    render (ctx: Context) {\n        const el = ctx.getEl(this.id) as Text\n        const [, v, ] = ctx.get(this.value)\n        el.data = v\n\n        super.render(ctx)\n    }\n\n    update (ctx: Context) {\n        const el = ctx.getEl(this.id) as Text\n        const [changed, v, ] = ctx.get(this.value)\n        if (changed === ChangeType.CHANGED) el.data = v\n    }\n}\n\nclass Html extends Static {\n    init (ctx: Context) {\n        ctx.setEl(this.id, document.createElement('noscript'))\n        ctx.setEl(`${this.id}e`, document.createElement('noscript'))\n    }\n\n    render (ctx: Context) {\n        super.render(ctx)\n        this.parent.append(ctx, ctx.getEl(`${this.id}e`))\n        this.update(ctx)\n    }\n\n    update (ctx: Context) {\n        const start = ctx.getEl(this.id) as HTMLElement\n        const end = ctx.getEl(`${this.id}e`)\n\n        const [changed, v, ] = ctx.get(this.value)\n        if (changed === ChangeType.NOT_CHANGED) return\n\n        while (start.nextSibling && start.nextSibling !== end) {\n            start.parentNode.removeChild(start.nextSibling)\n        }\n\n        start.insertAdjacentHTML('afterend', v)\n    }\n\n    destroy (ctx: Context, domRemove: boolean) {\n        if (domRemove) {\n            const start = ctx.getEl(this.id) as HTMLElement\n            const end = ctx.getEl(`${this.id}e`)\n            while (start.nextSibling && start.nextSibling !== end) {\n                start.parentNode.removeChild(start.nextSibling)\n            }\n        }\n        ctx.setEl(`${this.id}e`, null)\n        super.destroy(ctx, domRemove)\n    }\n}\n\nexport class TextTag extends Tag {\n    items: TextItem[]\n\n    constructor (id: string, items: [number, string][]) {\n        super(id)\n        this.items = items. map((it, i) => {\n            const iid = `${this.id}${i}`\n            if (it[0] === 2) return new Html(iid, it[1])\n            if (it[0] === 1) return new Dynamic(iid, it[1])\n            return new Static(iid, it[1])\n        })\n    }\n\n    init (ctx: Context, waiter: Waiter) {\n        this.items.forEach(it => {\n            it.parent = this.parent\n            it.init(ctx)\n        })\n    }\n\n    render (ctx: Context, waiter: Waiter) {\n        this.items.forEach(it => it.render(ctx))\n    }\n\n    update (ctx: Context, waiter: Waiter) {\n        this.items.forEach(it => it.update(ctx))\n    }\n\n    destroy (ctx: Context, waiter: Waiter, domRemove: boolean) {\n        this.items.forEach(it => it.destroy(ctx, domRemove))\n    }\n\n    append (ctx: Context, el: Element | Comment, anchor?: Comment) {}\n    remove (ctx: Context, el: Element | Comment) {}\n}\n","import { DataContext } from './context'\nimport { getValue, getAttributeValue } from './value'\nimport { EachState, NormalValue } from './common'\n\nexport class Transformer {\n    value: string\n    end: NormalValue\n    items: TransformerItem[]\n\n    constructor (value: string, items: TransformerItem[], end?: NormalValue) {\n        this.value = value\n        this.items = items || []\n        this.end = end\n    }\n\n    get (dc: DataContext, state: EachState): any {\n        let v = getValue(dc, this.value, state)\n        v = this.items.reduce((acc, item) => item.get(dc, state, acc), v)\n        if (v == null && this.end) {\n            return getAttributeValue(dc, this.end, state)\n        }\n        return v\n    }\n}\n\nexport class TransformerItem {\n    name: string\n    args: NormalValue[]\n\n    constructor(name: string, args: NormalValue[]) {\n        this.name = name\n        this.args = args || []\n    }\n\n    get (dc: DataContext, state: EachState, v: any): any {\n        const fn = dc.transformer(this.name)\n        if (!fn) {\n            throw new Error(`no helper found: ${this.name}`)\n        }\n        const args = this.args.map(it => getAttributeValue(dc, it, state)).concat(v)\n        return fn.apply(null, args)\n    }\n}\n","import { BlockTag } from './block-tag'\nimport { Context, Waiter } from './context'\nimport { Tags, emptyTags } from './tag'\nimport { EachDef, ChangeType } from './common'\n\nconst toKeys = (list: any): EachKey[] => {\n    if (!list) return []\n    return Array.isArray(list) ? list.map((it, i) => i) : Object.keys(list)\n}\n\nexport type EachKey = string | number\n\nexport class EachTag extends BlockTag {\n    def: EachDef\n    loopPart: Tags\n    falsePart: Tags\n\n    constructor (id: string, needAnchor: boolean, def: EachDef, loopPart: Tags, falsePart?: Tags) {\n        super(id, needAnchor)\n        this.def = def\n        this.loopPart = loopPart\n        this.falsePart = falsePart || emptyTags\n    }\n\n    init (ctx: Context, waiter: Waiter) {\n        this.loopPart.forEach(it => it.parent = this)\n        this.falsePart.forEach(it => it.parent = this)\n        super.init(ctx, waiter)\n    }\n\n    render (ctx: Context, waiter: Waiter) {\n        super.render(ctx, waiter)\n\n        const [, list] = ctx.get(this.def.name)\n        const kv = toKeys(list)\n        if (!kv.length) {\n            this.renderElse(ctx, waiter)\n            return\n        }\n\n        this.storeKeys(ctx, kv)\n        this.doEach(ctx, kv, () => this.renderBody(ctx, waiter))\n    }\n\n    storeKeys (ctx: Context, kv: EachKey[]) {\n        ctx.cache.set(`_keys_${this.id}`, kv)\n    }\n\n    clearKeys (ctx: Context) {\n        ctx.cache.clear(`_keys_${this.id}`)\n    }\n\n    update (ctx: Context, waiter: Waiter) {\n        const [changed, list, old] = ctx.get(this.def.name)\n        const lkv = toKeys(list)\n        const okv = toKeys(old)\n        const le = !lkv.length\n        const oe = !okv.length\n\n        this.storeKeys(ctx, lkv)\n\n        if (le && oe) {\n            this.falsePart.update(ctx, waiter)\n            return\n        }\n\n        if (changed === ChangeType.NOT_CHANGED) {\n            this.doEach(ctx, lkv, () => this.loopPart.update(ctx, waiter))\n            return\n        }\n\n        if (!oe && le) {\n            this.doEach(ctx, okv, () => this.loopPart.destroy(ctx, waiter, true), true)\n            this.renderElse(ctx, waiter)\n            return\n        }\n\n        if (oe && !le) {\n            this.falsePart.destroy(ctx, waiter, true)\n            this.doEach(ctx, lkv, () => this.renderBody(ctx, waiter))\n            return\n        }\n\n        if (lkv.length === okv.length) {\n            this.doEach(ctx, lkv, () => this.loopPart.update(ctx, waiter))\n            return\n        }\n\n        if (lkv.length < okv.length) {\n            this.doEach(ctx, lkv, () => this.loopPart.update(ctx, waiter))\n            this.doEach(ctx, okv.slice(lkv.length), () => this.loopPart.destroy(ctx, waiter, true), true)\n            return\n        }\n\n        this.doEach(ctx, lkv.slice(0, okv.length), () => this.loopPart.update(ctx, waiter))\n        this.doEach(ctx, lkv.slice(okv.length), () => this.renderBody(ctx, waiter))\n    }\n\n    renderElse (ctx: Context, waiter: Waiter) {\n        const w = new Waiter()\n        this.falsePart.init(ctx, w)\n        this.falsePart.render(ctx, w)\n        waiter.wait(w.end())\n    }\n\n    renderBody (ctx: Context, waiter: Waiter) {\n        const w = new Waiter()\n        this.loopPart.init(ctx, w)\n        this.loopPart.render(ctx, w)\n        waiter.wait(w.end())\n    }\n\n    doEach (ctx: Context, list: EachKey[], fn: (EachKey) => void, remove: boolean = false, destroy: boolean = false) {\n        ctx.cache.push(this.id, this.def)\n        list.forEach(it => {\n            const d = ctx.cache.next(it)\n            fn(it)\n            if (remove) d.dispose()\n        })\n        ctx.cache.pop(destroy)\n    }\n\n    destroy (ctx: Context, waiter: Waiter, domRemove: boolean) {\n        const [changed, list, old] = ctx.get(this.def.name)\n        const kv = changed === ChangeType.NOT_CHANGED ? toKeys(list) : toKeys(old)\n        this.doEach(ctx, kv, () => this.loopPart.destroy(ctx, waiter, domRemove), true, true)\n        if (!kv.length) this.falsePart.destroy(ctx, waiter, domRemove)\n        this.clearKeys(ctx)\n        super.destroy(ctx, waiter, domRemove)\n    }\n}\n","import { BlockTag } from './block-tag'\nimport { Tags, emptyTags } from './tag'\nimport { Context, Waiter } from './context'\nimport { ChangeType } from './common'\n\nexport class IfTag extends BlockTag {\n    bool: string\n    truePart: Tags\n    falsePart: Tags\n\n    constructor (id: string, needAnchor: boolean, bool: string, truePart: Tags, falsePart?: Tags) {\n        super(id, needAnchor)\n        this.bool = bool\n        this.truePart = truePart\n        this.falsePart = falsePart || emptyTags\n    }\n\n    init (ctx: Context, waiter: Waiter) {\n        this.truePart.forEach(it => it.parent = this)\n        this.falsePart.forEach(it => it.parent = this)\n        super.init(ctx, waiter)\n    }\n\n    render (ctx: Context, waiter: Waiter) {\n        super.render(ctx, waiter)\n\n        const [, v] = ctx.get(this.bool)\n        this.renderIt(this.use(v), ctx, waiter)\n    }\n\n    update (ctx: Context, waiter: Waiter) {\n        const [changed, v, old] = ctx.get(this.bool)\n        if (changed === ChangeType.NOT_CHANGED) {\n            this.use(v).update(ctx, waiter)\n            return\n        }\n\n        this.use(old).destroy(ctx, waiter, true)\n        this.renderIt(this.use(v), ctx, waiter)\n    }\n\n    destroy (ctx: Context, waiter: Waiter, domRemove: boolean) {\n        const [, , v] = ctx.get(this.bool)\n        this.use(v).destroy(ctx, waiter, domRemove)\n        super.destroy(ctx, waiter, domRemove)\n    }\n\n    renderIt (tags: Tags, ctx: Context, waiter: Waiter) {\n        const w = new Waiter()\n        tags.init(ctx, w)\n        tags.render(ctx, w)\n        waiter.wait(w.end())\n    }\n\n    use (v: any): Tags {\n        return v ? this.truePart : this.falsePart\n    }\n}\n\nexport class UnlessTag extends IfTag {\n    use (v: any): Tags {\n        return v ? this.falsePart : this.truePart\n    }\n}\n","import { Context, EventTarget, DataContext } from './context'\nimport { getValue, tokenize } from './value'\nimport { EachState } from './common'\n\nexport interface Binding {\n    id: string\n    bind (el: EventTarget)\n    update (el: EventTarget)\n    unbind (el: EventTarget)\n}\n\nclass AbstractBinding implements Binding {\n    id: string\n    target: string\n    event: string\n    setter: (el: HTMLElement, value: any) => void\n    fn: (this: EventTarget) => void\n\n    constructor (\n        id: string, target: string, event: string,\n        get: (el: HTMLElement) => any, set: (el: HTMLElement, value: any) => void\n    ) {\n        this.id = id\n        this.target = target\n        this.event = event\n        this.setter = set\n\n        this.fn = function (this: EventTarget) {\n            const el = this as any as HTMLElement\n            const ctx = this._ctx as DataContext\n            ctx.update(genUpdate(this, ctx.data, target, get(el)))\n        }\n    }\n\n    bind (el: EventTarget) {\n        el.addEventListener(this.event, this.fn, false)\n    }\n\n    update (el: EventTarget) {\n        const ee = this as any as HTMLElement\n        this.setter(ee, getValue(el._ctx as DataContext, this.target, el))\n    }\n\n    unbind (el: EventTarget) {\n        el.removeEventListener(this.event, this.fn, false)\n    }\n}\n\nexport class InputValue extends AbstractBinding {\n    constructor (id: string, target: string) {\n        const get = (el: HTMLElement) => (el as HTMLInputElement).value\n        const set = (el: HTMLElement, value: any) => (el as HTMLInputElement).value = value\n        super(id, target, 'input', get, set)\n    }\n}\n\nexport class InputChecked extends AbstractBinding {\n    constructor (id: string, target: string) {\n        const get = (el: HTMLElement) => (el as HTMLInputElement).checked\n        const set = (el: HTMLElement, value: any) => (el as HTMLInputElement).checked = value\n        super(id, target, 'change', get, set)\n    }\n}\n\nexport class Select extends AbstractBinding {\n    constructor (id: string, target: string) {\n        super(id, target, 'change', getSelectValue, setSelectOption)\n    }\n}\n\nexport class WindowScrollX extends AbstractBinding {\n    constructor (id: string, target: string) {\n        const get = (el: HTMLElement) => (el as any as Window).pageXOffset\n        const set = (el: HTMLElement, value: any) => {\n            const w = (el as any as Window)\n            w.scrollTo(value, w.pageYOffset)\n        }\n        super(id, target, 'scroll', get, set)\n    }\n}\n\nexport class WindowScrollY extends AbstractBinding {\n    constructor (id: string, target: string) {\n        const get = (el: HTMLElement) => (el as any as Window).pageYOffset\n        const set = (el: HTMLElement, value: any) => {\n            const w = (el as any as Window)\n            w.scrollTo(w.pageXOffset, value)\n        }\n        super(id, target, 'scroll', get, set)\n    }\n}\n\nexport class RadioGroup extends AbstractBinding {\n    constructor (id: string, target: string) {\n        const get = (el: HTMLElement) => (el as HTMLInputElement).value\n        const set = (el: HTMLElement, value: any) => {\n            const ee = el as HTMLInputElement\n            ee.checked = ee.value === value + ''\n        }\n        super(id, target, 'change', get, set)\n    }\n}\n\nexport class CheckGroup implements Binding {\n    id: string\n    target: string\n    fn: (this: EventTarget) => void\n\n    constructor (id: string, target: string) {\n        this.id = id\n        this.target = target\n\n        this.fn = function (this: EventTarget) {\n            const ctx = this._ctx as DataContext\n            const c = ctx.cache.get(id)\n            if (!c) return\n            const v = c.filter(it => it.checked).map(it => it.value)\n            ctx.update(genUpdate(this, ctx.data, target, v))\n        }\n    }\n\n    bind (el: EventTarget) {\n        let c = el._ctx.cache.get(this.id)\n        if (!c) {\n            c = []\n            c.push(el)\n        }\n        el.addEventListener('change', this.fn, false)\n    }\n\n    update (el: EventTarget) {\n        const v = getValue(el._ctx as DataContext, this.target, el)\n        const ee = el as any as HTMLInputElement\n        ee.checked = v.indexOf(ee.value) !== -1\n    }\n\n    unbind (el: EventTarget) {\n        const c = el._ctx.cache.get(this.id)\n        if (!c) return\n        c.splice(c.indexOf(el), 1)\n        if (!c.length) el._ctx.cache.clear(this.id)\n        el.removeEventListener('change', this.fn, false)\n    }\n}\n\nconst getSelectValue = (el: HTMLSelectElement) => {\n    const opt = el.options[el.selectedIndex || 0]\n    return opt && opt.value\n}\n\nconst setSelectOption = (el: HTMLSelectElement, value) => {\n    // tslint:disable-next-line:prefer-for-of\n    for (let i = 0; i < el.options.length; i ++) {\n        const opt = el.options[i]\n        if (opt.value === (value + '')) {\n            opt.selected = true\n            return\n        }\n    }\n}\n\nfunction setValue(data: object, tks: string[], value: any): object {\n    if (!tks.length) return value\n    tks.reduce((acc, it, i) => {\n        if (i === tks.length) {\n            acc[it] = value\n            return\n        }\n\n        if (!acc[it]) acc[it] = {}\n        return acc[it]\n    }, data)\n    return data\n}\n\nfunction genUpdate(state: EachState, data: object, key: string, value: any): object {\n    const [first, ...tail] = tokenize(key)\n    const idx = state._def.findIndex(it => it.alias === first)\n\n    if (idx === -1) {\n        return {[first]: setValue(data[first], tail, value)}\n    }\n\n    const list = data[state._def[0].name]\n    let o = data\n    for (let i = 0; i < idx; i ++) {\n        o = data[state._def[i].name][state._state[i]]\n    }\n    const list2 = o[state._def[idx].name]\n    list2[state._state[idx]] = setValue(list2[state._state[idx]], tail, value)\n    return {[first]: list}\n}\n","\nimport { Loader } from './loader'\nimport {\n    ComponentTemplate, ViewTemplate, Template\n} from './template/template'\nimport { Application } from './application'\nimport { Lifecycle } from './lifecycle'\nimport { Component } from './component'\nimport { RouterPlugin } from './route'\nimport {\n    IfHelper, UnlessHelper, DelayHelper, EchoHelper, BoolHelper, MultiHelper, ConcatHelper\n} from './template/helper'\nimport { DynamicTag } from './template/dynamic-tag'\nimport { StaticTag } from './template/static-tag'\nimport { ReferenceTag } from './template/reference-tag'\nimport { TextTag } from './template/text-tag'\nimport { Tag, Tags } from './template/tag'\nimport { TransformerItem, Transformer } from './template/transformer'\nimport { EachTag } from './template/each-tag'\nimport { Attribute, AttributeValue, NormalValue, ValueType, EachDef } from './template/common'\nimport { IfTag, UnlessTag } from './template/if-tag'\nimport { EventDef, Helper } from './template/context'\nimport {\n    InputValue, InputChecked, Select, Binding, WindowScrollX, WindowScrollY, CheckGroup, RadioGroup\n} from './template/binding'\n\nexport interface Disposable {\n    dispose (): void\n}\n\ninterface NodeConstructor {\n    new (id: string, ref?: string): DynamicTag\n}\n\nconst nodes: {[name: string]: NodeConstructor} = {\n    // TODO window: WindowNode,\n    // app: ApplicationNode\n}\n\nfunction createTag(id: string, name: string): DynamicTag | undefined {\n    if (nodes[name]) return new nodes[name](id)\n}\n\ntype HelperArg = string | AttributeValue\n\nconst map = (args: HelperArg[]) => args.map(it => Array.isArray(it) ? it : DV(it))\n\n// tags\nconst ST = (id: string, name: string) => {\n    const node = createTag(name, id)\n    return node ? node : new StaticTag(name, id)\n}\nconst DT = (id: string, name: string, events: string[], widgits: string[], bds: string[]) => {\n    const node = createTag(name, id)\n    return node ? node : new DynamicTag(name, id, events, widgits, bds)\n}\nconst REF = (id: string, needAnchor: boolean, name: string, events: string[], ...mps: [string, string][]) => {\n    return new ReferenceTag(id, needAnchor, name, events, mps)\n}\nconst TX = (id: string, ...ss: [number, string][]) => new TextTag(id, ss)\nconst TS = (...ts: Tag[]) => new Tags(ts)\nconst C = (parent: Tag, ...children: Tag[]) => {\n    parent.children = new Tags(children)\n    children.forEach(it => it.parent = parent)\n}\n\n// node attribute\nconst SA = (d: StaticTag | DynamicTag | ReferenceTag, name: string, value: any, useSet: boolean = true) => {\n    d.attr(name, value, useSet)\n}\nconst DA = (d: DynamicTag, name: string, helper: string, useSet: boolean = true) => d.dattr(name, helper, useSet)\n\n// attributes\nconst SV = (v: string) => [ValueType.STATIC, v] as NormalValue\nconst DV = (v: string) => [ValueType.DYNAMIC, v] as NormalValue\nconst AT = (n: string, v: AttributeValue) => [n, v] as Attribute\nconst TI = (name: string, ...args: NormalValue[]) => new TransformerItem(name, args)\nconst TV = (value: string, end?: NormalValue, ...items: TransformerItem[]) =>\n    [ValueType.TRANSFORMER, new Transformer(value, items, end)] as AttributeValue\n\n// helpers\nconst HE = (n: HelperArg) => Array.isArray(n) ? new EchoHelper([n]) : new EchoHelper([DV(n)])\nconst HB = (...args: HelperArg[]) => new BoolHelper(map(args))\nconst HC = (...args: HelperArg[]) => new ConcatHelper(map(args))\nconst HIF = (bool: string, ...args: HelperArg[]) => new IfHelper(bool, map(args))\nconst HUN = (bool: string, ...args: HelperArg[]) => new UnlessHelper(bool, map(args))\nconst HM = (joiner: string, ...helpers: string[]) => new MultiHelper(joiner, helpers)\nconst HH = (name: string, ...args: HelperArg[]) => new DelayHelper(name, map(args))\n\n// event\nconst EV = (name: string, method: string, isAction: boolean, ...attrs: HelperArg[]) => {\n    return {name, method, isAction, attrs: map(attrs)} as EventDef\n}\n\n// block\nconst EAD = (name: string, alias: string, idx?: string, key?: string) => {\n    return {name, alias, idx, key} as EachDef\n}\nconst EH = (id: string, needAnchor: boolean, def: EachDef, loop: Tags, falseTags?: Tags) => {\n    return new EachTag(id, needAnchor, def, loop, falseTags)\n}\nconst IF = (id: string, needAnchor: boolean, helper: string, trueTags: Tags, falseTags?: Tags) => {\n    return new IfTag(id, needAnchor, helper, trueTags, falseTags)\n}\nconst UN = (id: string, needAnchor: boolean, helper: string, trueTags: Tags, falseTags?: Tags) => {\n    return new UnlessTag(id, needAnchor, helper, trueTags, falseTags)\n}\n\ninterface BindingCreator {\n    new (id: string, target: string): Binding\n}\n\nconst bindings: BindingCreator[] = [\n    InputValue, InputChecked, Select, WindowScrollX, WindowScrollY, RadioGroup, CheckGroup\n]\n\nconst H = (tp: Template, id: string, h: Helper) => tp.helper(id, h)\nconst E = (tp: Template, id: string, e: EventDef) => tp.event(id, e)\nconst W = (tp: ViewTemplate, id: string, name: string, ...args: string[]) => tp.widget(id, {name, args})\nconst R = (tp: Template, name: string, id: string, ...each: string[]) => tp.ref(name, {id, each})\nconst B = (tp: ViewTemplate, id: string, type: number, target: string) => tp.binding(id, new bindings[type](id, target))\n\nexport const factory = {\n    ST, DT, TX, REF, SV, DV, AT,\n    H, HE, HC, HB, HIF, HUN, HM, HH,\n    E, EV, EAD, EH, IF, UN, C,\n    SA, DA, TI, TV, TS, W, R, B\n}\n\nexport {\n    ComponentTemplate, ViewTemplate, Application, Loader, RouterPlugin\n}\n\nexport function registerNode(name: string, type: NodeConstructor) {\n    nodes[name] = type\n}\n\n// export function registerRegion(name: string, type: RegionConstructor) {\n//     regions[name] = type\n// }\n\nexport interface DrizzlePlugin {\n    componentLifecycles: Lifecycle[]\n    viewLifecycles: Lifecycle[]\n    init (app: Application): void\n    started (item: Component): void\n}\n"],"names":["Loader","app","path","args","_app","_path","_args","file","mod","options","getResource","scriptRoot","ChangeType","ValueType","resolveEventArguments","ctx","me","event","def","result","attrs","forEach","it","STATIC","push","DYNAMIC","ts","tokenize","first","shift","o","reduce","acc","key","getAttributeValue","av","state","getValue","TRANSFORMER","get","ks","data","computed","root","_options","oo","_def","some","v","i","idx","_state","alias","name","length","item","cache","input","slice","token","inString","t","walk","re","current","each","id","keys","Cache","c","getCache","_id","ca","pop","dispose","clear","exclude","value","Waiter","p","busy","bs","Promise","all","ElementState","el","val","DataContext","template","_file","set","ck","ex","version","old","helpers","type","NOT_CHANGED","CHANGED","es","_ctx","inSvg","document","createElementNS","createElement","isUnbind","eventId","events","ces","customEvents","ce","ee","s","off","fn","on","isAction","_action","method","_event","obj","slot","slots","refs","Error","ref","ViewContext","h","transformers","_component","_createItem","widgets","ws","w","map","create","as","changed","update","destory","bd","bindings","bind","unbind","ComponentContext","TargetKey","RootParent","anchor","target","append","remove","ElementParent","insertBefore","appendChild","removeChild","Template","tags","e","trigger","addEventListener","removeEventListener","helper","context","stage","init","_refs","parent","end","rendered","_target","render","updated","destroyed","destroy","ViewTemplate","ComponentTemplate","exportedModels","callIt","cycles","reverse","filter","then","apply","resolve","LifecycleContainer","cs","stages","_cycles","collect","call","ComponentState","Renderable","CREATED","_status","INITED","_busy","_doBeforeRender","_doCollect","_doRendered","RENDERED","_doBeforeDestroy","_doDestroyed","_doInit","actions","d","_dispatch","Model","opt","_data","Store","updateKey","models","_names","Object","_models","k","fire","payload","reject","View","viewLifecycles","_set","assign","silent","source","_doBeforeUpdate","_doUpdated","Events","handler","_handlers","hs","indexOf","splice","UPDATE_ACTION","Date","componentReferences","Component","loader","extraState","componentLifecycles","_loader","_extraState","_store","dispatch","_items","_init","babelHelpers.get","store","_loadItems","items","ps","views","concat","createLoader","components","load","getOwnPropertyNames","prototype","enter","node","cb","keyCode","preventDefault","Application","entry","registerLoader","loaders","default","plugin","_plugins","startViewport","started","container","lo","_render","Token","next","doMatch","vv","match","consumed","remain","ArgToken","AllToken","join","trim","split","reduceRight","charAt","Router","comp","routes","prefix","_prefix","initRoutes","_keys","doRoute","_previous","undefined","_next","leave","_defs","_currentKey","_router_prefix","route","sort","a","b","createHandler","createComponentHandler","createActionHandler","createEventHandler","action","model","setCleaner","wait","_router","RouterComponentLifecycle","r","RouterViewLifecycle","RouterPlugin","router","doIt","hash","window","location","console","log","Compare","v1","v2","AbstractHelper","dc","BoolHelper","arg","op","IfHelper","bool","use","UnlessHelper","DelayHelper","transformer","EchoHelper","ConcatHelper","MultiHelper","joiner","Tags","waiter","domRemove","emptyTags","Tag","children","setAttribute","attr","StaticTag","useSet","startSvg","setEl","endSvg","getEl","element","DynamicTag","bds","evs","helperId","das","updateAttrs","fillState","widget","BlockTag","needAnchor","anid","createComment","getPrototypeOf","constructor","ReferenceContainer","ReferenceTag","mps","mappings","et","Static","createTextNode","Dynamic","Html","start","nextSibling","parentNode","insertAdjacentHTML","TextTag","iid","Transformer","TransformerItem","toKeys","list","Array","isArray","EachTag","loopPart","falsePart","kv","renderElse","storeKeys","doEach","renderBody","lkv","okv","le","oe","clearKeys","IfTag","truePart","renderIt","UnlessTag","AbstractBinding","setter","genUpdate","InputValue","InputChecked","checked","Select","getSelectValue","setSelectOption","WindowScrollX","pageXOffset","scrollTo","pageYOffset","WindowScrollY","RadioGroup","CheckGroup","selectedIndex","selected","setValue","tks","tail","findIndex","list2","nodes","createTag","DV","ST","DT","widgits","REF","TX","ss","TS","C","SA","DA","dattr","SV","AT","n","TI","TV","HE","HB","HC","HIF","HUN","HM","HH","EV","EAD","EH","loop","falseTags","IF","trueTags","UN","H","tp","E","W","R","B","binding","factory","registerNode"],"mappings":"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"}